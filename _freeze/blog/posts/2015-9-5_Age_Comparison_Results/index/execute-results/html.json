{
  "hash": "9b9845f995c5149a6a8c8b0f90b0f6c0",
  "result": {
    "markdown": "---\ntitle: Age Comparison Results for Individual Fish\ndescription: Demonstrates how to extract age comparison results for individual fish from the object returned by `ageComparisons()`.\nauthor: Derek H. Ogle\ndate: 9/5/2015\nimage: preview.png\ncategories:\n  - Age\n  - Age Comparisons\n---\n\n\n:::{.callout-note}\nThe following packages are loaded for use below. I also set the default `ggplot` theme to `theme_bw()` for a classic \"black-and-white\" plot (rather than the default plot with a gray background).\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(FSA)           # for WhitefishLC, agePrecision(), headtail()\nlibrary(dplyr)         # for arrange(), filter()\nlibrary(ggplot2)\ntheme_set(theme_bw())\n```\n:::\n\n\n&nbsp;\n\n# Introduction\nAn **FSA** user asked if there was a way to work with the age comparison results for individual fish. In particular, this user wanted to identify each fish for which the individual CV values from comparing two independent age estimates was greater than 10. This is fairly easy to do with an understanding of the results returned from `agePrecision()`. Below is an example using the `WhitefishLC` data found in the **FSA** package.^[These data are automatically loaded with `library(FSA)`.]\n\nThese data contain, among other things, ages assigned by two readers examining otoliths in (`otolith1` and `otolith2`).^[`headtail()` from `FSA` shows the first and last three rows of a data frame. It is used here primarily to save space.]\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheadtail(WhitefishLC)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|      fishID  tl scale1 scale2 scaleC finray1 finray2 finrayC otolith1 otolith2\n#R|  1        1 345      3      3      3       3       3       3        3        3\n#R|  2        2 334      4      3      4       3       3       3        3        3\n#R|  3        3 348      7      5      6       3       3       3        3        3\n#R|  149    214 599     14     16     15      14      14      14       16       16\n#R|  150    216 636      8     10      9      10       8      10       15       15\n#R|  151    218 551      5      7      6       6       9       8       13       13\n#R|      otolithC\n#R|  1          3\n#R|  2          3\n#R|  3          3\n#R|  149       16\n#R|  150       15\n#R|  151       13\n```\n:::\n:::\n\n\n&nbsp;\n\n# Manipulate `agePrecision()` object\nA variety of computations on these paired age estimates are performed with `agePrecision()`.^[See [the `agePrecision()` documentation](https://fishr-core-team.github.io/FSA/reference/agePrecision.html) for full details.] The structure of the saved object shows several items returned in a list.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nap1 <- agePrecision(~otolith1+otolith2,data=WhitefishLC)\nstr(ap1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|  List of 14\n#R|   $ detail   :'data.frame':\t151 obs. of  12 variables:\n#R|    ..$ otolith1: int [1:151] 3 3 3 3 3 6 9 11 3 1 ...\n#R|    ..$ otolith2: int [1:151] 3 3 3 3 3 5 10 12 4 1 ...\n#R|    ..$ mean    : num [1:151] 3 3 3 3 3 5.5 9.5 11.5 3.5 1 ...\n#R|    ..$ median  : num [1:151] 3 3 3 3 3 5.5 9.5 11.5 3.5 1 ...\n#R|    ..$ mode    : int [1:151] 3 3 3 3 3 NA NA NA NA 1 ...\n#R|    ..$ SD      : num [1:151] 0 0 0 0 0 ...\n#R|    ..$ CV      : num [1:151] 0 0 0 0 0 ...\n#R|    ..$ CV2     : num [1:151] 0 0 0 0 0 ...\n#R|    ..$ AD      : num [1:151] 0 0 0 0 0 0.5 0.5 0.5 0.5 0 ...\n#R|    ..$ PE      : num [1:151] 0 0 0 0 0 ...\n#R|    ..$ PE2     : num [1:151] 0 0 0 0 0 ...\n#R|    ..$ D       : num [1:151] 0 0 0 0 0 ...\n#R|   $ rawdiff  : 'table' int [1:5(1d)] 3 27 94 21 6\n#R|    ..- attr(*, \"dimnames\")=List of 1\n#R|    .. ..$ : chr [1:5] \"-2\" \"-1\" \"0\" \"1\" ...\n#R|   $ absdiff  : 'table' int [1:3(1d)] 94 48 9\n#R|    ..- attr(*, \"dimnames\")=List of 1\n#R|    .. ..$ : chr [1:3] \"0\" \"1\" \"2\"\n#R|   $ ASD      : num 0.309\n#R|   $ ACV      : num 4.72\n#R|   $ ACV2     : num 4.72\n#R|   $ AAD      : num 0.219\n#R|   $ APE      : num 3.34\n#R|   $ APE2     : num 3.34\n#R|   $ AD       : num 3.34\n#R|   $ PercAgree: num 62.3\n#R|   $ R        : int 2\n#R|   $ n        : int 151\n#R|   $ validn   : int 151\n#R|   - attr(*, \"class\")= chr \"agePrec\"\n```\n:::\n:::\n\n\nFor this problem, the user wants to focus on the intermediate calculations for each individual fish, which, according to the [the `agePrecision()` documentation](https://fishr-core-team.github.io/FSA/reference/agePrecision.html), is in `detail` object.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheadtail(ap1$detail)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|      otolith1 otolith2 mean median mode SD CV CV2 AD PE PE2 D\n#R|  1          3        3    3      3    3  0  0   0  0  0   0 0\n#R|  2          3        3    3      3    3  0  0   0  0  0   0 0\n#R|  3          3        3    3      3    3  0  0   0  0  0   0 0\n#R|  149       16       16   16     16   16  0  0   0  0  0   0 0\n#R|  150       15       15   15     15   15  0  0   0  0  0   0 0\n#R|  151       13       13   13     13   13  0  0   0  0  0   0 0\n```\n:::\n:::\n\n\nThe `detail` object is a data frame that can then be treated like any other data frame. For example, it can be sorted by ascending order of the CV value or filtered to find all fish that had a CV greater than 10.^[Here I use`arrange()` from `dplyr` to sort and `filter()` from `dplyr` to filter.]\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## Sort by CV\ntmp <- ap1$detail |>\n  arrange(CV)\nheadtail(tmp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|      otolith1 otolith2 mean median mode        SD       CV      CV2  AD PE PE2\n#R|  1          3        3  3.0    3.0    3 0.0000000  0.00000  0.00000 0.0  0   0\n#R|  2          3        3  3.0    3.0    3 0.0000000  0.00000  0.00000 0.0  0   0\n#R|  3          3        3  3.0    3.0    3 0.0000000  0.00000  0.00000 0.0  0   0\n#R|  149        3        2  2.5    2.5   NA 0.7071068 28.28427 28.28427 0.5 20  20\n#R|  150        3        2  2.5    2.5   NA 0.7071068 28.28427 28.28427 0.5 20  20\n#R|  151        6        4  5.0    5.0   NA 1.4142136 28.28427 28.28427 1.0 20  20\n#R|       D\n#R|  1    0\n#R|  2    0\n#R|  3    0\n#R|  149 20\n#R|  150 20\n#R|  151 20\n```\n:::\n\n```{.r .cell-code}\n## Filter by CV\ntmp2 <- ap1$detail |>\n  filter(CV>10)\nheadtail(tmp2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|     otolith1 otolith2 mean median mode        SD       CV      CV2  AD        PE\n#R|  1         6        5  5.5    5.5   NA 0.7071068 12.85649 12.85649 0.5  9.090909\n#R|  2         3        4  3.5    3.5   NA 0.7071068 20.20305 20.20305 0.5 14.285714\n#R|  3         2        3  2.5    2.5   NA 0.7071068 28.28427 28.28427 0.5 20.000000\n#R|  28        9       11 10.0   10.0   NA 1.4142136 14.14214 14.14214 1.0 10.000000\n#R|  29        9        7  8.0    8.0   NA 1.4142136 17.67767 17.67767 1.0 12.500000\n#R|  30        5        4  4.5    4.5   NA 0.7071068 15.71348 15.71348 0.5 11.111111\n#R|           PE2         D\n#R|  1   9.090909  9.090909\n#R|  2  14.285714 14.285714\n#R|  3  20.000000 20.000000\n#R|  28 10.000000 10.000000\n#R|  29 12.500000 12.500000\n#R|  30 11.111111 11.111111\n```\n:::\n:::\n\n\nThe distribution of CV values can also be examined (@fig-cvdist).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncvdist <- ggplot(data=ap1$detail,aes(x=CV)) +\n  geom_histogram(binwidth=2.5,boundary=0,color=\"black\",fill=\"gray50\") +\n  scale_x_continuous(name=\"Coefficient of Variation\") +\n  scale_y_continuous(name=\"Frequency\",expand=expansion(mult=c(0,0.05))) +\n  geom_vline(xintercept=10,color=\"red\",linewidth=1,linetype=\"dashed\")\ncvdist\n```\n\n::: {.cell-output-display}\n![Distribution of CV values for comparisons of readings of Lake Whitefish otoliths by two readers.](index_files/figure-html/fig-cvdist-1.png){#fig-cvdist fig-align='center' fig-alt='Distribution of CV values for comparisons of readings of Lake Whitefish otoliths by two readers.' width=432}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}