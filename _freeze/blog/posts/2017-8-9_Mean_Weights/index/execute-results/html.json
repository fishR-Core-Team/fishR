{
  "hash": "a86ed78be65523f297c8c04842f8f081",
  "result": {
    "markdown": "---\ntitle: Mean Weights at Ages From Lengths\ndescription: Demonstrates concerns and corrections with estimating mean weight from observed lengths and a weight-length relationship.\nauthor: Derek H. Ogle\ndate: 8/9/2017\nimage: preview.png\ncategories:\n  - Weight-Length\n  - Biomasss\nknitr: \n  opts_chunk:\n    cache: true\n---\n\n\n:::{.callout-note}\nThe following packages are loaded for use below. I also set the default `ggplot` theme to `theme_bw()` for a classic \"black-and-white\" plot (rather than the default plot with a gray background) and set the random number seed for reproducibility of the randomly generated sample data below.\n:::\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/packages_f3a00e1d76de81a12036c49220ef4b3f'}\n\n```{.r .cell-code}\nlibrary(FSA)           # for headtail()\nlibrary(dplyr)         # for mutate(), group_by(), summarize(), \nlibrary(ggplot2)\nlibrary(patchwork)     # for combining plots\ntheme_set(theme_bw())\nset.seed(678394)  # for reproducibility of randomly created data\n```\n:::\n\n\n&nbsp;\n\n# Introduction\nRecently I was tasked with estimating mean weights-at-age for data that contained no weights, but did contain lengths and ages (ages were from applying an age-length key). A weight-length relationship was available (derived from a smaller sample from the same population). A question arose about whether the weight-length relationship should be used to predict weights for individual fish and then summarized to estimate mean weights at age or whether the weight-length relationship should be applied to summarized mean lengths-at-age to estimate mean weights-at-age.\n\nThis issue has been addressed in the literature. @ricker_computation_1975 states that the true mean weight is always greater, \"on the order of 5%,\" than the mean weight computed from the weight-length relationship with the mean length. @tesch_age_1971 suggested that the error in predicting mean weight-at-age with the weight-length relationship using mean length-at-age would be about 5-10%. In a simulation study, @nielsen_errors_1980 found that Tesch's suggestion was too general and that error was less than 10% when the coefficient of variation (CV; standard deviation divided by mean) in lengths was less than 10%, but could be substantially higher when the CV was higher, with the specific result dependent on the weight-length regression exponent (b).^[@nielsen_errors_1980 provided a nice geometric description of why this bias occurs.] @pienaar_estimating_1968 and @beyer_length-weight_1991 both suggested corrections to reduce the bias in the mean weight-at-age produced by the weight-length regression using the mean length.\n\nIn this post, I explore the bias in using the weight-length regression to estimate mean weight-at-age from mean length-at-age and the correction factors suggested by @beyer_length-weight_1991.\n\n&nbsp;\n\n# Sample Data\nI created a very simple population that consisted of lengths, weights, and ages of fish. Ages were derived from a population with roughly a 30% annual mortality rate. Mean lengths-at-age were modeled with a von Bertalanffy growth curve using a $L_{\\infty}$=650 mm, $K$=0.3, and $t_{0}$=0. Individual lengths were modeled from normal distributions using the modeled mean length and a constant standard deviation of 30 mm) within each age-class. Weights were predicted directly from a known weight-length relationship without any error (in `wt1`) and with a small amount of error (in `wt2`).\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-1_109206f25ad10862aa604c61d8eb51d4'}\n\n```{.r .cell-code}\n# Generate some lengths\nages <- 3:8\nN3 <- 100      ## number at age-3\nA <- 0.3       ## annual morality rate\nns <- round(N3*(1-A)^(ages-min(ages)),0)  ## numbers at age\nLinf <- 650    ## von B parameters\nK <- 0.3\nt0 <- 0\nmns <- Linf*(1-exp(-K*(ages-t0)))         ## mean length-at-age\nsds <- rep(30,length(mns))\nlens <- NULL\nfor (i in 1:length(ages))                 ## individual lengths-at-age\n  lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))\nloga <- -13.5  ## weight-length relationship parameters\nb <- 3.2\n# Compute weights from the W-L relationship, w/ & w/o error\ndf <- data.frame(age=rep(ages,ns),len=round(lens,0)) |>\n  mutate(wt1=round(exp(loga+b*log(len)),0),\n         wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))\nheadtail(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.output}\n#R|      age len  wt1  wt2\n#R|  1     3 374  235  197\n#R|  2     3 401  293  313\n#R|  3     3 369  225  210\n#R|  292   8 580  955  923\n#R|  293   8 605 1093 1081\n#R|  294   8 589 1003 1126\n```\n:::\n:::\n\n\nModeling data in this way is simple, but at least somewhat realistic (@fig-explore1).\n \n\n::: {.cell layout-align=\"center\" hash='index_cache/html/fig-explore1_3a33f752e65c22c0ae06e50f80086efe'}\n\n```{.r .cell-code}\nlenh <- ggplot(data=df,aes(x=len)) +\n  geom_histogram(binwidth=10,boundary=0,color=\"black\",fill=\"gray70\") +\n  scale_x_continuous(name=\"Length (mm)\") +\n  scale_y_continuous(name=\"frequency\",expand=expansion(mult=c(0,0.05)))\nlenw <- ggplot(data=df,aes(x=wt2)) +\n  geom_histogram(binwidth=25,boundary=0,color=\"black\",fill=\"gray70\") +\n  scale_x_continuous(name=\"Weight (g)\") +\n  scale_y_continuous(name=\"frequency\",expand=expansion(mult=c(0,0.05)))\nwl <- ggplot(data=df,aes(x=len,y=wt2)) +\n  geom_point(pch=21,fill=\"gray70\",color=\"black\")  +\n  scale_x_continuous(name=\"Length (mm)\") +\n  scale_y_continuous(name=\"Weight (g)\")\nal <- ggplot(data=df,aes(x=age,y=len)) +\n  geom_jitter(pch=21,fill=\"gray70\",color=\"black\",width=0.05,height=0)  +\n  scale_x_continuous(name=\"Age (years)\") +\n  scale_y_continuous(name=\"Length (mm)\")\n(lenh + lenw) / (wl + al)\n```\n\n::: {.cell-output-display}\n![Histograms of lengths (upper left) and weights (upper right) and scatterplots of weight versus length (lower left) and length versus age (lower right).](index_files/figure-html/fig-explore1-1.png){#fig-explore1 fig-align='center' fig-alt='Histograms of lengths (upper left) and weights (upper right) and scatterplots of weight versus length (lower left) and length versus age (lower right).' width=768}\n:::\n:::\n\n\n&nbsp;\n\n# Explore the Bias\nBelow the mean length (`mnlen`) and mean weight without any random erro (i.e., the \"true\" mean weight for individuals modeled above; `true.mnwt`) are calculated  (using `group_by()` and `summarize()`). The predicted mean weight at each age is then computed from the mean length at each age and the weight-length relationship (i.e., `pr.mnwt` using `mutate()` and the regression coefficient values from above). Finally a percentage error between the predicted and true mean weights is computed for each age (in `dif.minwt`).^[The `as.data.frame()` is used here because I don't like the `tibble` format that is returned by `summarize()`.]\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-3_222b792c5027029ec82a73338f942c40'}\n\n```{.r .cell-code}\nsum1 <- group_by(df,age) |>\n  summarize(mnlen=mean(len),\n            true.mnwt=mean(wt1)) |>\n  mutate(pr.mnwt=exp(loga+b*log(mnlen)),\n         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100) |>\n  as.data.frame()\n```\n:::\n\n\nThe results from this one sample show that the mean weights computed from the mean lengths and the weight-length regression (i.e., `pr.mnwt`) are lower at each age then the \"true\" mean weights (`true.mnwt`; @tbl-sum1).\n\n\n::: {#tbl-sum1 .cell layout-align=\"center\" tbl-cap='Summary table using weights without any error and no correction for the predicted mean weights.' hash='index_cache/html/tbl-sum1_97bf2688377fa2426463e750e8638b65'}\n::: {.cell-output-display}\n| age| mnlen| true.mnwt| pr.mnwt| dif.mnwt|\n|---:|-----:|---------:|-------:|--------:|\n|   3|   391|       276|     270|    -2.15|\n|   4|   454|       448|     438|    -2.23|\n|   5|   511|       644|     636|    -1.29|\n|   6|   550|       817|     806|    -1.35|\n|   7|   570|       912|     906|    -0.72|\n|   8|   594|      1034|    1028|    -0.58|\n:::\n:::\n\n\n&nbsp;\n\nOf course, weight-length relationships are not without error, so the weights with a small amount of random error were used to determine if the pattern of a negative bias when predicting mean weights from mean lengths persists with more realistic data.^[Only a small error was added because the relationship between weight and length is very strong for most fishes. The r-squared for this relationship was a realistic 0.969.] Results from this one set of more realistic data showed a similar, though not as consistent, degree of negative bias when predicting mean weights from mean lengths (@tbl-sum2).\n\n\n::: {#tbl-sum2 .cell layout-align=\"center\" tbl-cap='Summary table using weights with a small amount of error and no correction for the predicted mean weights.' hash='index_cache/html/tbl-sum2_b20e517ab859adb5772fc653f22125e6'}\n::: {.cell-output-display}\n| age| mnlen| true.mnwt| pr.mnwt| dif.mnwt|\n|---:|-----:|---------:|-------:|--------:|\n|   3|   391|       277|     270|    -2.55|\n|   4|   454|       448|     438|    -2.24|\n|   5|   511|       643|     636|    -1.12|\n|   6|   550|       830|     806|    -2.87|\n|   7|   570|       906|     906|    -0.02|\n|   8|   594|      1054|    1028|    -2.50|\n:::\n:::\n\n\n&nbsp;\n\nI then performed the analysis above 1000 times, keeping track of the percent error between the predicted weight and the true mean weight for each age for each sample.^[The code here also uses the correction factors discussed above; those results are presented further below.]\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-6_3cdf8e9d0a6565412415c08cbd580d9d'}\n\n:::\n\n\nThe results of this simulation suggest an average negative bias near 4% for age-3 fish and between about 1 and 2% for all older fish (@tbl-sim1). Note that the CV in length for each age varied between 2.7% and  9.8% in these simulations.\n\n\n::: {#tbl-sim1 .cell layout-align=\"center\" tbl-cap='Mean percentage difference in uncorrected predicted mean and true mean weights by age class for 1000 simulations.' hash='index_cache/html/tbl-sim1_959ca319176588df8bc2c7c48c0611fb'}\n::: {.cell-output-display}\n|  age3|  age4|  age5| age6|  age7|  age8|\n|-----:|-----:|-----:|----:|-----:|-----:|\n| -2.49| -1.97| -1.74| -1.5| -1.32| -1.39|\n:::\n:::\n\n\n&nbsp;\n\nSimilar patterns were found using different values of the weight-length relationship exponent $b$ (see Appendix). However, larger negative biases were observed as the standard deviation in lengths increased (see Appendix).\n\n\n# A Possible Correction\nAs noted above, @pienaar_estimating_1968 and @beyer_length-weight_1991 offered methods to reduce or eliminate the bias from using the weight-length regression to estimate mean weight-at-age from mean length-at-age. Beyer's corrections were simple as they were based on the CV of lengths and the $b$ coefficient from the weight-length regression. Beyer specifically offered three possible bias correcting factors for isometric growth, allometric growth assuming a lognormal distribution, and  allometric growth assuming a normal distributions for lengths. Here I will only consider Beyer's corrections for allometric growth with lognormal (i.e, [Beyer's equation 16](https://core.ac.uk/download/pdf/6389323.pdf)) and normal (i.e., [Beyer's equation 18](https://core.ac.uk/download/pdf/6389323.pdf)) distributions of lengths within age classes.\n\nBeyer's formulae are implemented by modifying `group_by()` and `summarize()` used previously. Specifically the standard deviation of lengths is calculated (in `sdlen`) so that the CV of lengths can be calculated (in `cvlen`). The correction factors are then computed (in `cfn` for the normal distribution and `cfl` for the lognormal distribution).\n\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-8_941a4f38fb08adf8bf1428e4dfbbf0cc'}\n\n```{.r .cell-code}\nsum2a <- group_by(df,age) |>\n  summarize(mnlen=mean(len),sdlen=sd(len),\n            true.mnwt=mean(wt2)) |>\n  mutate(cvlen=sdlen/mnlen,\n         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18\n         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16\n         pr.mnwt=exp(loga)*mnlen^b,\n         pr.mnwt.n=pr.mnwt*cfn,\n         pr.mnwt.l=pr.mnwt*cfl,\n         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,\n         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,\n         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) |>\n  as.data.frame()\n```\n:::\n\n\nThese calculations were again repeated 1000 times and summarized in the bottom two rows of @tbl-sim2. These results suggest that the mean bias in predicted weights at age when corrected with a correction factor appear to only be on the order of a quarter to a half a percent. These corrections seems to perform fairly consistently across a few different values of the weight-length regression exponent $b$ and standard deviations in lengths (see Appendix).\n\n\n::: {#tbl-sim2 .cell layout-align=\"center\" tbl-cap='Mean percentage difference in two types of corrected predicted mean and true mean weights by age class for 1000 simulations.' hash='index_cache/html/tbl-sim2_54ab29081ffef6096e62478c5d4d96ac'}\n::: {.cell-output-display}\n|                   |  age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|-----:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -2.49| -1.97| -1.74| -1.50| -1.32| -1.39|\n|Normal (eqn 18)    | -0.43| -0.45| -0.52| -0.45| -0.35| -0.49|\n|Lognormal (eqn 16) | -0.41| -0.45| -0.51| -0.44| -0.35| -0.48|\n:::\n:::\n\n\n&nbsp;\n\n# Why Worry About This?\nWhy am I worried about this if the bias is on the order of 4% or less? First, for my application, we are estimating mean weight so that we can expand to total biomass. While a 4% error on an individual fish may seem inconsequential, that error can become quite important when expanded to represent total biomass, especially when it is a consistent negative bias.\n\nSo, why worry about correction factors when I can easily predict the weight for individual fish with the weight-length regression and then summarize these fish to get mean weight at age? In my situation, it appears that some of our mean lengths at age, and by extension mean weights at age, are poorly estimated because of small sample sizes at some ages. I am considering fitting a growth model (e.g., von Bertalanffy growth model) to the length-at-age data such that the fitted model can be used to predict mean lengths at age. The advantage of this is that information at other ages can be used to inform the calculation of mean length at an age. [*The potential downside, of course, is that I would be prescribing a smooth curve to the growth trajectory.*] If I can then estimate mean weights at age with minimal bias from the mean lengths at age from the growth model, then this could (I would need to test this) be beneficial in my situation.\n\n&nbsp;\n\n# Summary\nMean weights at age appear to be estimated with bias when a weight-length relationship is applied to mean lengths at age without any correction factor. The correction factors suggested by @beyer_length-weight_1991 are easy to implement and seem to reduce the bias in predicted mean weights-at-age to near negligible levels. Thus, if mean weights at age cannot be predicted from individual fish, then it may be possible to get reasonable estimates from the weight-length relationship and mean lengths at age.\n\n&nbsp;\n\n# References\n\n::: {#refs}\n:::\n\n&nbsp;\n\n# Appendix: Summaries Using Different Values of b and SDs\n\n\n::: {.cell layout-align=\"center\" tbl-cap='Summary table with everything the same but b=2.5.' hash='index_cache/html/simb25_3842d1c7e0694ae8e01d1a4238715beb'}\n::: {.cell-output-display}\n|                   |  age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|-----:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -1.55| -1.28| -1.06| -0.91| -0.84| -0.90|\n|Normal (eqn 18)    | -0.43| -0.47| -0.39| -0.34| -0.33| -0.43|\n|Lognormal (eqn 16) | -0.43| -0.47| -0.39| -0.34| -0.33| -0.43|\n:::\n:::\n\n\n&nbsp;\n\n\n::: {.cell layout-align=\"center\" tbl-cap='Summary table with everything the same but b=3.0.' hash='index_cache/html/simb3_92a9b61491e4dca0dd84b69796528480'}\n::: {.cell-output-display}\n|                   |  age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|-----:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -2.21| -1.74| -1.48| -1.38| -1.16| -1.17|\n|Normal (eqn 18)    | -0.44| -0.46| -0.42| -0.48| -0.34| -0.39|\n|Lognormal (eqn 16) | -0.42| -0.46| -0.42| -0.48| -0.33| -0.39|\n:::\n:::\n\n\n&nbsp;\n\n\n::: {.cell layout-align=\"center\" tbl-cap='Summary table with everything the same but b=3.5.' hash='index_cache/html/simb35_518a65e8c1527f959c80e84bda51c836'}\n::: {.cell-output-display}\n|                   |  age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|-----:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -3.07| -2.29| -2.04| -1.73| -1.59| -1.50|\n|Normal (eqn 18)    | -0.47| -0.42| -0.52| -0.41| -0.40| -0.40|\n|Lognormal (eqn 16) | -0.45| -0.41| -0.51| -0.40| -0.39| -0.39|\n:::\n:::\n\n\n&nbsp;\n\n\n::: {.cell layout-align=\"center\" tbl-cap='Summary table with everything the same but SDs at 50.' hash='index_cache/html/sims50_ba31eac60e07bf8c46e8e1679d85653a'}\n::: {.cell-output-display}\n|                   |  age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|-----:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -5.98| -4.50| -3.82| -3.32| -2.93| -2.75|\n|Normal (eqn 18)    | -0.38| -0.46| -0.48| -0.42| -0.28| -0.28|\n|Lognormal (eqn 16) | -0.26| -0.40| -0.44| -0.39| -0.25| -0.26|\n:::\n:::\n\n\n&nbsp;\n\n\n::: {.cell layout-align=\"center\" tbl-cap='Summary table with everything the same but SDs at 70.' hash='index_cache/html/sims70_fde22b8887e6bbcda78c534c1d2c08ed'}\n::: {.cell-output-display}\n|                   |   age3|  age4|  age5|  age6|  age7|  age8|\n|:------------------|------:|-----:|-----:|-----:|-----:|-----:|\n|No correction      | -10.66| -8.03| -6.71| -5.84| -5.20| -4.96|\n|Normal (eqn 18)    |  -0.36| -0.36| -0.44| -0.30| -0.23| -0.27|\n|Lognormal (eqn 16) |   0.09| -0.12| -0.28| -0.17| -0.13| -0.18|\n:::\n:::\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/unnamed-chunk-15_120def9e6a772972ed0311302b3776de'}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}