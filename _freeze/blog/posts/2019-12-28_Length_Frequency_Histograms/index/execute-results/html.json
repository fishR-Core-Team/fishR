{
  "hash": "31f29911bd29f7117403573a88c3f8fe",
  "result": {
    "markdown": "---\ntitle: \"Length Frequency Histograms in ggplot2\"\ndescription: \"How to construct length frequency histograms using ggplot2\"\nauthor: \"Derek H. Ogle\"\ndate: \"12/28/2019\"\nimage: \"preview.png\"\ncategories:\n  - Length Frequency\n  - Size\n  - Histogram\n  - ggplot2\n---\n\n\n&nbsp;\n\n:::{.callout-note}\nThe following packages are loaded for use below. I also set the default `ggplot` theme to `theme_bw()` for a classic \"black-and-white\" plot (rather than the default plot with a gray background).\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ntheme_set(theme_bw())\n```\n:::\n\n\n&nbsp;\n\n# Introduction\nA common graphic produced by many fisheries scientists is a length frequency histogram. As it turns out there are a few \"tricks\" to make a length frequency histogram appear as I expect most fisheries folks would want it to appear -- primarily, left-inclusive (i.e., 100 would be in the 100-110 bin and not the 90-100 bin). In this post, I show how to construct a length frequency histograms with `ggplot2` using my preferences.\n\nThe data are lengths of Lake Erie Walleye (*Sander vitreus*) captured during October-November, 2003-2014.^[These data are available in the [`FSAdata` package](https://fishr-core-team.github.io/FSAdata/index.html) and formed many of the examples in Chapter 12 of the [**Age and Growth of Fishes: Principles and Techniques book**](https://derekogle.com/AGF/).] My primary interest is in the `tl` (total length in mm), `sex`, and `loc` variables^[[See here for more details](https://fishr-core-team.github.io/FSAdata/reference/WalleyeErie2.html)] and I will focus on 2014 (as an example).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata(WalleyeErie2,package=\"FSAdata\")\nWE <- dplyr::filter(WalleyeErie2,year==2014)\n```\n:::\n\n\n&nbsp;\n\n# Basic Length Frequency\nMaking the histogram (@fig-hist1) begins by identifying the data frame to use in `data=` and the `tl` variable to use for the `x`-axis as an `aes()`thetic in `ggplot()`. The histogram is then constructed with `geom_hist()`, which I customize as follows:\n\n* Set the width of the length bins with `binwidth=`.\n* By default the bins are *centered* on breaks created from `binwidth=`. The bins can be changed to *begin* on these breaks by using `boundary=` set to the desired value of a first break, regardless of whether that break is in the data or not. I use `boundary=0` so that bins will start on breaks that make sense relative to `binwidth=` (e.g., 0, 25, 50, 75, etc.).\n* Bins are left-exclusive and right-inclusive by default. Use `closed=\"left\"` to make the bins the desired left-inclusive and right-exclusive.\n* The fill color of the bins is set with `fill=` (I prefer a slight gray).\n* The outline color of the bins is set with `color=` (defaults to the same as `fill=`; I prefer a dark boundary to make the bins obvious).\n\nThe `scale_y_continuous()` and `scale_x_continuous()` are primarily used to provide labels (i.e., `name`s) for the y- and x-axes, respectively. By default, the bins of the histogram will \"hover\" slightly above the x-axis, which I find annoying. The `expand=` in `scale_y_continuous()` is used to expand the lower limit of the y-axis by a `mult`iple of 0 (thus, not expand the lower-limit) and expand the upper limit of the y-axis by a `mult`iple of 0.05 (thus, the upper-limit will by 5% higher than the tallest bin so that the top frame of the plot will not touch the tallest bin).^[The resultant plot was assigned to an object so that name must be typed and run to see the plot.]\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlenfreq1 <- ggplot(data=WE,aes(x=tl)) +\n  geom_histogram(binwidth=25,boundary=0,closed=\"left\",\n                 fill=\"gray80\",color=\"black\") +\n  scale_y_continuous(name=\"Number of Fish\",expand=expansion(mult=c(0,0.05))) +\n  scale_x_continuous(name=\"Total Length (mm)\")\nlenfreq1\n```\n\n::: {.cell-output-display}\n![Length frequency of histogram of Lake Erie Walleye, 2014.](index_files/figure-html/fig-hist1-1.png){#fig-hist1 fig-align='center' fig-alt='Length frequency of histogram of Lake Erie Walleye, 2014.' width=336}\n:::\n:::\n\n\nThis base object/plot can be modified by adding (using `+`) to it as demonstrated later.\n\n&nbsp;\n\n# Stacked by Other Variable\nIt may be useful to see the distribution of categories of fish (e.g., sex) within the length frequency bins (@fig-hist2). To do this, add `fill=` in the `aes()`thetic in `ggplot()` and set it equal to the variable that identifies the separation within each bin (e.g., `sex`). The bins will be stacked by this variable if `position=\"stack\"` in `geom_histogram()`.^[This is the default and would not need to be explicitly set below).] The fill colors for each group can be set in a number of ways, but they are set manually below with `scale_fill_manual()`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlenfreq2 <- ggplot(data=WE,aes(x=tl,fill=sex)) +\n  geom_histogram(binwidth=25,boundary=0,closed=\"left\",\n                 color=\"black\",position=\"stack\") +\n  scale_fill_manual(values=c(\"gray80\",\"gray40\")) +\n  scale_y_continuous(name=\"Number of Fish\",expand=expansion(mult=c(0,0.05))) +\n  scale_x_continuous(name=\"Total Length (mm)\")\nlenfreq2\n```\n\n::: {.cell-output-display}\n![Length frequency histogram of Lake Erie Walleye 2014 stacked by sex.](index_files/figure-html/fig-hist2-1.png){#fig-hist2 fig-align='center' fig-alt='Length frequency histogram of Lake Erie Walleye 2014 stacked by sex.' width=432}\n:::\n:::\n\n\nStacked histograms are difficult to interpret in my opinion. In a future post, I will show how to use empirical density functions to examine distributions among categories. For the time being, see below.\n\n&nbsp;\n\n# Separated by Other Variable(s)\nA strength of `ggplot2` is that it can easily make the same plot for several different levels of another variable; e.g., separate length frequency histograms by sex (@fig-hist3a). The plot (e.g., `lenfreq` from above) can be separated into different \"facets\" with `facet_wrap()`, which takes the variable to separate by within `vars()` as the first argument.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlenfreq1 + facet_wrap(vars(sex))\n```\n\n::: {.cell-output-display}\n![Length frequency histogram of Lake Erie Walleye 2014 separated by sex.](index_files/figure-html/fig-hist3a-1.png){#fig-hist3a fig-align='center' fig-alt='Length frequency histogram of Lake Erie Walleye 2014 separated by sex.' width=672}\n:::\n:::\n\n\nIf the faceted groups have very different sample sizes then it may be useful to use a potentially different y-axis scale for each facet by including `scales=\"free_y\"` in `facet_wrap()` (@fig-hist3b). Similarly, a potentially different scale can be used for each x-axis with `scales=\"free_x\"` or for both axes with `scales=\"free\"`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlenfreq1 + facet_wrap(vars(sex),scales=\"free_y\")\n```\n\n::: {.cell-output-display}\n![Length frequency histogram of Lake Erie Walleye 2014 separated by sex with different frequency scales.](index_files/figure-html/fig-hist3b-1.png){#fig-hist3b fig-align='center' fig-alt='Length frequency histogram of Lake Erie Walleye 2014 separated by sex with different frequency scales.' width=672}\n:::\n:::\n\n\nPlots may be faceted over multiple variables with `facet_grid()` (@fig-hist4), where the variables that identify the rows and variables for a grid of facets are included (within `vars()`) in `rows=` and `cols=`, respectively. Both scales can **not** be \"free\" with `facet_grid()`, the scale can only be \"free\" within a row or column.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlenfreq1 + facet_grid(rows=vars(loc),cols=vars(sex),scales=\"free_y\")\n```\n\n::: {.cell-output-display}\n![Length frequency histogram of Lake Erie Walleye 2014 separated by sex and location of capture with different frequency scales.](index_files/figure-html/fig-hist4-1.png){#fig-hist4 fig-align='center' fig-alt='Length frequency histogram of Lake Erie Walleye 2014 separated by sex and location of capture with different frequency scales.' width=768}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}