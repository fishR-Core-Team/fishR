<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>fishR</title>
<link>https://fishr-core-team.github.io/fishR/blog/</link>
<atom:link href="https://fishr-core-team.github.io/fishR/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>Posts using R for fisheries analyses</description>
<generator>quarto-1.6.37</generator>
<lastBuildDate>Wed, 08 Jan 2025 06:00:00 GMT</lastBuildDate>
<item>
  <title>FSA Analyses for Multiple Groups</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>A year or so ago a user of <code>FSA</code> asked me if there was a way to use <code>group_by()</code> from <code>dplyr()</code> with <code>removal()</code> from <code>FSA</code> to efficiently estimate fish abundance from removal data for multiple groups. There was not, as far as either of us could tell. My naive impression was that I would need a new version of <code>removal()</code> that used formula notation with a <code>data=</code> argument. So, I modified removal to use a formula and <code>data=</code>.</p>
<p>However, this was not an adequate solution because I did not want to change the contents of the list that was returned from <code>removal()</code>. Furthermore required both <code>coef()</code> and <code>confint()</code> (S3 extractor functions for <code>removal()</code>) to extract the results the user wanted from this list. My solution for this was to modify <code>confint()</code> with <code>incl.est=</code> that would append the confidence intervals to the point estimate (extracted with <code>coef()</code>) when set to <code>TRUE</code>.</p>
<p>However, <code>confint()</code> returned a matrix which I found difficult to work with within any of the <code>dplyr</code> functions. Thus, I further modified <code>confint()</code><sup>1</sup> with <code>as.df=</code> to return a data.frame rather than a matrix when set to <code>TRUE</code>. Both <code>incl.est=</code> and <code>as.df=</code> default to <code>FALSE</code> so that the original functionality is maintained (by default).<sup>2</sup> Thus, to get the new functionality both <code>incl.est=</code> and <code>as.df=</code> must be explicitly set to <code>TRUE</code> by the user.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;And <code>coef()</code> and <code>summary()</code> while I was at it.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Trying not to break user’s legacy code.</p></div></div><p>These changes seemed to meet the user’s request. Thus, I made similar changes to <code>depletion()</code>, <code>catchCurve()</code>, and <code>chapmanRobson()</code>. In this post, I demonstrate how these new functions work vis-a-vis helper functions from <code>dplyr</code> (and, briefly, <code>purrr</code>).</p>
<p>The following packages are loaded for use below. Note that the modified <code>removal()</code>, <code>depletion()</code>, <code>catchCurve()</code>, and <code>chapmanRobson()</code> functionality <strong>requires FSA v0.9.6 or higher</strong>.<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;This version is at CRAN being processed when this post was written.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for depletion(), removal(), catchCurve(), chapmanRobson(), headtail()</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, tidyr</span></span></code></pre></div>
</div>
</section>
<section id="abundance" class="level1 page-columns page-full">
<h1>Abundance</h1>
<section id="removal-estimates" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="removal-estimates">Removal Estimates</h2>
<p>The new functionality of <code>removal()</code> is demonstrated with the user’s (partial) data, entered manually below.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;I usually enter data into a CSV file external to R. This is for demonstration only.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lake=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ash Tree"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bark"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clay"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)),</span>
<span id="cb2-2">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011"</span>),</span>
<span id="cb2-3">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))),</span>
<span id="cb2-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pass=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)),</span>
<span id="cb2-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-6">d</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         lake year pass catch
#R|  1  Ash Tree 2010    1    57
#R|  2  Ash Tree 2010    2    34
#R|  3  Ash Tree 2011    1    65
#R|  4  Ash Tree 2011    2    34
#R|  5  Ash Tree 2011    3    12
#R|  6      Bark 2010    1    54
#R|  7      Bark 2010    2    26
#R|  8      Bark 2010    3     9
#R|  9      Bark 2011    1    54
#R|  10     Bark 2011    2    27
#R|  11     Clay 2010    1    67
#R|  12     Clay 2010    2    34
#R|  13     Clay 2011    1    68
#R|  14     Clay 2011    2    35
#R|  15     Clay 2011    3    12</code></pre>
</div>
</div>
<p>There are several things to note with these data. First, they are in “long” format where each row corresponds to one observation – in this case the catch of fish on a particular <code>pass</code> within a given <code>year</code> and <code>lake</code>. Second, the user wanted to estimated abundance from catches (i.e., removal) on multiple passes for all possible lake-year combinations; thus, “group” is defined by the combination of <code>lake</code> and <code>year</code>. Third, the number of passes was not consistent, with some year-lake combinations having two and others having three passes. This is not an issue as long as a removal method is used that can handle both numbers of removal. The default Carle-Strub method<sup>5</sup> will be used here, so this will not be an issue. Fourth, it is important when data are in “long” format like this that the passes are ordered consecutively from first to last. That is the case here, but if it was not then the data.frame would need to be sorted on <code>pass</code> (within <code>lake</code> and <code>year</code>).</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;See <code>method=</code> argument in <code>removal()</code> for other methods.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;If the variable is not called <code>catch</code> as it is here, then replace with the actual variable name.</p></div></div><p><code>removal()</code> from <code>FSA</code> is used to compute estimates of initial population abundance (No) and probability of capture (p) by using a formula of the form <code>~catch</code> with the data.frame containing the variable in <code>data=</code>.<sup>6</sup> The result of this function is assigned to an object which is then given to <code>confint()</code> to extract confidence intervals for the parameters. Including <code>incl.est=TRUE</code> in <code>confint()</code> will include the point estimate in the result. Below is an example of using <code>depletion()</code> for just Ash Tree lake in 2010.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">removal</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(d,lake<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ash Tree"</span>,year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010"</span>))</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|             Est    95% LCI     95% UCI
#R|  No 130.0000000 78.8281665 181.1718335
#R|  p    0.4482759  0.2107166   0.6858351</code></pre>
</div>
</div>
<p>The object returned by <code>confint()</code> is a matrix by default, which generally prints nicely. However, the result may be returned as a data.frame, which as described previously will be needed with the <code>dplyr</code> functions used below, by including <code>as.df=TRUE</code> in <code>confint()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     No   No.LCI   No.UCI         p     p.LCI     p.UCI
#R|  1 130 78.82817 181.1718 0.4482759 0.2107166 0.6858351</code></pre>
</div>
</div>
<p><code>removal()</code> can be used to compute parameter estimates for multiple groups by first giving the variable or variables that identify groups to <code>group_by()</code> and then giving that to <code>group_modify()</code> from <code>dplyr</code>. The first argument to <code>group_modify()</code>, when piped together with <code>%&gt;%</code>, is an expression that begins with <code>~</code> followed by a call to <code>removal()</code> nested within a call to <code>confint()</code>. In the <code>removal()</code> call <code>data=</code> <strong>must</strong> be set to <code>.x</code>. The call to <code>confint()</code> should include <code>incl.est=TRUE</code> to get the point estimates of the parameters and <strong>must</strong> include <code>as.df=TRUE</code> for <code>group_modify()</code> to work properly.<sup>7</sup> Below I submit the result to <code>as.data.frame()</code> simply to remove the grouping structure and tibble class.<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;<code>group_modify()</code> requires the function defined after the <code>~</code> to return a data.frame.</p></div><div id="fn8"><p><sup>8</sup>&nbsp;I prefer to work with data.frames rather than tibbles.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(lake,year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_modify</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">removal</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>.x),</span>
<span id="cb8-4">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes tibble and grouping structure</span></span></code></pre></div>
</div>
<p>For display purposes, the results for the two parameters are rounded to different numbers of <code>digits</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        lake year  No No.LCI No.UCI     p p.LCI p.UCI
#R|  1 Ash Tree 2010 130     79    181 0.448 0.211 0.686
#R|  2 Ash Tree 2011 121    110    132 0.558 0.440 0.676
#R|  3     Bark 2010  95     87    103 0.589 0.464 0.715
#R|  4     Bark 2011 103     74    132 0.533 0.314 0.752
#R|  5     Clay 2010 130     96    164 0.523 0.324 0.723
#R|  6     Clay 2011 125    114    136 0.564 0.449 0.679</code></pre>
</div>
</div>
</section>
<section id="depletion-estimates" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="depletion-estimates">Depletion Estimates</h2>
<p>The <code>Pathfinder</code> data<sup>9</sup> from <code>FSAdata</code> contains the catch and effort for three Snapper species (<em>Pristipomoides zonatus</em>, <em>Pristipomoides auricilla</em>, and <em>Etelis carbunculUs</em>) in a depletion experiment around Pathfinder Reef in the Mariana Archipelago. <span class="citation" data-cites="polovina_1985">Polovina (1985)</span> used these data to demonstrate the need for a Leslie depletion model with variable recruitment (as was evident for <em>Pristipomoides auricilla</em>). Here these data are used to demonstrate how to efficiently compute population (No) and catchability (q) estimates for each species using <code>depletion()</code> from <code>FSA</code> with help from <code>dplyr</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;<a href="https://fishr-core-team.github.io/FSAdata/reference/Pathfinder.html">See description here</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(Pathfinder,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(Pathfinder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       date effort Pzonatus Pauricilla Ecarbunculus
#R|  1  10-Apr   27.5       98         12           42
#R|  2  11-Apr   23.7      111         17           22
#R|  3  12-Apr   21.3       47         12           41
#R|  11  5-May   20.3       40         29           13
#R|  12  6-May   22.8       35         35           21
#R|  13  7-May   24.1       30         27           15</code></pre>
</div>
</div>
<p>The data are provided in “wide” format where the catch of each species is presented as a column or variable in <code>Pathfinder</code>. The methods used below require data to be in “long” format where each row corresponds to one observation – in this case catch (and effort and other associated date) for one species (on one day). In some cases the data may have been entered in long format, but when it is not it must be converted to long format for the process used below.</p>
<p>There are several methods for converting from wide to long formats. In my mind, one of the easiest is <code>pivot_longer()</code> from <code>tidyr</code>.<sup>10</sup> The names of columns that contain the values to be converted from wide to long are given to <code>cols=</code>. In this example, that will be the columns containing the catches of the separate species. Because those columns are contiguous in the original data.frame they can be referred to <em>en masse</em> by separating the name of the left-most column from the name for the right-most column with a colon. The three catch columns from the original data.frame will be moved to two columns in the resulting data.frame – one with the catch values and one with the spcies names. A name for the column of names can be given to <code>names_to=</code> and a name for the values column can be given to <code>values_to=</code>. Thus, <code>Pathfinder</code> is converted from wide to long format below.</p>
<div class="no-row-height column-margin column-container"><div id="fn10"><p><sup>10</sup>&nbsp;Some alternatives are <code>reshape()</code> from base R and <code>melt()</code> from <code>reshape2</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">Pathfinder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Pathfinder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span>Pzonatus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Ecarbunculus,</span>
<span id="cb13-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"catch"</span>)</span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(Pathfinder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  tibble [39 × 4] (S3: tbl_df/tbl/data.frame)
#R|   $ date   : Factor w/ 13 levels "10-Apr","11-Apr",..: 1 1 1 2 2 2 3 3 3 4 ...
#R|   $ effort : num [1:39] 27.5 27.5 27.5 23.7 23.7 23.7 21.3 21.3 21.3 29.7 ...
#R|   $ species: chr [1:39] "Pzonatus" "Pauricilla" "Ecarbunculus" "Pzonatus" ...
#R|   $ catch  : int [1:39] 98 12 42 111 17 22 47 12 41 91 ...</code></pre>
</div>
</div>
<p>Once the data are in long format, <code>depletion()</code> can be used within <code>group_modify()</code> as shown for <code>removal()</code>. However, note that <code>depletion()</code> requires a formula of the form <code>catch~effort</code> and that groups are defined by only the single variable <code>species</code> here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Pathfinder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-3">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_modify</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">depletion</span>(catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>effort,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>.x),</span>
<span id="cb15-4">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes tibble and grouping structure</span></span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         species   No No_LCI No_UCI            q        q_LCI         q_UCI
#R|  1 Ecarbunculus  571    224    918  0.002499027  0.000399448  0.0045986060
#R|  2   Pauricilla -165     34   -363 -0.003134290 -0.005368398 -0.0009001819
#R|  3     Pzonatus 1062    795   1328  0.003678569  0.002225597  0.0051315404</code></pre>
</div>
</div>
</section>
</section>
<section id="mortality" class="level1 page-columns page-full">
<h1>Mortality</h1>
<section id="catch-curves" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="catch-curves">Catch Curves</h2>
<p>A similar process can be followed with <code>catchCurve()</code> to estimate mortality for several groups. However, the “long” format data.frame either needs to contain only data for ages on the descending limb for each group or groups that have the same ages on the descending limb. Both instances are illustrated below.</p>
<p><code>FHCatfish</code> from <code>FSAdata</code><sup>11</sup> contains numbers of Flathead Catfish (<em>Pylodictis olivaris</em>) captured by electrofishing in three rivers – Coosa River, AL; Ocmulgee River, GA; and Satilla River, GA – for ages <strong>ONLY</strong> on the descending limb of the catch curve.</p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;<a href="https://fishr-core-team.github.io/FSAdata/reference/FHCatfish.html">See description here.</a></p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(FHCatfish,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(FHCatfish)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       river age abundance
#R|  1    Coosa   2        25
#R|  2    Coosa   3        24
#R|  3    Coosa   4        18
#R|  37 Satilla   6         1
#R|  38 Satilla   7         1
#R|  39 Satilla  10         1</code></pre>
</div>
</div>
<p>The process here is essentially the same as it was for <code>depletion()</code> except noting that <code>catchCurve()</code> uses a formula of the form <code>catch~age</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FHCatfish <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(river) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_modify</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(abundance<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>.x),</span>
<span id="cb20-4">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes tibble and grouping structure</span></span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       river     Z Z_LCI Z_UCI    A A_LCI A_UCI
#R|  1    Coosa 0.164 0.123 0.205 15.1  11.5  18.5
#R|  2 Ocmulgee 0.269 0.194 0.344 23.6  17.6  29.1
#R|  3  Satilla 0.683 0.195 1.171 49.5  17.7  69.0</code></pre>
</div>
</div>
<p><code>WalleyeKS</code> from <code>FSAdata</code> contains the catch of Walleye at all observed ages in eight reservoirs in Kansas.<sup>12</sup> The descending limb was determined to start at age-2 for fish from each reservoir, even though other ages appear in the data.frame. Thus, <code>ages2use=</code> must be used in <code>catchCurve()</code> to identify the ages on the descending limb. Here a sequence of ages beginning with 2 and ending with the maximum observed age was used.<sup>13</sup> Otherwise the code below is similar to that above.</p>
<div class="no-row-height column-margin column-container"><div id="fn12"><p><sup>12</sup>&nbsp;<a href="https://fishr-core-team.github.io/FSAdata/reference/WalleyeKS.html">See description here.</a></p></div><div id="fn13"><p><sup>13</sup>&nbsp;This will result in a sequence of warnings from <code>catchCurve()</code> as some of the groups do not have fish of the maximum age.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WalleyeKS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(WalleyeKS)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  'data.frame':  66 obs. of  3 variables:
#R|   $ reservoir: Factor w/ 8 levels "Cedar.Bluff",..: 1 1 1 1 1 1 1 1 2 2 ...
#R|   $ age      : int  0 1 2 3 4 5 6 7 0 1 ...
#R|   $ catch    : int  78 70 104 52 33 13 4 2 131 28 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">( maxage <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(WalleyeKS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WalleyeKS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(reservoir) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_modify</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>.x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ages2use=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb27-4">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes tibble and grouping structure</span></span>
<span id="cb27-6"></span>
<span id="cb27-7">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-8">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-9">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      reservoir     Z Z_LCI Z_UCI    A A_LCI A_UCI
#R|  1 Cedar.Bluff 0.811 0.664 0.958 55.6  48.5  61.6
#R|  2      Cheney 0.551 0.174 0.928 42.4  16.0  60.5
#R|  3  Glen.Elder 0.855 0.516 1.194 57.5  40.3  69.7
#R|  4      Kirwin 0.941 0.493 1.388 61.0  38.9  75.1
#R|  5    Lovewell 0.544 0.279 0.809 41.9  24.3  55.5
#R|  6      Marion 0.613 0.346 0.879 45.8  29.3  58.5
#R|  7     Webster 0.567 0.132 1.002 43.3  12.4  63.3
#R|  8      Wilson 0.719 0.555 0.884 51.3  42.6  58.7</code></pre>
</div>
</div>
</section>
<section id="chapman-robson" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="chapman-robson">Chapman-Robson</h2>
<p>The process for the Chapman-Robson method is the same as that for the catch-curve except that <code>chapmanRobson()</code> is used instead of <code>catchCurve()</code>.<sup>14</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn14"><p><sup>14</sup>&nbsp;Also note that S is returned rather than A.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WalleyeKS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(reservoir) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_modify</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chapmanRobson</span>(catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>.x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ages2use=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb29-4">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes tibble and grouping structure</span></span>
<span id="cb29-6"></span>
<span id="cb29-7">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-8">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-9">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      reservoir    S S_LCI S_UCI     Z Z_LCI Z_UCI
#R|  1 Cedar.Bluff 46.9  42.0  51.9 0.754 0.662 0.846
#R|  2      Cheney 53.5  48.1  58.9 0.623 0.162 1.085
#R|  3  Glen.Elder 45.1  42.7  47.4 0.796 0.665 0.927
#R|  4      Kirwin 39.0  31.1  47.0 0.930 0.732 1.129
#R|  5    Lovewell 59.5  56.6  62.3 0.519 0.215 0.823
#R|  6      Marion 59.2  56.5  61.9 0.524 0.308 0.739
#R|  7     Webster 57.7  50.8  64.7 0.546 0.361 0.731
#R|  8      Wilson 47.1  42.7  51.5 0.751 0.583 0.919</code></pre>
</div>
</div>
</section>
</section>
<section id="example-using-purrr" class="level1">
<h1>Example Using purrr</h1>
<p>It is also possible to use <code>purrr</code> functions with these new <code>FSA</code> functions, though I am not sure that it is more convenient. Here <code>purrr</code> is used to repeat the Chapman-Robson results from above.</p>
<p>First, a new function must be declared that combines the <code>confint()</code> and <code>chapmanRobson()</code> functions, making sure to include <code>incl.est=TRUE</code> and <code>as.df=TRUE</code>. Note that <code>x=x</code> is used because the argument o <code>chapmanRobson()</code> that takes the formulas is <code>x=</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">chapmanRobson2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x,...) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chapmanRobson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,...),</span>
<span id="cb31-2">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.est=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as.df=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)}</span></code></pre></div>
</div>
<p>The long form data.frame is then split by groups into a list with a data.frame for each group. Here <code>WalleyeKS</code> is split on <code>reservoir</code> with <code>split()</code>, but <code>split()</code> requires the “splitting variable” to be a factor so <code>reservoir</code> was coerced to a factor below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">WalleyeKS_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(WalleyeKS,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(WalleyeKS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>reservoir))</span></code></pre></div>
</div>
<p><code>map_df()</code> from <code>purrr</code> takes the list as the first argument and the function to apply to each item in the list as the second argument (i.e., our new <code>chapmanRobson2()</code>) and returns a data.frame. The <code>x=</code> is the formula of form <code>catch~age</code> and the <code>ages2use=</code> to be given to <code>chapmanRobson</code>. The <code>.id=</code> provides a name for the group variable in the data.frame returned by <code>map_df()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(WalleyeKS_list,chapmanRobson2,</span>
<span id="cb33-2">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age,</span>
<span id="cb33-3">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ages2use=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,</span>
<span id="cb33-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reservoir"</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>), \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      reservoir    S S_LCI S_UCI     Z Z_LCI Z_UCI
#R|  1 Cedar.Bluff 46.9  42.0  51.9 0.754 0.662 0.846
#R|  2      Cheney 53.5  48.1  58.9 0.623 0.162 1.085
#R|  3  Glen.Elder 45.1  42.7  47.4 0.796 0.665 0.927
#R|  4      Kirwin 39.0  31.1  47.0 0.930 0.732 1.129
#R|  5    Lovewell 59.5  56.6  62.3 0.519 0.215 0.823
#R|  6      Marion 59.2  56.5  61.9 0.524 0.308 0.739
#R|  7     Webster 57.7  50.8  64.7 0.546 0.361 0.731
#R|  8      Wilson 47.1  42.7  51.5 0.751 0.583 0.919</code></pre>
</div>
</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-polovina_1985" class="csl-entry">
Polovina, J. J. 1985. A variable catchability version of the <span>Leslie</span> model with application to an intensive fishing experiment on a multispecies stock. Fishery Bulletin 84:423–428.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h._ogle2025,
  author = {H. Ogle, Derek},
  title = {FSA {Analyses} for {Multiple} {Groups}},
  date = {2025-01-08},
  url = {https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h._ogle2025" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2025, January 8. FSA Analyses for Multiple Groups. <a href="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/">https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/</a>.
</div></div></section></div> ]]></description>
  <category>Abundance</category>
  <category>Catch Curve</category>
  <category>Depletion</category>
  <category>Removal</category>
  <category>group_by</category>
  <category>purrr</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/</guid>
  <pubDate>Wed, 08 Jan 2025 06:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-8_FSA_Mult_Groups/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Age-Length Key Plots</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>It is often important to examine the structure of an age-length key to ascertain its utility. The plots created with <code>alkPlot()</code> from <code>FSA</code> (<a href="https://fishr-core-team.github.io/FSA/reference/alkPlot.html#ref-examples">see here</a>) provide a quick method to create useful plots for this purpose. However, those plots are generally not of “publication-quality” and because some characteristics of the plots are hard-coded in the function, they are difficult (if not impossible) to customize. Modifying <code>alkPlot()</code> to be more flexible looked to require more work than benefit to be gained. Thus, here, I will demonstrate how to make similar plots using <code>ggplot2</code> that will allow the user great flexibility for customizing the plots for publication (or exploration).</p>
<p>The following packages are loaded for use below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, tibble, and ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for lencat(), fact2num(), alkPlot() and WR79 data</span></span></code></pre></div>
</div>
<p>I made a simple <code>ggplot2</code> theme for use below. This can be modified as described, for example, <a href="https://fishr-core-team.github.io/fishR/blog/posts/2022-12-22_AFS_Style_Figures/">here</a> to further alter the overall appearance of the plots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">theme_ALK <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(...) {</span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(...) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb2-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-6">} </span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="construct-example-age-length-key" class="level1 page-columns page-full">
<h1>Construct Example Age-Length Key</h1>
<p>This post uses the same <code>WR79</code> from <code>FSA</code> (<a href="https://fishr-core-team.github.io/FSA/reference/WR79.html">described here</a>) to create the same age-length key used in <a href="https://fishr-core-team.github.io/FSA/reference/alkPlot.html#ref-examples">the examples</a> for <code>alkPlot()</code>. The age-length key from these data is created below as demonstrated in <a href="https://derekogle.com/IFAR/">Introductory Fisheries Analsyses with R</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">WR.age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">droplevels</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(WR79, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(age)))</span>
<span id="cb3-2">WR.age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>LCat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lencat</span>(WR.age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-3">raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>LCat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>WR.age)</span>
<span id="cb3-4">WR.key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(raw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(WR.key,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       age
#R|  LCat      4     5     6     7     8     9    10    11
#R|    35  1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    40  1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    45  1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    50  1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    55  1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    60  0.600 0.400 0.000 0.000 0.000 0.000 0.000 0.000
#R|    65  0.000 1.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    70  0.000 1.000 0.000 0.000 0.000 0.000 0.000 0.000
#R|    75  0.000 0.889 0.111 0.000 0.000 0.000 0.000 0.000
#R|    80  0.000 0.250 0.750 0.000 0.000 0.000 0.000 0.000
#R|    85  0.000 0.000 0.909 0.091 0.000 0.000 0.000 0.000
#R|    90  0.000 0.000 0.263 0.632 0.105 0.000 0.000 0.000
#R|    95  0.000 0.000 0.059 0.706 0.176 0.000 0.059 0.000
#R|    100 0.000 0.000 0.000 0.556 0.167 0.278 0.000 0.000
#R|    105 0.000 0.000 0.000 0.286 0.429 0.143 0.143 0.000
#R|    110 0.000 0.000 0.000 0.200 0.200 0.200 0.200 0.200
#R|    115 0.000 0.000 0.000 0.000 0.000 0.000 1.000 0.000</code></pre>
</div>
</div>
<p>This age-length key is converted to a data.frame for plotting with <code>ggplot2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">keydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(WR.key)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(keydf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  'data.frame':  136 obs. of  3 variables:
#R|   $ LCat: Factor w/ 17 levels "35","40","45",..: 1 2 3 4 5 6 7 8 9 10 ...
#R|   $ age : Factor w/ 8 levels "4","5","6","7",..: 1 1 1 1 1 1 1 1 1 1 ...
#R|   $ Freq: num  1 1 1 1 1 0.6 0 0 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(keydf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "4"  "5"  "6"  "7"  "8"  "9"  "10" "11"</code></pre>
</div>
</div>
<p>By default the <code>LCat</code> and <code>age</code> variables are factors in the new data.frame.<sup>1</sup> Having <code>age</code> as a factor <strong>is</strong> useful, but the naturally increasing order of the levels (see above) causes the vertical ordering of ages in the plots below to be opposite of what is desired. Thus, the order of the age levels is reversed with <code>fct_rev()</code> from <code>forcats</code> and the name is changed to <code>fage</code> to make it clear that it is a factor. Some of the plots below require <code>age</code> as a numeric, rather than a factor, so the numeric ages are added to the data.frame in <code>nage</code> using <code>fact2num()</code> from <code>FSA</code>.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;One could use <code>stringsAsFactors=FALSE</code> in <code>as.data.frame()</code> but having those two variables as strings is not helpful.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;<code>fact2num()</code> is used because it maintains the correct numerical value for each level of the factor.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">keydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> keydf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(age),</span>
<span id="cb10-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nage=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-4">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fage=</span>age)</span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(keydf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  'data.frame':  136 obs. of  4 variables:
#R|   $ LCat: Factor w/ 17 levels "35","40","45",..: 1 2 3 4 5 6 7 8 9 10 ...
#R|   $ fage: Factor w/ 8 levels "11","10","9",..: 8 8 8 8 8 8 8 8 8 8 ...
#R|   $ Freq: num  1 1 1 1 1 0.6 0 0 0 0 ...
#R|   $ nage: num  4 4 4 4 4 4 4 4 4 4 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(keydf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fage)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "11" "10" "9"  "8"  "7"  "6"  "5"  "4"</code></pre>
</div>
</div>
<p>There is no value below to having <code>LCat</code> as a factor so it is changed to a numeric using <code>fact2num()</code>. Finally, <code>Freq</code> is a proportion and not a “count” so it is changed to the more accurate <code>prop</code> below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">keydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> keydf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LCat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop=</span>Freq)</span>
<span id="cb14-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(keydf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  'data.frame':  136 obs. of  4 variables:
#R|   $ LCat: num  35 40 45 50 55 60 65 70 75 80 ...
#R|   $ fage: Factor w/ 8 levels "11","10","9",..: 8 8 8 8 8 8 8 8 8 8 ...
#R|   $ prop: num  1 1 1 1 1 0.6 0 0 0 0 ...
#R|   $ nage: num  4 4 4 4 4 4 4 4 4 4 ...</code></pre>
</div>
</div>
<p>All of the previous modifications to the age-length key data.frame could be performed more efficiently in the following chain of commands.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">keydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(WR.key) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(age),</span>
<span id="cb16-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nage=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(age),</span>
<span id="cb16-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LCat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-5">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fage=</span>age,</span>
<span id="cb16-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop=</span>Freq)</span></code></pre></div>
</div>
<p>Finally, many of the length-age combinations in the age-length key are 0. Some of the plots made below are better made without the zeroes, whereas some are better with the zeroes. Thus, a second data.frame without zeroes is needed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">keydf_nozeroes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> keydf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb17-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(prop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
</section>
<section id="stacked-barplot" class="level1 page-columns page-full">
<h1>Stacked Barplot</h1>
<p>The age-length key may be visualized as a stacked bar (or column) plot with proportion at age on the y-axis, length categories on the x-axis, and stacks colored according to the factored age. Note that the data.frame without zeroes and <code>fage</code> is used. Further note that younger ages start at the bottom of the bars because the order of the levels was reversed in <code>fage</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-barplot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>This plot can be improved by providing better labels for the axes, providing more length labels on the x-axis, and minimizing the extra vertical and horizontal spaced caused by expanding the x- and y-axes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb19-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-barplot-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>I also prefer to include age labels in the bars rather than having a legend. These labels may be added with <code>geom_text()</code>.<sup>3</sup> but the position needs to be controlled with <code>position_stack()</code> due to the stacking of the bars. <code>vjust=0.5</code> is used in <code>position_stack()</code> so that the label will be placed at the halfway point (vertically) of the bar. With these labels, the legend is no longer needed and is removed within <code>theme()</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;<code>geom_label()</code> provides a slightly different look.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>fage),</span>
<span id="cb20-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb20-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-barplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bubble-plot" class="level1 page-columns page-full">
<h1>Bubble Plot</h1>
<p>Another useful plot for visualizing the age-length key is to plot a point at each age-length position (for which fish existed) and scale the size of the point to the proportion found in the age-length key. The start of the plot is shown below, noting that the data.frame without zeroes and <code>nage</code> is used.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>nage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),</span>
<span id="cb21-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-bubbleplot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Two modifications are required to scale the size of the points. First, the size attribute within <code>geom_point()</code> should be mapped to “proportions” from the age-length key data.frame (i.e., <code>prop</code>). I also mapped color to the factored ages (i.e., <code>fage</code>), but that is superfluous as all points corresponding to each age on the y-axis will be the same color.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>nage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),</span>
<span id="cb22-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-bubbleplot-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The second modification is to better control how the sizes of the points are determined with <code>scale_size()</code>. Below <code>breaks=</code> is used to create breaks in the range of values of the <code>size=</code> variable (i.e., <code>prop</code>) from 0 to 1 in steps of 0.1 (so, 10 breaks across the range of possible <code>prop</code> values). <code>range=</code> is then used to set a range of “size” values for the points. Here the range is set from 1 to 10 so that <code>size=1</code> would be used for the smallest break in <code>prop</code> and <code>size=10</code> would be used for the largest break in <code>prop</code>. In other words, the size of the points will range from 1 to 10 based on where the value of <code>prop</code> is in the <code>breaks=</code> sequence.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;You will likely need to try different values for <code>range=</code> to get “bubble” sizes that you prefer.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>nage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),</span>
<span id="cb23-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-bubbleplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="line-plot" class="level1 page-columns page-full">
<h1>Line Plot</h1>
<p>“Line plots” of the age-length key are easily constructed from the data.frame <em>with</em> zeroes using <code>geom_line()</code>.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;<code>size=</code> is used here to make the lines a little heavier than the default.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb24-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-lineplot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Again I prefer to have labels on the plot rather than in a legend if possible. In <code>alkPlot()</code> from <code>FSA</code> the line plot has age labels at the peak of each line. Adding these labels requires a separate data.frame that contains the portion of the age-length key data.frame that corresponds to the first instance of the maximum <code>prop</code> for each age. This data.frame is constructed below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">agelbldf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> keydf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(fage) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(prop)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to remove tibble and grouping</span></span>
<span id="cb25-5">agelbldf</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    LCat fage      prop nage
#R|  1  110   11 0.2000000   11
#R|  2  115   10 1.0000000   10
#R|  3  100    9 0.2777778    9
#R|  4  105    8 0.4285714    8
#R|  5   95    7 0.7058824    7
#R|  6   85    6 0.9090909    6
#R|  7   65    5 1.0000000    5
#R|  8   35    4 1.0000000    4</code></pre>
</div>
</div>
<p>The age labels are included on the plot by first moving <code>data=</code> and <code>mapping=</code> from <code>ggplot()</code> to <code>geom_line()</code>.<sup>6</sup> Then include the second data.frame in <code>geom_label()</code><sup>7</sup> with the the <code>label=</code> aesthetic to place the labels. <code>fill=</code> was used to fill the label box with the same color as the line, <code>size=</code> was used to increase the size of the text, and <code>alpha=</code> was used to make the color of the label box semi-transparent so that the lines behind them could still be seen. Furthermore, the expansion for the x-axis and the top of the y-axis were increased to make room for the labels. and the now unnecessary legend was removed.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;This is needed when separate data.frames are used to make different aspects of the plot.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;<code>geom_text()</code> provides a slightly different look.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>fage),</span>
<span id="cb27-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>agelbldf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>fage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage),</span>
<span id="cb27-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04</span>),</span>
<span id="cb27-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-lineplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="area-plot" class="level1">
<h1>Area Plot</h1>
<p>Area plots are similar to the barplot from above. However, I have found these plots to be the hardest to make look nice and to modify using base R plotting functions and, thus, I did not use them often. Here is a start for constructing an area plot with <code>ggplot2</code> using <code>geom_area()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb28-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-areaplot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>As before, I prefer to label the agess within the areas, rather than as a legend. I could not find an automated way to do this. Thus, the general method for labeling the lines in the line plot will be followed, except that the data.frame will have to be created by manually filling the <code>LCat</code> and <code>prop</code> values for where the labels should be placed. In practice this will likely take some trial-and-error as the positions are “eye-balled.” Below I use <code>tribble()</code> from <code>tibble</code> because I like how the data can be entered by rows rather than by columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">agelbldf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb29-2">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>LCat,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>prop,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>lbl,</span>
<span id="cb29-3">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>,</span>
<span id="cb29-4">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>,</span>
<span id="cb29-5">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>,</span>
<span id="cb29-6">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>,</span>
<span id="cb29-7">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">103</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.62</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>,</span>
<span id="cb29-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>,</span>
<span id="cb29-9">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">112</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>,</span>
<span id="cb29-10">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span></span>
<span id="cb29-11">)</span></code></pre></div>
</div>
<p>This data.frame is then used with either <code>geom_text()</code> or <code>geom_label()</code> to add the labels to the appropriate areas. Note that <code>vjust=0.5</code> and <code>hjust=0.5</code> center the text label on the given coordinates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>agelbldf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),</span>
<span id="cb30-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb30-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-areaplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="why-these-modifications" class="level1">
<h1>Why These Modifications?</h1>
<p>I prefer these plots to those produced by <code>alkPlot()</code> (even though I wrote the code for all of those plots) because the full arsenal of ggplot2 commands can be used to modify the plots and because these plots more readily handle some issues with age-length keys.</p>
<p>It is beyond the scope of this post to show all the ways these plots can be modified with <code>ggplot2</code> code. A simple example is to replace the rather garish colors used above. For example, the fill color on the barplot can be changed to a scale of blues with <code>scale_fill_brewer()</code> as shown below. Many other color schemes can be used (see <a href="https://bookdown.dongzhuoer.com/hadley/ggplot2-book/colour-discrete">this</a> as one (of many) demonstration of choosing colors.)</p>
<div class="cell" data-layout-align="center" data-output-line-numbers="8">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>fage),</span>
<span id="cb31-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb31-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blues"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-barplot-modcolor-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>You may want to avoid color altogether and use a grey scale when preparing for print publications. One could use <code>scale_color_brewer(palette="Greys")</code> but this tends to leave the last age as white, which may not be effective. Instead use <code>scale_color_grey()</code> and use <code>start=</code> and <code>end=</code> to control the levels of grey (note that 0 is black and 1 is white).</p>
<div class="cell" data-layout-align="center" data-output-line-numbers="7">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>keydf_nozeroes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>nage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),</span>
<span id="cb32-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_grey</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-bubbleplot-colormod-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>This post originally started because a user noted that <code>alkPlot()</code> plots were not appropriate when some of the length classes were missing from the age-length key. For example, suppose that no fish existed from 55 to 70 cm in the original data.frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">WR.age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">droplevels</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(WR79, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(age)))</span>
<span id="cb33-2">WR.age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(WR.age,len<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> len<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 55-70 cm fish</span></span>
<span id="cb33-3">WR.age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>LCat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lencat</span>(WR.age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb33-4">raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>LCat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>WR.age)</span>
<span id="cb33-5">WR.key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(raw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<p>See how the <code>alkPlot()</code> plot does not clearly show the gap in the data for those lengths (i.e., the 50- and 70-cm bars are right next to each other).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alkPlot</span>(WR.key)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/make-ALKplot-missing-Lcat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>However, the similar <code>ggplot2</code> plot, though clearly requiring more code from the user, properly shows the missing length categories.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">WR.keydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(WR.key) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb35-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(age),</span>
<span id="cb35-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nage=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(age),</span>
<span id="cb35-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LCat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fact2num</span>(LCat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb35-5">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fage=</span>age,</span>
<span id="cb35-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop=</span>Freq) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb35-7">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(prop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb35-8"></span>
<span id="cb35-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>WR.keydf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prop,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>LCat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>fage)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>fage),</span>
<span id="cb35-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb35-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb35-15">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ALK</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/index_files/figure-html/ALK-barplot-missing-Lcat-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h._ogle2025,
  author = {H. Ogle, Derek},
  title = {Age-Length {Key} {Plots}},
  date = {2025-01-05},
  url = {https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h._ogle2025" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2025, January 5. Age-Length Key Plots. <a href="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/">https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/</a>.
</div></div></section></div> ]]></description>
  <category>Age-Length Key</category>
  <category>ggplot2</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/</guid>
  <pubDate>Sun, 05 Jan 2025 06:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2025-1-5_ALKPlots_GGplot/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Bayesian LVB II - rstan</title>
  <dc:creator>Jason Doll</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The use of Bayesian inference in fisheries biology has been increasing. For good reason, as there are many benefits to taking a Bayesian approach. I won’t go into those reasons here but you can read about them in <span class="citation" data-cites="dorazio_2016">Dorazio (2016)</span> and <span class="citation" data-cites="dolljacquemin_2018">Doll and Jacquemin (2018)</span>. This post assumes you have already decided to use Bayesian methods and will present how to estimate parameters of the von Bertalanffy growth model. Previous posts describe frequentist methods <a href="../2019-12-31_vonB_plots_1/">here</a> and <a href="../2020-1-2_vonB_plots_2/">here</a></p>
<p>This is the second post where I describe how to fit a model using Bayesian inference. The <a href="../2024-2-5_LVB_brms/">first post</a> used Stan with the <code>brms</code> package. This post will use <code>rstan</code> and I will write the full Stan model code.</p>
<p>Both methods will fit the typical three parameter von Bertalanffy growth model</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ATL_i=L_%5Cinfty%20*%20(1-e%5E%7B(-%5Ckappa%20*%20(t_i-t_0))%7D%20)%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?TL_i"> is total length of individual <em>i</em>, <img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"> is the average maximum length obtained, <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> is the Brody growth coefficient, <img src="https://latex.codecogs.com/png.latex?t_i"> is the age of individual <em>i</em>, and <img src="https://latex.codecogs.com/png.latex?t_0"> is the theoretical age at zero length. To finish the model, an error term is added:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ATL_i=L_%5Cinfty%20*%20(1-e%5E%7B(-%5Ckappa%20*%20(t_i-t_0))%7D%20+%20%5Cepsilon_i)%0A"> <img src="https://latex.codecogs.com/png.latex?%0A%5Cepsilon_i%20%5Csim%20normal(0,%5Csigma)%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_i"> is a random error term for individual <em>i</em> with a mean of 0 and standard deviation <img src="https://latex.codecogs.com/png.latex?%5Csigma">.</p>
</section>
<section id="prior-probabilities" class="level1">
<h1>Prior probabilities</h1>
<p>At the heart of Bayesian analysis is the prior probability distribution.This post will use non-informative prior probability distributions. When and how to use informative priors when fitting a von Bertalanffy growth model will be discussed in a future post. However, you can read about it in <span class="citation" data-cites="dolljacquemin_2018">Doll and Jacquemin (2018)</span>. The prior probability distributions used in this post are:</p>
<table class="table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Prior Probability Distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"></td>
<td>normal(0,1000)</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?%5Ckappa"></td>
<td>normal(0,10)</td>
</tr>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?t_0"></td>
<td>normal(0,10)</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?%5Csigma"></td>
<td>student-t(3,0,30)</td>
</tr>
</tbody>
</table>
<p>Stan parameterizes the normal distribution with the mean and standard deviation and the student-t distribution with the degrees of freedom, mean, and standard deviation</p>
</section>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<p>First step is to load the necessary packages</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSAdata)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for data</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for filter(), select()</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for transposing data wide to long</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for potting</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for fitting Stan models</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidybayes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for plotting posterior results</span></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(bayesplot) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for plotting posterior predictive checks</span></span></code></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The <code>WalleyeErie2</code> data available in the <a href="https://fishr-core-team.github.io/FSAdata/"><code>FSAdata</code></a> package was used in previous posts demonstrating von Bertalanffy growth models and will once again be used here. These data are Lake Erie Walleye (<em>Sander vitreus</em>) captured during October-November, 2003-2014. As before, the primary interest here is in the tl (total length in mm) and age variables. The data will also be filtered to focus only on female Walleye from location <code>1</code> captured in 2014.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WalleyeErie2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb2-2">wf14T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WalleyeErie2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female"</span>,loc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>year,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sex,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>setID,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>loc,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>grid)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wf14T)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       tl    w      mat age
#R|  1   445  737 immature   2
#R|  2   528 1571   mature   4
#R|  3   380  506 immature   1
#R|  323 488 1089 immature   2
#R|  324 521 1408   mature   3
#R|  325 565 1745   mature   3</code></pre>
</div>
</div>
<p>Next step is to create a list to hold the data used in the model. One important note, the items in this list must match the data used in the model code. For example, we will use <code>tl</code> for total length in the data list and <code>tl</code> must be specified in the Stan data block exactly as <code>tl</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dataList<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tl=</span>wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tl,</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age ,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>((wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age))</span>
<span id="cb4-5">)</span></code></pre></div>
</div>
</section>
<section id="initial-values" class="level1">
<h1>Initial values</h1>
<p>An optional step is to specify initial values for the parameters. It is always good practice to specify initial values, particularly with non-linear and other complex models. I will fit the model using multiple chains and it is advisable to use different starting values for each chain. To accomplish this, we will specify a function and use a random number generator for each parameter Adjust the range for the uniform distribution to cover a large range of values that make sense for your data. You can use other distributions as long as they match the declared range in the model code. In this example, I am using the random uniform function because <img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"> and <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> are restricted to be positive in the model. Therefore, the starting value must be positive.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">initsLst <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Linf=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.00</span>),</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t0 =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb5-5">)</span></code></pre></div>
</div>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Now we can introduce the Stan model code. Stan models are structured with “blocks”. Generally, the minimum number of blocks used is three; data, parameters, and model blocks. In our example, we will use a fourth block, the generated quantities block. All of the blocks must be in a single .stan file. The blocks are presented separately here for demonstration. Other blocks that can be used in Stan are; functions, transformed data, and transformed parameters. See the Stan manual for a description of each.</p>
<p>The data block declares all of the data needed for the model and the data object must match how they are entered in the data list above. There are several different types of data that can be declared. For this example, I use <code>int</code> to declare <code>N</code>, which is the number of observations, as an integer. You’ll also notice that I include a lower bounds for this variable. This isn’t necessary but good practice if your variable has a floor or ceiling. <code>tl</code> is declared as a <code>real</code> data type. The <code>real</code> data type is typically used for single numbers or a vector of numbers. This example declares the real data type as a vector of length <code>N</code>. <code>age</code> is another vector of length <code>N</code> but it is a vector of integers, <code>int</code>.</p>
<div class="cell" data-layout-align="center" data-output.var="LVBmodel">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">data</span> {</span>
<span id="cb6-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; N ;  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// number of observations</span></span>
<span id="cb6-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span> tl[N] ;      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Total lengths of individual fish</span></span>
<span id="cb6-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> age[N] ;      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Age of individual fish</span></span>
<span id="cb6-5">}</span></code></pre></div>
</div>
<p>The second block in our model is a parameters block. This block will declare all the estimated parameters in the model. Our model has four parameters. <code>sigma_y</code> is the standard deviation, <img src="https://latex.codecogs.com/png.latex?%5Csigma">, of the individual observations; <code>t0</code> is the <img src="https://latex.codecogs.com/png.latex?t_0"> LVB parameter; <code>Linf</code> is the <img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"> parameter; and <code>k</code> is the <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> parameter. Each is declared as a single real value. All of the parameters are constrained in at least one direction. <code>sigma_y</code> is constrained to be positive using the <code>&lt;lower=0&gt;</code> argument because standard deviations must be positive. <code>t0</code> is being constrained to be between -5 and 5 using the <code>&lt;lower=-5&gt;</code> and <code>&lt;upper=5&gt;</code> arguments. This is declared based on prior knowledge to prevent the sampler from searching outside these bounds. The remaining two, <code>Linf</code> and <code>k</code>, are only constrained to be positive using <code>&lt;lower=0&gt;</code>.</p>
<p>Setting bounds can help the sampler find the posterior distribution, particularly with complex models. So it is recommended to always set bounds that “make sense”. Use your knowledge of the system and the model to declare these bounds. This is separate from declare your prior probability distribution but setting bounds will influence your prior probability distributions. The priors are set in the model block.</p>
<div class="cell" data-layout-align="center" data-output.var="LVBmodel">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">parameters</span> {</span>
<span id="cb7-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; sigma_y;              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//LVB standard deviation</span></span>
<span id="cb7-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lower</span>=-<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>&gt; t0;         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//LVB t0 parameter</span></span>
<span id="cb7-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; Linf;                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//LVB Linf parameter</span></span>
<span id="cb7-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; k;                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//LVB k parameter</span></span>
<span id="cb7-6">}</span></code></pre></div>
</div>
<p>The third block declares the model. The model block starts off with declaring any local variables that might be needed. Note that any variables declared in the model block can’t be referenced in other blocks. In this case, I need a vector <code>ypred</code> of length <code>N</code> to hold the mean total length which is a function of the von Bertlanffy growth model. This is followed by our declaration of prior probability distributions. Stan will automatically assign uniform prior probabilities if a prior is not specified here. I don’t recommend letting Stan declare uniform priors by default. Always be explicit in the prior probability distribution in your model and assign prior probability distributions that are suitable for the parameter and defensible against a skeptical audience. A future post will dive deeper into setting and selecting informative vs non-informative prior probability distribution.</p>
<p>The final part of the model block is the likelihood. This will include a for loop that will iterate through each of the observed values and include the model. Following this is the <code>normal()</code> distribution which specifies the distribution of our observations and is parameterized with the mean <code>y_mean</code> and standard deviation <code>sigma_y</code>. This last line can be indexed over individuals and included in the for loop. Or vectorized outside the loop, as it is written here.</p>
<div class="cell" data-layout-align="center" data-output.var="LVBmodel">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">model</span> {</span>
<span id="cb8-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">vector</span>[N] y_mean; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//variable used in the model block only</span></span>
<span id="cb8-3"></span>
<span id="cb8-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//The next three lines of code specify reference prior probability distributions.</span></span>
<span id="cb8-5">  sigma_y ~ student_t(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>);  </span>
<span id="cb8-6">  Linf ~ normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>);</span>
<span id="cb8-7">  k ~ normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>);</span>
<span id="cb8-8">  t0 ~ normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>); </span>
<span id="cb8-9">  </span>
<span id="cb8-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// calculate likelihood of data</span></span>
<span id="cb8-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:N){</span>
<span id="cb8-12">    y_mean[i]= Linf * (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>-exp(-(k * (age[i]-t0) )) );</span>
<span id="cb8-13">  }</span>
<span id="cb8-14">  tl~normal(y_mean, sigma_y);</span>
<span id="cb8-15">}</span></code></pre></div>
</div>
<p>The last block needed is a generated quantities block. This block is used to calculate derived variables, posterior predictions, and to generate model predictions. I will use it here to generate a vector named <code>y_rep</code> of length <code>N</code> that will hold individual predicted observations. <code>y_rep</code> is the posterior predicted values of total length that will be used to plot the observed and model predicted total length. The posterior predicted distribution is generated using the <code>normal_rng</code> function which generates a random value from the normal distribution based on a mean (the model) and standard deviation. The posterior predicted distribution generated in in a for loop to iterate through each observed individual.</p>
<div class="cell" data-layout-align="center" data-output.var="LVBmodel">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">generated quantities</span>{</span>
<span id="cb9-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//the next four lines of code generate predicted values to use for inspecting model fit</span></span>
<span id="cb9-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">vector</span>[N] y_rep;</span>
<span id="cb9-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:N){</span>
<span id="cb9-5">    y_rep[i] = normal_rng(Linf * (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>-exp(-(k * (age[i]-t0) )) ) ,sigma_y);</span>
<span id="cb9-6">  }</span>
<span id="cb9-7">}</span></code></pre></div>
</div>
<p>Before sending the model to <code>rstan</code>, the full model code needs to be saved into a file with the .stan extension. For example “Walleye_lvb.stan”. The .stan file also has to be saved in the working directory.</p>
<p>Now it is time to bundle all the pieces together.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Compile and fit model using Stan </span></span>
<span id="cb10-2">LVBfit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stan</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Walleye_lvb.stan'</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The file containing the Stan model</span></span>
<span id="cb10-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dataList,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a list containing the data</span></span>
<span id="cb10-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">init=</span>initsLst,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a list containing initial values </span></span>
<span id="cb10-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of chains, typically 3 to 4</span></span>
<span id="cb10-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of cores for multi-core processing;</span></span>
<span id="cb10-7">                                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Typically set to match number of chains</span></span>
<span id="cb10-8">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span> ,             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of iterations</span></span>
<span id="cb10-9">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> ,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of warm up steps to discard</span></span>
<span id="cb10-10">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.80</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjustments to the algorithm</span></span>
<span id="cb10-11">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to improve convergence.</span></span></code></pre></div>
</div>
</section>
<section id="assess-convergence" class="level1">
<h1>Assess convergence</h1>
<p>Let’s inspect convergence and how well the model fits the data. The first thing to do is to examine the trace plots and histograms of the important model parameters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(LVBfit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plotfun=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trace"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_y"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linf"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t0"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inc_warmup=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(LVBfit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plotfun=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hist"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_y"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linf"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t0"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inc_warmup=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The chains appear to have mixed well for all parameters and reached a stationary posterior. This is seen by a unimodal distribution in the histograms and caterpillar plots for each parameter appear “on top” of each other. We can move on to assessing how well the model fits the data using a posterior predictive check.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">y_rep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(LVBfit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y_rep"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Extract the posterior predicted observations</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_dens_overlay</span>(wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tl, y_rep[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, ])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Density plot of y and y_rep</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>The y_rep curves do a good job at covering our observations and we can conclude the model does a sufficient job at representing the data. Now we can move on to look at individual parameters.</p>
</section>
<section id="posterior-summary" class="level1">
<h1>Posterior summary</h1>
<p>Because we included a generated quantities block and are calculating the posterior predicted distribution, our output if very long. The <code>summary(LVBfit)</code> command would return a vary long summary of all the parameters and individual predicted total lengths. Instead, I use the <code>print()</code> function here and only specify the parameters of interest.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(LVBfit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_y"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linf"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t0"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits_summary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  Inference for Stan model: anon_model.
#R|  3 chains, each with iter=3000; warmup=1000; thin=1; 
#R|  post-warmup draws per chain=2000, total post-warmup draws=6000.
#R|  
#R|                mean  se_mean        sd       2.5%        50%     97.5% n_eff
#R|  sigma_y  18.374523 0.014576  0.697872  17.056527  18.351687  19.78513  2292
#R|  Linf    648.420363 0.255814 10.053525 629.794538 648.129750 669.59872  1544
#R|  k         0.361929 0.000548  0.021013   0.321538   0.361925   0.40304  1471
#R|  t0       -1.286594 0.002216  0.087222  -1.466487  -1.282706  -1.12793  1550
#R|              Rhat
#R|  sigma_y 1.002078
#R|  Linf    1.001539
#R|  k       1.001829
#R|  t0      1.001628
#R|  
#R|  Samples were drawn using NUTS(diag_e) at Tue May  7 08:07:37 2024.
#R|  For each parameter, n_eff is a crude measure of effective sample size,
#R|  and Rhat is the potential scale reduction factor on split chains (at 
#R|  convergence, Rhat=1).</code></pre>
</div>
</div>
<p>The summary table provides the point estimates, 95% credible intervals, Rhat values, and n_eff. The Rhat values are another check to assess model convergence. It is generally accepted that you want Rhat values less than 1.10. The n_eff is also used to assess convergence. n_eff refers to “Effective Sample Size”. Because of the nature of MCMC methods, each successive sample from the posterior will typically be autocorrelated within a chain. Autocorrelation within the chains can increase uncertainty in the estimates. One way to assessing how much autocorrelation is present and big of an effect it might be, is with the “Effective Sample Size”. ESS represents the number of independent draws from the posterior. The ESS will be lower than the actual number of draws and you are looking for a high ESS. It has been recommended that an ESS of 1,000 for each parameter is sufficient <span class="citation" data-cites="burkner_2017">Bürkner (2017)</span>.</p>
</section>
<section id="posterior-plotting" class="level1">
<h1>Posterior plotting</h1>
<p>The final part is to create a figure with observed and predicted values. This code block is a little different than what was used with brms. Instead of <code>add_predicted_draw()</code>, I have to combine the predicted draws manually then convert them from wide to long.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tl=</span>wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tl, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>wf14T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(y_rep))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine observed data with predictions</span></span>
<span id="cb16-2">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(tl,age),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".prediction"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_lineribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>.prediction), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.width=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># regression line and CI</span></span>
<span id="cb16-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>wf14T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw data</span></span>
<span id="cb16-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Greys"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total length (mm)</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>The figure above shows the observed data in blue circles, the prediction line as a solid black line, and the posterior prediction intervals (0.50, 0.80, and 0.95) in different shades of gray.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-burkner_2017" class="csl-entry">
Bürkner, P.-C. 2017. <a href="https://doi.org/10.18637/jss.v080.i01">Brms: <span>An R Package</span> for <span>Bayesian Multilevel Models Using Stan</span></a>. Journal of Statistical Software 80:1–28.
</div>
<div id="ref-dolljacquemin_2018" class="csl-entry">
Doll, J. C., and S. J. Jacquemin. 2018. <a href="https://doi.org/10.1002/fsh.10038">Introduction to <span>Bayesian</span> modeling and inference for fisheries scientists</a>. Fisheries 43(3):152–161.
</div>
<div id="ref-dorazio_2016" class="csl-entry">
Dorazio, R. M. 2016. <a href="https://doi.org/10.1007/s10144-015-0503-4">Bayesian data analysis in population ecology: Motivations, methods, and benefits</a>. Population Ecology 58:31–44.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{doll2024,
  author = {Doll, Jason},
  title = {Bayesian {LVB} {II} - Rstan},
  date = {2024-02-06},
  url = {https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-doll2024" class="csl-entry quarto-appendix-citeas">
Doll, J. 2024, February 6. Bayesian LVB II - rstan. <a href="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/">https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/</a>.
</div></div></section></div> ]]></description>
  <category>growth</category>
  <category>Bayesian</category>
  <category>Stan</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/</guid>
  <pubDate>Tue, 06 Feb 2024 06:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-6_LVB_Stan/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Bayesian LVB I - brms</title>
  <dc:creator>Jason Doll</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The use of Bayesian inference in fisheries biology has been increasing. For good reason, as there are many benefits to taking a Bayesian approach. I won’t go into those reasons here but you can read about them in <span class="citation" data-cites="dorazio_2016">Dorazio (2016)</span> and <span class="citation" data-cites="dolljacquemin_2018">Doll and Jacquemin (2018)</span>. This post assumes you have already decided to use Bayesian methods and will present how to estimate parameters of the von Bertalanffy growth model. Previous posts describe frequentist methods <a href="../2019-12-31_vonB_plots_1/">here</a> and <a href="../2020-1-2_vonB_plots_2/">here</a></p>
<p>There are many programming languages that can be used to fit models with Bayesian inference. In this post, I will use Stan with the <code>brms</code> package. The <code>brms</code> packages is a wrapper for Stan that makes fitting simple models easier than writing the full model code. In a <a href="../2024-2-6_LVB_Stan/">second post</a>, I will show how the same model is fit using <code>rstan</code> and writing the full Stan model code. Although the <code>brms</code> package will write the full Stan model for you.</p>
<p>Both methods will fit the typical three parameter von Bertalanffy growth model</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ATL_i=L_%5Cinfty%20*%20(1-e%5E%7B(-%5Ckappa%20*%20(t_i-t_0))%7D%20)%0A"> where <img src="https://latex.codecogs.com/png.latex?TL_i"> is total length of individual <em>i</em>, <img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"> is the average maximum length obtained, <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> is the Brody growth coefficient, <img src="https://latex.codecogs.com/png.latex?t_i"> is the age of individual <em>i</em>, and <img src="https://latex.codecogs.com/png.latex?t_0"> is the theoretical age at zero length. To finish the model, an error term is added:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ATL_i=L_%5Cinfty%20*%20(1-e%5E%7B(-%5Ckappa%20*%20(t_i-t_0))%7D%20+%20%5Cepsilon_i)%0A"> <img src="https://latex.codecogs.com/png.latex?%0A%5Cepsilon_i%20%5Csim%20normal(0,%5Csigma)%0A"> Where <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_i"> is a random error term for individual <em>i</em> with a mean of 0 and standard deviation <img src="https://latex.codecogs.com/png.latex?%5Csigma">.</p>
</section>
<section id="prior-probabilities" class="level1">
<h1>Prior probabilities</h1>
<p>At the heart of Bayesian analysis is the prior probability distribution. This post will use non-informative prior probability distributions. When and how to use informative priors when fitting a von Bertalanffy growth model will be discussed in a future post. However, you can read about it in <span class="citation" data-cites="dolljacquemin_2018">Doll and Jacquemin (2018)</span>. The prior probability distributions used in this post are:</p>
<table class="table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Prior Probability Distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"></td>
<td>normal(0,1000)</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?%5Ckappa"></td>
<td>normal(0,10)</td>
</tr>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?t_0"></td>
<td>normal(0,10)</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?%5Csigma"></td>
<td>student-t(3,0,30)</td>
</tr>
</tbody>
</table>
<p>Stan parameterizes the normal distribution with the mean and standard deviation and the student-t distribution with the degrees of freedom, mean, and standard deviation</p>
</section>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<p>First step is to load the necessary packages</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSAdata)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for data</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for filter(), select()</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for plotting</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(brms)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for fitting Stan models</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidybayes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for plotting posterior results</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(bayesplot) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for plotting posterior predictive checks</span></span></code></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The <code>WalleyeErie2</code> data available in the <a href="https://fishr-core-team.github.io/FSAdata/"><code>FSAdata</code></a> package was used in previous posts demonstrating von Bertalanffy growth models and will once again be used here. These data are Lake Erie Walleye (<em>Sander vitreus</em>) captured during October-November, 2003-2014. As before, the primary interest here is in the tl (total length in mm) and age variables. The data will also be filtered to focus only on female Walleye from location “1” captured in 2014.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WalleyeErie2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb2-2">wf14T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WalleyeErie2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female"</span>,loc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>year,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sex,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>setID,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>loc,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>grid)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wf14T)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       tl    w      mat age
#R|  1   445  737 immature   2
#R|  2   528 1571   mature   4
#R|  3   380  506 immature   1
#R|  323 488 1089 immature   2
#R|  324 521 1408   mature   3
#R|  325 565 1745   mature   3</code></pre>
</div>
</div>
</section>
<section id="brms" class="level1">
<h1>brms</h1>
<p>The first step is to specify the formula using <code>brmsformula()</code>. The first argument below is the von Bertalanffy growth model, the second argument is to specify any hierarchical model of parameters (for example, estimate parameters by group or random effects), and the third is to tell <code>brms</code> that I want to fit a nonlinear model. Note in this example I do not specify any random effects for parameters. Also note that tl and age MUST be exactly how they are shown in the column headers of the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set formula</span></span>
<span id="cb4-2">formula <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brmsformula</span>(tl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Linf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>K <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t0))),</span>
<span id="cb4-3">                       Linf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, K <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, t0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nl=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>The next step is to specify the prior probability distribution. Several parameters can’t be negative values so they are truncated using the <code>lb=0</code> argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">priors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nlpar=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linf"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lb=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nlpar=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"K"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lb=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normal</span>( <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nlpar=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t0"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">student_t</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class=</span>sigma)</span></code></pre></div>
</div>
<p>An optional step is to specify initial values for the parameters. It is good practice to always specify initial values, particularly with non-linear and other complex models. I will fit the model using multiple chains and it is advisable to use different starting values for each chain. To accomplish this, we will specify a function and use a random number generator for each parameter. Adjust the range for the uniform distribution to cover a large range of values that make sense for your data. You can use other distributions as long as they match the declared range in the model code. In this example, I am using the random uniform function because <img src="https://latex.codecogs.com/png.latex?L_%5Cinfty"> and <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> are restricted to be positive in the model. Therefore, the starting value must be positive.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">initsLst <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb6-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Linf=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),</span>
<span id="cb6-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.00</span>),</span>
<span id="cb6-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t0=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb6-5">)</span></code></pre></div>
</div>
<p>Finally, use the <code>brm()</code> function to send the model, data, priors, initial values, and any specified settings to Stan and save the output in the <code>fit1</code> object</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(formula,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calls the formula object created above</span></span>
<span id="cb7-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gaussian</span>(),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specifies the error distribution</span></span>
<span id="cb7-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>wf14T,         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data object</span></span>
<span id="cb7-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior=</span>priors,       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the prior probability object </span></span>
<span id="cb7-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">init=</span>initsLst,      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial values object</span></span>
<span id="cb7-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of chains, typically 3 to 4</span></span>
<span id="cb7-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of cores for multi-core processing. Typically set to</span></span>
<span id="cb7-8">                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># match number of chains. Adjust as needed to match the number</span></span>
<span id="cb7-9">                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># of cores on your computer and number of chains</span></span>
<span id="cb7-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of iterations</span></span>
<span id="cb7-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of warm up steps to discard</span></span>
<span id="cb7-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.80</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjustments to algorithm to </span></span>
<span id="cb7-13">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># improve convergence.</span></span></code></pre></div>
</div>
</section>
<section id="assess-convergence" class="level1">
<h1>Assess convergence</h1>
<p>Before diving into the output, I like to examine the chains to see if they sufficiently mixed and reached a stationary posterior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(fit1)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The chains appear to have mixed well for all parameters and reached a stationary posterior. This is seen by a unimodal distribution (on the left) and caterpillar plots for each parameter appear “on top” of each other (right).</p>
<p>We can also do a posterior predictive check to assess how well the model fit the data. A posterior predictive check compares observed data to predicted values based on the fitted model. If the model predicted values are “similar” to the observed data values then you can conclude the model fits the data well.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pp_check</span>(fit1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># posterior predictive checks</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>This figure shows two lines, one represents the data (<em>y</em>) and the other represents posterior predicted values from the model (<em>y<sub>rep</sub></em>). The <em>y<sub>rep</sub></em> generally follows the observed data so we can conclude the model fits the data well.</p>
</section>
<section id="posterior-summary" class="level1">
<h1>Posterior summary</h1>
<p>Finally, we can examine the summary table of the output.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|   Family: gaussian 
#R|    Links: mu = identity; sigma = identity 
#R|  Formula: tl ~ Linf * (1 - exp(-K * (age - t0))) 
#R|           Linf ~ 1
#R|           K ~ 1
#R|           t0 ~ 1
#R|     Data: wf14T (Number of observations: 325) 
#R|    Draws: 3 chains, each with iter = 3000; warmup = 1000; thin = 1;
#R|           total post-warmup draws = 6000
#R|  
#R|  Population-Level Effects: 
#R|                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#R|  Linf_Intercept   648.33      9.98   629.46   668.04 1.00     1364     2104
#R|  K_Intercept        0.36      0.02     0.32     0.40 1.00     1246     1743
#R|  t0_Intercept      -1.28      0.09    -1.45    -1.12 1.00     1349     1839
#R|  
#R|  Family Specific Parameters: 
#R|        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#R|  sigma    18.35      0.73    16.98    19.86 1.00     2048     2379
#R|  
#R|  Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#R|  and Tail_ESS are effective sample size measures, and Rhat is the potential
#R|  scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The summary table provides the point estimates, 95% credible intervals, Rhat values, and ESS. The Rhat values are another check to assess model convergence. It is generally accepted that you want Rhat values less than 1.10. Bulk_ESS and Tail_ESS are also used to assess convergence. Bulk_ESS and Tail_ESS refer to “Effective Sample Size.” Because of the nature of MCMC methods, each successive sample from the posterior will typically be autocorrelated within a chain. Autocorrelation within the chains can increase uncertainty in the estimates. One way to assessing how much autocorrelation is present and big of an effect it might be, is with the “Effective Sample Size.” ESS represents the number of independent draws from the posterior. The ESS will be lower than the actual number of draws and you are looking for a high ESS. It has been recommended that an ESS of 1,000 for each parameter is sufficient <span class="citation" data-cites="burkner_2017">Bürkner (2017)</span>.</p>
</section>
<section id="posterior-plotting" class="level1">
<h1>Posterior plotting</h1>
<p>Now that we are convinced the model fit the data well, let’s plot the data and model predictions using the <code>ggplot2</code> and <code>tidybayes</code> packages.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">wf14T <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_predicted_draws</span>(fit1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adding the posterior distribution with tidybayes</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_lineribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>.prediction), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.width=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># regression line and CI</span></span>
<span id="cb12-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>wf14T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw data</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Greys"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total length (mm)</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>The figure above shows the observed data in blue circles, the prediction line as a solid black line, and the posterior prediction intervals (0.50, 0.80, and 0.95) in different shades of gray.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-burkner_2017" class="csl-entry">
Bürkner, P.-C. 2017. <a href="https://doi.org/10.18637/jss.v080.i01">Brms: <span>An R Package</span> for <span>Bayesian Multilevel Models Using Stan</span></a>. Journal of Statistical Software 80:1–28.
</div>
<div id="ref-dolljacquemin_2018" class="csl-entry">
Doll, J. C., and S. J. Jacquemin. 2018. <a href="https://doi.org/10.1002/fsh.10038">Introduction to <span>Bayesian</span> modeling and inference for fisheries scientists</a>. Fisheries 43(3):152–161.
</div>
<div id="ref-dorazio_2016" class="csl-entry">
Dorazio, R. M. 2016. <a href="https://doi.org/10.1007/s10144-015-0503-4">Bayesian data analysis in population ecology: Motivations, methods, and benefits</a>. Population Ecology 58:31–44.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{doll2024,
  author = {Doll, Jason},
  title = {Bayesian {LVB} {I} - Brms},
  date = {2024-02-05},
  url = {https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-doll2024" class="csl-entry quarto-appendix-citeas">
Doll, J. 2024, February 5. Bayesian LVB I - brms. <a href="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/">https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/</a>.
</div></div></section></div> ]]></description>
  <category>growth</category>
  <category>Bayesian</category>
  <category>Stan</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/</guid>
  <pubDate>Mon, 05 Feb 2024 06:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2024-2-5_LVB_brms/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Working with Multiple Catch Curves</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In <a href="../2023-4-23_Multiple_ALKs/">a previous post</a> a helper function was created and some of the <code>map</code> family of functions from <code>purr</code> were used to efficiently create and apply an age-length key (ALK) to assign estimated ages to unaged fish in a sample. That post will be extended here by using functions from <code>purr</code> and <code>FSA</code> to efficiently compute mortality estimates from catch curves for multiple groups of fish.</p>
<p>The following packages are loaded for use below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, tidyr, purr packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for catchCurve functionality</span></span></code></pre></div>
</div>
<p>The random number seed was set to ensure repeatability for the random components of <code>alkIndivAge()</code> below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14354454</span>)</span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="initial-wrangling-catch-at-age-summary" class="level1 page-columns page-full">
<h1>Initial Wrangling &amp; Catch-at-Age Summary</h1>
<p>This post begins with the final data frame from <a href="../2023-4-23_Multiple_ALKs/">the previous post</a> of lengths and ages for all sampled Channel Catfish (<em>Ictalurus punctatus</em>) and Walleye (<em>Sander vitreus</em>) data. A portion of the resultant data frame is shown below, but the code is folded to save space.<sup>1</sup> Note here that the final data frame is called <code>dat</code>.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Please see the previous post for a thorough description of this process.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Rather than <code>dat3</code> as in the previous post.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Computes and applies an ALK</span></span>
<span id="cb3-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   data: The data frame with, at least, the age &amp; length variables</span></span>
<span id="cb3-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   avar: The name (without quotes) of the age variable in data</span></span>
<span id="cb3-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   lvar: The name (without quotes) of the length variable in data</span></span>
<span id="cb3-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   w: The width of length categories/bins for use in the ALK</span></span>
<span id="cb3-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Returns the data data frame with ages in avar assigned from the ALK for</span></span>
<span id="cb3-7"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   unaged fish and a new length category (lcat) variable derived from w</span></span>
<span id="cb3-8"></span>
<span id="cb3-9">applyALK <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,avar,lvar,w) {</span>
<span id="cb3-10">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Get avar variable name as character for non-tidyverse functions below</span></span>
<span id="cb3-11">  avarn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deparse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substitute</span>(avar))</span>
<span id="cb3-12">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Add length category variable</span></span>
<span id="cb3-13">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lcat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lencat</span>({{lvar}},<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span>w))</span>
<span id="cb3-14">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Separate into aged and unaged dataframes</span></span>
<span id="cb3-15">  aged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>({{avar}}))</span>
<span id="cb3-16">  unaged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>({{avar}}))</span>
<span id="cb3-17">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Make ALK (find frequencies, convert to row proportions)</span></span>
<span id="cb3-18">  ALK <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.formula</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~lcat+"</span>,avarn)),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>aged),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-19">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Apply ALK according to Isermann-Knight method</span></span>
<span id="cb3-20">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alkIndivAge</span>(ALK,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.formula</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(avarn,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~lcat"</span>)),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>unaged)</span>
<span id="cb3-21">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Put aged and newly assigned age data frames together to return</span></span>
<span id="cb3-22">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(aged,tmp)</span>
<span id="cb3-23">}</span>
<span id="cb3-24"></span>
<span id="cb3-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Wrangle the data</span></span>
<span id="cb3-26">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../2023-4-23_Multiple_ALKs/JFWM-20-027.S1.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Weight,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Sex,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>BCAge,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>BCLength,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Season=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-29">    Month<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"May"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span>,</span>
<span id="cb3-30">    Month<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"September"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span></span>
<span id="cb3-31">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Length)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Length<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">279</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Length<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Season) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(applyALK,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lvar=</span>Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Spp,Season,Age,Length,lcat)</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Spp Season Age Length lcat
#R|  1    CCF   Fall   1    232  230
#R|  2    CCF   Fall   1    216  210
#R|  3    CCF   Fall   1    238  230
#R|  2355 WAE Spring  10    632  630
#R|  2356 WAE Spring  10    653  650
#R|  2357 WAE Spring  13    720  720</code></pre>
</div>
</div>
<p>These data are summarized to provide total catches at each <strong>OBSERVED</strong> age for each species and season combination.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">CatAge <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Spp,Season,Age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb6-5">CatAge</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 53 × 4
#R|     Spp   Season   Age Catch
#R|     &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;
#R|   1 CCF   Fall       1    15
#R|   2 CCF   Fall       2    22
#R|   3 CCF   Fall       3     3
#R|   4 CCF   Fall       4    16
#R|   5 CCF   Fall       5    29
#R|   6 CCF   Fall       6    23
#R|   7 CCF   Fall       7    20
#R|   8 CCF   Fall       8    29
#R|   9 CCF   Fall       9    22
#R|  10 CCF   Fall      10    12
#R|  # … with 43 more rows</code></pre>
</div>
</div>
<p>A quick summary of the age range and number of observed ages for each species and season combination indicates that some ages within the age range were <strong>not</strong> observed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Spp,Season) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agerng=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Age)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(Age)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb8-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agesobs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 4 × 4
#R|  # Groups:   Spp [2]
#R|    Spp   Season agerng agesobs
#R|    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt;
#R|  1 CCF   Fall       17      14
#R|  2 CCF   Spring     16      14
#R|  3 WAE   Fall       11      10
#R|  4 WAE   Spring     18      15</code></pre>
</div>
</div>
<p>For example, the age range for Channel Catfish in the Fall was from 1 to 17, but no age 12, 13, or 16 fish were caught.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span>,Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 14 × 4
#R|     Spp   Season   Age Catch
#R|     &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;
#R|   1 CCF   Fall       1    15
#R|   2 CCF   Fall       2    22
#R|   3 CCF   Fall       3     3
#R|   4 CCF   Fall       4    16
#R|   5 CCF   Fall       5    29
#R|   6 CCF   Fall       6    23
#R|   7 CCF   Fall       7    20
#R|   8 CCF   Fall       8    29
#R|   9 CCF   Fall       9    22
#R|  10 CCF   Fall      10    12
#R|  11 CCF   Fall      11     2
#R|  12 CCF   Fall      14     1
#R|  13 CCF   Fall      15     2
#R|  14 CCF   Fall      17     3</code></pre>
</div>
</div>
<p><span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> assumed a catch of 0 for ages that were not observed within the range of observed ages for each species and season. Thus, the first “issue” encountered with these data was how to insert 0s into the data frames for these “unobserved” ages.</p>
</section>
<section id="handling-zero-catches" class="level1 page-columns page-full">
<h1>Handling Zero Catches</h1>
<section id="a-helper-function" class="level3">
<h3 class="anchored" data-anchor-id="a-helper-function">A Helper Function</h3>
<p>A helper function, <code>add0CatchByAge()</code>, was created to facilitate the adding of zero catches for the appropriate ages. This function looks complicated because I chose to allow the age and catch variables to be given without quotes. However, the general algorithm in this function is to use <code>full_seq()</code> from <code>tidyr</code> to create a sequence of sequential ages over the range of observed ages, then use <code>left_join()</code> from <code>dplyr</code> to join the original data frame to the sequence of ages, and use <code>remove_na()</code> from <code>tidyr</code> to replace missing “catch” data with zero and missing non-age and non-catch data with values from the first row of the original data frame. It is important to note that this function will <strong>only work if the non-age and non-catch variables are constant across rows.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Adds a row with catch=0 for unobserved ages within the range of observed ages</span></span>
<span id="cb12-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   data: The data frame with, at least, the age &amp; catch variables</span></span>
<span id="cb12-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   avar: The name (without quotes) of the age variable in data</span></span>
<span id="cb12-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   cvar: The name (without quotes) of the catch variable in data</span></span>
<span id="cb12-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   fill: The value to use for the catch of unobserved ages (defaults to 0)</span></span>
<span id="cb12-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Returns the data data frame with previoulsy unobserved ages in avar, the fill</span></span>
<span id="cb12-7"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   value for those ages in cvar, and values in other variables repeated for</span></span>
<span id="cb12-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   those ages</span></span>
<span id="cb12-9"></span>
<span id="cb12-10">add0CatchByAge <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,avar,cvar,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>L) {</span>
<span id="cb12-11">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Get variable names as characters for non-tidyverse functions</span></span>
<span id="cb12-12">  avarn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deparse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substitute</span>(avar))</span>
<span id="cb12-13">  cvarn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deparse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substitute</span>(cvar))</span>
<span id="cb12-14">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Get names of variables in data</span></span>
<span id="cb12-15">  dnms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(data) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># all</span></span>
<span id="cb12-16">  dnms2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dnms[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>dnms <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(avarn,cvarn)]</span>
<span id="cb12-17">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Create sequence of ages that cover full range of ages</span></span>
<span id="cb12-18">  tmpages <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(data)[,avarn],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb12-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(tmpages) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> avarn</span>
<span id="cb12-20">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Create fill list for unobserved ages</span></span>
<span id="cb12-21">  fills <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,dnms2]),fill)</span>
<span id="cb12-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(fills) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dnms2,cvarn)  </span>
<span id="cb12-23">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Add zeroes to ages not observed</span></span>
<span id="cb12-24">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(tmpages,data,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span>avarn) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-25">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(fills)</span>
<span id="cb12-26">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Return data frame with columns ordered as in original data</span></span>
<span id="cb12-27">  tmp[,dnms]</span>
<span id="cb12-28">}</span></code></pre></div>
</div>
<p><code>add0CatchByAge()</code> takes a data frame (with at least age and catch variables) as the first argument, unquoted names for “age” and “catch” variables in <code>avar=</code> and <code>cvar=</code>, and the value to fill in for the catch of unobserved ages in <code>fill=</code> (defaults to 0). The example below shows how zeroes are filled in for the unobserved ages of Channel Catfish captured in the Fall.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">tmpex <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span>,Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span>) <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## temporary data frame for example</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add0CatchByAge</span>(tmpex,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cvar=</span>Catch)            <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## example result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     Spp Season Age Catch
#R|  1  CCF   Fall   1    15
#R|  2  CCF   Fall   2    22
#R|  3  CCF   Fall   3     3
#R|  4  CCF   Fall   4    16
#R|  5  CCF   Fall   5    29
#R|  6  CCF   Fall   6    23
#R|  7  CCF   Fall   7    20
#R|  8  CCF   Fall   8    29
#R|  9  CCF   Fall   9    22
#R|  10 CCF   Fall  10    12
#R|  11 CCF   Fall  11     2
#R|  12 CCF   Fall  12     0
#R|  13 CCF   Fall  13     0
#R|  14 CCF   Fall  14     1
#R|  15 CCF   Fall  15     2
#R|  16 CCF   Fall  16     0
#R|  17 CCF   Fall  17     3</code></pre>
</div>
</div>
</section>
<section id="adding-the-zeroes" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="adding-the-zeroes">Adding the Zeroes</h3>
<p>Adding the zeroes must be done on a <em>per-group</em> basis, which is by species-season combination here. Thus, the <code>CatAge</code> summary data frame is <code>split()</code> by <code>Spp</code> and <code>Season</code> into a list of four data frames.<sup>3</sup> This list of data frames is then given to <code>map_df()</code> which applies <code>add0CatchByAge()</code> to each of the four data frames using <code>Age</code> for <code>avar=</code> and <code>Catch</code> for <code>cvar=</code>. The four data frames are then row-bound together to return one overall data frame.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;The process of using <code>split()</code> was defined more thoroughly in <a href="../2023-4-23_Multiple_ALKs/">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">CatAge <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Season) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(add0CatchByAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cvar=</span>Catch)</span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(CatAge)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     Spp Season Age Catch
#R|  1  CCF   Fall   1    15
#R|  2  CCF   Fall   2    22
#R|  3  CCF   Fall   3     3
#R|  60 WAE Spring  16     2
#R|  61 WAE Spring  17     0
#R|  62 WAE Spring  18     2</code></pre>
</div>
</div>
<p>The result is a single data frame with the same variables as the original <code>CatAge</code>, but with new rows of <code>Catch</code>=0 for unobserved <code>Age</code>s. This is best seen by examining the portion of the new <code>CatAge</code> summary data frame for Channel Catfish captured in the Fall.</p>
<div class="cell" data-layout-align="center" data-output-line-numbers="1,13,14,17">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span>,Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="sourceCode" id="cb18" data-code-line-numbers="1,13,14,17" style="background: #f1f3f5;"><pre class="sourceCode numberSource highlight numberLines code-with-copy"><code class="sourceCode"><span id="cb18-1">#R|     Spp Season Age Catch</span>
<span id="cb18-2">#R|  1  CCF   Fall   1    15</span>
<span id="cb18-3">#R|  2  CCF   Fall   2    22</span>
<span id="cb18-4">#R|  3  CCF   Fall   3     3</span>
<span id="cb18-5">#R|  4  CCF   Fall   4    16</span>
<span id="cb18-6">#R|  5  CCF   Fall   5    29</span>
<span id="cb18-7">#R|  6  CCF   Fall   6    23</span>
<span id="cb18-8">#R|  7  CCF   Fall   7    20</span>
<span id="cb18-9">#R|  8  CCF   Fall   8    29</span>
<span id="cb18-10">#R|  9  CCF   Fall   9    22</span>
<span id="cb18-11">#R|  10 CCF   Fall  10    12</span>
<span id="cb18-12">#R|  11 CCF   Fall  11     2</span>
<span id="cb18-13">#R|  12 CCF   Fall  12     0</span>
<span id="cb18-14">#R|  13 CCF   Fall  13     0</span>
<span id="cb18-15">#R|  14 CCF   Fall  14     1</span>
<span id="cb18-16">#R|  15 CCF   Fall  15     2</span>
<span id="cb18-17">#R|  16 CCF   Fall  16     0</span>
<span id="cb18-18">#R|  17 CCF   Fall  17     3</span></code></pre></div>
</div>
</div>
<p>This data frame is now ready for catch curve analysis.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="catch-curve-analysis-for-multiple-groups" class="level1 page-columns page-full">
<h1>Catch Curve Analysis for Multiple Groups</h1>
<section id="data-preparation" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="data-preparation">Data Preparation</h3>
<p>A catch curve plots log catch versus age, though in this case, because of the presence of zero catches for some ages, log catch plus 1 was used.<sup>4</sup> Below a new variable called <code>Catch1</code> is added to <code>CatAge</code> that contains the catch plus 1 value and the log of this is taken to create <code>logCatch1</code>. <code>Catch1</code> is needed because <code>catchCurve()</code> from <code>FSA</code> requires the raw “catch” data. <code>logCatch1</code> is needed for plotting.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;In <a href="../2023-4-1_Milleretal2022_Fig4/">this previous post</a> I question whether it is appropriate to add 1 to the catch data for this purpose.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">CatAge <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Catch1=</span>Catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb19-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">logCatch1=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(Catch1))</span>
<span id="cb19-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(CatAge)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     Spp Season Age Catch Catch1 logCatch1
#R|  1  CCF   Fall   1    15     16  2.772589
#R|  2  CCF   Fall   2    22     23  3.135494
#R|  3  CCF   Fall   3     3      4  1.386294
#R|  60 WAE Spring  16     2      3  1.098612
#R|  61 WAE Spring  17     0      1  0.000000
#R|  62 WAE Spring  18     2      3  1.098612</code></pre>
</div>
</div>
<p>In general, instantaneous mortality (<img src="https://latex.codecogs.com/png.latex?Z">) is only estimated from the slope of the “descending limb” of the catch curve. The plot below is used to identify the “descending limb”, though I ultimately used the ages defined by <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>:</p>
<ul>
<li><em>Channel Catfish, Fall</em> – ages 5 and older</li>
<li><em>Channel Catfish, Spring</em> – ages 6 and older</li>
<li><em>Walleye, Fall</em> – ages 1 and older</li>
<li><em>Walleye, Spring</em> – ages 2 and older</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>CatAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logCatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rows=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Spp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Season)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/index_files/figure-html/preliminary-catch-curve-plot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this, a new summary data frame (i.e., <code>CatAgeReduced</code>) is created that is the same as <code>CatAge</code> but with all ages <strong>not on the descending limb removed</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">CatAgeReduced <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAge <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WAE"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WAE"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</div>
<p>The data were plotted with this new data frame to ensure that the descending limbs were retained as defined in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>CatAgeReduced,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logCatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rows=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Spp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Season)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/index_files/figure-html/preliminary-catch-curve-plot-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, the overall number of fish for each species and season was computed to compare to results in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>. The number of Channel Catfish retained here was the same for Fall, but one fewer for Spring than in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>. The number of Walleye retained here was one more for Fall and eight more for Spring than in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>. Thus, my mortality calculations in the next section will likely differ slightly from those published in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">CatAgeReduced <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Spp,Season) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Schall_n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">143</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">423</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1217</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">293</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 4 × 4
#R|    Spp   Season     n Schall_n
#R|    &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt;
#R|  1 CCF   Fall     143      143
#R|  2 CCF   Spring   422      423
#R|  3 WAE   Fall    1218     1217
#R|  4 WAE   Spring   301      293</code></pre>
</div>
</div>
</section>
<section id="catch-curve-results" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="catch-curve-results">Catch Curve Results</h3>
<p>The catch curve calculations for one data frame can be performed efficiently with <code>catchCurve()</code> from <code>FSA</code>. Thus, to use this function for multiple groups of data, the reduced catch-at-age data frame must be <code>split()</code> into a list of separate data frames by <code>Spp</code> and <code>Season</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">CatAgeRedSplit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAgeReduced <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Season)</span></code></pre></div>
</div>
<p>A helper function was then created that performs the catch curve analysis with <code>catchCurve()</code> and extracts the instantaneous and total (<img src="https://latex.codecogs.com/png.latex?A">) mortality rate estimates, along with their 95% confidence intervals. This function takes the data frame (with at least the catch and age data) as its first argument and a formula of the form <code>cvar~avar</code>. Additional named arguments to <code>catchCurve()</code>, for example <code>weighted=TRUE</code>, can also be included.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;See <code>?catchCurve</code> for more information on <code>catchCurve()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Performs catch curve analysis, extracts A &amp; Z estimates and CIs</span></span>
<span id="cb27-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   data: The data frame with, at least, the age &amp; catch variables</span></span>
<span id="cb27-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   formula: A formula of the form `cvar~avar` where cvar is the catch variable</span></span>
<span id="cb27-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##            in data and avar is the age variable in data</span></span>
<span id="cb27-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   ...: Additional arguments for FSA::catchCurve()</span></span>
<span id="cb27-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Returns a named vector with the A &amp; Z estimates and CIs</span></span>
<span id="cb27-7"></span>
<span id="cb27-8">getCCresults <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,formula,...) {</span>
<span id="cb27-9">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(formula,data,...)</span>
<span id="cb27-10">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(tmp),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>))</span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(res) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z.LCI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z.UCI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A.LCI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A.UCI"</span>)</span>
<span id="cb27-12">  res[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)]</span>
<span id="cb27-13">}</span></code></pre></div>
</div>
<p>As an example, this function is used below to fit a weighted catch curve to Channel Catfish captured in the Spring. Note the use of <code>Catch1</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getCCresults</span>(CatAgeRedSplit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CCF.Spring,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>Catch1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## example</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|           Z      Z.LCI      Z.UCI          A      A.LCI      A.UCI 
#R|   0.3466275  0.1303087  0.5629463 29.2931353 12.2175614 43.0471425</code></pre>
</div>
</div>
<p>Similar to before, <code>getCCresults()</code> is applied to each data frame in <code>CatAgeRedSplit</code> with <code>map_df()</code> to return a data frame of catch curve analysis results by group. <code>.id</code> is used here in <code>map_df()</code> to create a variable in the returned data frame that contains the names of “items” from <code>CatAgeRedSplit</code>. This is required because <code>getCCresults()</code> does not return any identifier for which group the result is for.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">ccresults <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAgeRedSplit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(getCCresults,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>Catch1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>)</span>
<span id="cb30-3">ccresults</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 4 × 7
#R|    Group          Z  Z.LCI Z.UCI     A A.LCI A.UCI
#R|    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|  1 CCF.Fall   0.359 0.221  0.496  30.2 19.9   39.1
#R|  2 WAE.Fall   0.741 0.509  0.973  52.3 39.9   62.2
#R|  3 CCF.Spring 0.347 0.130  0.563  29.3 12.2   43.0
#R|  4 WAE.Spring 0.229 0.0906 0.367  20.5  8.67  30.7</code></pre>
</div>
</div>
<p>The point and interval estimates for <img src="https://latex.codecogs.com/png.latex?A"> are reasonably close to those published in <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> given the inherent randomization in applying the ALK and the minor differences in sample sizes here versus what they reported.</p>
<p>While it is not needed in this post, it will be common to need to “split” the <code>Group</code> variable in <code>ccresults</code> back into its constituent parts (i.e., <code>Spp</code> and <code>Season</code>). As the constituent parts in <code>Group</code> are consistently separated with a <code>.</code>, this can be easily accomplished with <code>separate_wider_delim()</code> from <code>tidyr</code> as shown below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">ccresults <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ccresults <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb32-2">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(Group,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spp"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Season"</span>))</span>
<span id="cb32-3">ccresults</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 4 × 8
#R|    Spp   Season     Z  Z.LCI Z.UCI     A A.LCI A.UCI
#R|    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|  1 CCF   Fall   0.359 0.221  0.496  30.2 19.9   39.1
#R|  2 WAE   Fall   0.741 0.509  0.973  52.3 39.9   62.2
#R|  3 CCF   Spring 0.347 0.130  0.563  29.3 12.2   43.0
#R|  4 WAE   Spring 0.229 0.0906 0.367  20.5  8.67  30.7</code></pre>
</div>
</div>
</section>
<section id="catch-curve-figure" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="catch-curve-figure">Catch Curve Figure</h3>
<p><span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> displayed their catch curve results in their <a href="https://meridian.allenpress.com/view-large/figure/13413355/i1944-687X-12-1-223-f03.tif">Figure 3</a>. The biggest challenge to recreating this figure is that their regression lines are from the <strong>weighted</strong> regression on the descending limb. The weights used are stored in the result from <code>catchCurve()</code>, but again this functions needs to be applied on a <em>per-group</em> basis. As such, a helper function was created below that performs the catch curve analysis as above, but instead of extracting results it extracts the weights used, appends them to the data frame given to the function, and returns the modified data frame. Thus, this function serves to append the weights used to the original data used.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Performs catch curve analysis and adds estimated weights to data</span></span>
<span id="cb34-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   data: The data frame with, at least, the age &amp; catch variables</span></span>
<span id="cb34-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   formula: A formula of the form `cvar~avar` where cvar is the catch variable</span></span>
<span id="cb34-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##            in data and avar is the age variable in data</span></span>
<span id="cb34-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   ...: Additional arguments for FSA::catchCurve()</span></span>
<span id="cb34-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Returns the data data frame with the catch curve weights in wts variable</span></span>
<span id="cb34-7"></span>
<span id="cb34-8">addCCweights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,formula,...) {</span>
<span id="cb34-9">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(formula,data,...)</span>
<span id="cb34-10">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wts=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>w)</span>
<span id="cb34-11">  data</span>
<span id="cb34-12">}</span></code></pre></div>
</div>
<p>This function is then applied to each data frame in <code>CatAgeRedSplit</code> with <code>map_df()</code> to produce a modified data frame with the weights used.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">CatAgeRedWts<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CatAgeRedSplit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(addCCweights,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>Catch1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(CatAgeRedWts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     Spp Season Age Catch Catch1 logCatch1       wts
#R|  1  CCF   Fall   5    29     30  3.401197 3.5075254
#R|  2  CCF   Fall   6    23     24  3.178054 3.2178363
#R|  3  CCF   Fall   7    20     21  3.044522 2.9281472
#R|  51 WAE Spring  16     2      3  1.098612 0.6867394
#R|  52 WAE Spring  17     0      1  0.000000 0.4800235
#R|  53 WAE Spring  18     2      3  1.098612 0.2733075</code></pre>
</div>
</div>
<p>The main part of reproducing Figure 3 consists of creating three “layers” of data:</p>
<ul>
<li>Plot <code>logCatch1</code> versus <code>Age</code> from <code>CatAge</code> with an open circle (i.e., <code>pch=21</code>) with different outline colors based on <code>Season</code>. This will produce an open circle for the log catch at all ages across the range of observed ages.</li>
<li>Over plot <code>logCatch</code> versus <code>Age</code> from <code>CatAgeRedWts</code> with a circle (i.e., <code>pch=21</code>) with different outline <strong>and</strong> fill colors based on <code>Season</code>. This will “fill” the open circles for ages on the descending limb of the catch curve.</li>
<li>Over plot the weighted regression line with colors based on <code>Season</code> and using <code>weight=</code>s given in <code>wts</code>, but which will be separated by season.<sup>6</sup></li>
<li>Create separate facets by <code>Spp</code>.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;This use of the <code>weight=</code> <code>aes()</code>thetic was described in <a href="../2023-4-1_Milleretal2022_Fig4/#recreating-figure-4">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>CatAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logCatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season),</span>
<span id="cb37-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>CatAgeRedWts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logCatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Season),</span>
<span id="cb37-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>CatAgeRedWts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logCatch1,</span>
<span id="cb37-7">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Season,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight=</span>wts),</span>
<span id="cb37-8">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span>lm) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (yrs)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log (Catch+1)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>),</span>
<span id="cb37-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aesthetics=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Spp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labeller</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Spp=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel Catfish"</span>,</span>
<span id="cb37-14">                                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WAE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Walleye"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb37-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb37-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>),</span>
<span id="cb37-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb37-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb37-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/index_files/figure-html/schall-figure-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-schalletal_2020" class="csl-entry">
Schall, B. J., C. W. Schoenebeck, and K. D. Koupal. 2020. <a href="https://doi.org/10.3996/JFWM-20-027">Seasonal sampling influence on population dynamics and yield of <span>Channel Catfish</span> and <span>Walleye</span> in a large <span>Great Plains</span> reservoir</a>. Journal of Fish and Wildlife Management 12(1):223–233.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Working with {Multiple} {Catch} {Curves}},
  date = {2023-04-24},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-24_Multiple_CatchCurves},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 24. Working with Multiple Catch Curves. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-24_Multiple_CatchCurves">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-24_Multiple_CatchCurves</a>.
</div></div></section></div> ]]></description>
  <category>Data Wrangling</category>
  <category>Age-Length Key</category>
  <category>Mortality</category>
  <category>Catch Curve</category>
  <category>purr</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/</guid>
  <pubDate>Mon, 24 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-24_Multiple_CatchCurves/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Working with Multiple Age-Length Keys</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-23_Multiple_ALKs/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>An age-length key (ALK) describes the relationship between length (category) and age of fish. An estimated age may be assigned to unaged fish in a sample based on the ALK derived from aged fish from the same (or very closely related) sample as described by <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> and implemented in <code>FSA</code> <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">(Ogle 2016)</span>. It is critical to this process that the ALK is representative of the fish to which ages will be assigned. Thus, for example, it is not recommended to use an ALK developed from fish collected in one year to assign age to fish collected in another year.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;The same argument can be made for fish from different areas.</p></div></div><p>This recommendation can lead to cumbersome data wrangling during analysis. For example, suppose that samples of fish were collected from two different areas over a five year period. In this case separate age-length keys would be required to be developed and applied for the ten combinations of locations and years. For each location-year the specific data would need to be isolated and for that data the ALK developed and applied, which has several steps as was shown in <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span> and will be outlined below. The final data produced for each location-year would then need to be combined back together to make an overall data set. In other words, using the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method to assign estimated ages to unaged fish for multiple groups of fish is quite a bit of work. The goal of this post is to provide a more efficient method to accomplish this task.</p>
<p>The following packages are loaded for use below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, tidyr, purr packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for ALK functionality</span></span></code></pre></div>
</div>
<p>The random number seed was set to ensure repeatability for the random components of <code>alkIndivAge()</code> below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14354454</span>)</span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="age-length-keys-in-fsa" class="level1 page-columns page-full">
<h1>Age-Length Keys in FSA</h1>
<section id="original-example-from-ogle-2016" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="original-example-from-ogle-2016">Original Example from Ogle (2016)</h3>
<p><span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span> demonstrated the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method for assigning ages to unaged Creek Chubs (<em>Semotilus atromaculatus</em>). The portion of the script used there to produce a final data frame with ages for all sampled fish is shown below.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;This code was extracted from the script provided <a href="https://derekogle.com/IFAR/">here</a>. It is slightly modified here to maintain the original unaltered data frame in <code>cc</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Load data</span></span>
<span id="cb3-2">cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://derekogle.com/IFAR/scripts/CreekChub.csv"</span>)</span>
<span id="cb3-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Add length category variable</span></span>
<span id="cb3-4">cc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cc <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lcat10=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lencat</span>(len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb3-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Separate aged and unaged fish</span></span>
<span id="cb3-6">cc1.unaged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cc1,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(age))</span>
<span id="cb3-7">cc1.aged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cc1,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(age))</span>
<span id="cb3-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Develop ALK from aged fish</span></span>
<span id="cb3-9">alk.freq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>lcat10<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>cc1.aged)</span>
<span id="cb3-10">alk <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(alk.freq,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-11"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Use I-K method to assign ages to unaged fish</span></span>
<span id="cb3-12">cc1.unaged.mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alkIndivAge</span>(alk,age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>cc1.unaged)</span>
<span id="cb3-13"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Create overall data frame with ages for all fish</span></span>
<span id="cb3-14">cc1.fnl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(cc1.aged,cc1.unaged.mod)</span></code></pre></div>
</div>
<p>The lengths-at-age in this final data frame may be summarized as follows.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">cc1.fnl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb4-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mn=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb4-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    age   n        mn       sd
#R|  1   0  20  48.65000  5.62209
#R|  2   1 142  74.64789 16.82163
#R|  3   2  43 113.41860 15.77405
#R|  4   3   8 151.87500 11.17954
#R|  5   4   5 183.20000 17.25399</code></pre>
</div>
</div>
</section>
<section id="simplifying-function" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="simplifying-function">Simplifying Function</h3>
<p>I have resisted writing a function that would combine all the steps above, as I did not want to create a “black-box” function for this analysis that could be implemented without much thought. However, such a function would be useful for efficiently applying ALKs to multiple groups of fish. Thus, I create such a function and demonstrate how it can be used to produce the same results as those shown for Creek Chub in <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span>.<sup>3</sup> In the next section, I demonstrate how this new function can then be used to efficiently apply ALKs for multiple groups of fish.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;he same at least within rounding because of the inherent randomization in the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method.</p></div><div id="fn4"><p><sup>4</sup>&nbsp;This allows the variable names to be supplied by user in the function call, rather than hard-coded in the function.</p></div></div><p>The <code>applyALK()</code> function created below performs the code shown above to create a “final” data frame that has ages assigned to the unaged fish based on the ALK. The function largely repeats the code above but uses some “advanced” code (e.g., <code>deparse(substitute())</code> and <code>{{}}</code>) to handle the use of unquoted variables names.<sup>4</sup></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Computes and applies an ALK</span></span>
<span id="cb6-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   data: The data frame with, at least, the age &amp; length variables</span></span>
<span id="cb6-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   avar: The name (without quotes) of the age variable in data</span></span>
<span id="cb6-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   lvar: The name (without quotes) of the length variable in data</span></span>
<span id="cb6-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   w: The width of length categories/bins for use in the ALK</span></span>
<span id="cb6-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Returns the data data frame with ages in avar assigned from the ALK for</span></span>
<span id="cb6-7"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   unaged fish and a new length category (lcat) variable derived from w</span></span>
<span id="cb6-8"></span>
<span id="cb6-9">applyALK <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data,avar,lvar,w) {</span>
<span id="cb6-10">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Get avar variable name as character for non-tidyverse functions below</span></span>
<span id="cb6-11">  avarn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deparse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substitute</span>(avar))</span>
<span id="cb6-12">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Add length category variable</span></span>
<span id="cb6-13">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lcat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lencat</span>({{lvar}},<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span>w))</span>
<span id="cb6-14">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Separate into aged and unaged dataframes</span></span>
<span id="cb6-15">  aged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>({{avar}}))</span>
<span id="cb6-16">  unaged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>({{avar}}))</span>
<span id="cb6-17">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Make ALK (find frequencies, convert to row proportions)</span></span>
<span id="cb6-18">  ALK <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.formula</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~lcat+"</span>,avarn)),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>aged),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-19">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Apply ALK according to Isermann-Knight method</span></span>
<span id="cb6-20">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alkIndivAge</span>(ALK,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.formula</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(avarn,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~lcat"</span>)),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>unaged)</span>
<span id="cb6-21">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Put aged and newly assigned age data frames together to return</span></span>
<span id="cb6-22">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(aged,tmp)</span>
<span id="cb6-23">}</span></code></pre></div>
</div>
<p>With this new function the final data frame can be created by supplying the original data frame (with aged and unaged fish) as the first argument, the names of the age and length variables in <code>avar=</code> and <code>lvar=</code> respectively, and the width for the length categories/bins in <code>w=</code>. For example, the final data frame for the Creek Chub case study can be created as follows.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Note the use the original <code>cc</code> data frame without the length categorization variable.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">cc.fnl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">applyALK</span>(cc,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lvar=</span>len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
</div>
<p>The lengths-at-age summary for this final data frame is similar to that from above.<sup>6</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Again, not exact because of the inherent randomization in the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">cc.fnl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb8-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mn=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb8-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(len,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    age   n        mn        sd
#R|  1   0  20  48.95000  6.012925
#R|  2   1 142  74.66197 16.955046
#R|  3   2  43 113.23256 15.929663
#R|  4   3   8 151.87500 11.179541
#R|  5   4   5 183.20000 17.253985</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>One still needs to carefully consider the application of ALKs for each of the groups. For example, if the minimum length of unaged fish is less than the minimum length of aged fish (i.e., smaller than that which the ALK is based on) for any one group then this process will fail for ALL groups. In other words a complete fail will occur if there is a fail for any one group in the analysis.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="efficiently-applying-alks-to-multiple-groups" class="level1 page-columns page-full">
<h1>Efficiently Applying ALKs to Multiple Groups</h1>
<section id="example-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="example-data">Example Data</h3>
<p><span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> examined the effect of season (Spring and Fall) on the vital statistics of Channel Catfish (<em>Ictalurus punctatus</em>) and Walleye (<em>Sander vitreus</em>) in a large Nebraska reservoir. One part of their analysis required computing mortality rates from catch curves for each species and season combination. Prior to constructing the catch curve they used the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method to assign estimated ages to unaged fish. <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> provided the raw data as a CSV file in their Supplement Material Data S1. Note that I removed some variables here for simplicity of presentation in this post, and that their <code>Month</code> completely defined <code>Season</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JFWM-20-027.S1.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Year,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Weight,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Sex,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>BCAge,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>BCLength) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Season=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb10-4">    Month<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"May"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span>,</span>
<span id="cb10-5">    Month<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"September"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span></span>
<span id="cb10-6">  ))</span>
<span id="cb10-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Spp Length     Month Age Season
#R|  1    CCF    279       May   3 Spring
#R|  2    CCF    334       May   4 Spring
#R|  3    CCF    351       May   4 Spring
#R|  2377 WAE     NA September  NA   Fall
#R|  2378 WAE     NA September  NA   Fall
#R|  2379 WAE     NA September  NA   Fall</code></pre>
</div>
</div>
<p>A common “issue” with using the ALK to assign ages to unaged fish is that the lengths of some unaged fish are not represented within the lengths of aged fish used to derive the ALK. In other words, the ALK does not contain information for fish of those lengths. The summary below is used to find the sample size and valid sample size (i.e., after excluding fish with no length measurement) and minimum and maximum length for each combination of species, season, and whether an age was assigned or not.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Aged=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Spp,Season,Aged) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb12-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">validn=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">validn</span>(Length),</span>
<span id="cb12-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb12-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 7
#R|  # Groups:   Spp, Season [4]
#R|    Spp   Season Aged      n validn  minL  maxL
#R|    &lt;chr&gt; &lt;chr&gt;  &lt;lgl&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
#R|  1 CCF   Fall   FALSE   105    104   197   674
#R|  2 CCF   Fall   TRUE     97     97   200   724
#R|  3 CCF   Spring FALSE   394    393   260   733
#R|  4 CCF   Spring TRUE    104    104   279   769
#R|  5 WAE   Fall   FALSE   883    870   181   634
#R|  6 WAE   Fall   TRUE    466    466   157   676
#R|  7 WAE   Spring FALSE   117    116   332   724
#R|  8 WAE   Spring TRUE    213    213   191   753</code></pre>
</div>
</div>
<p>It is seen from this that there are some missing length measurements (<code>n</code> does not equal <code>validn</code> in all cases) and that the minimum length of unaged fish is less than the minimum length of aged fish for Channel Catfish in both the Spring and Fall. Thus, to appropriately use the <span class="citation" data-cites="isermannknight_2005">Isermann and Knight (2005)</span> method as implemented in <code>alkIndivAge()</code> of <code>FSA</code>, those records with missing lengths must be removed, as well as those records for Channel Catfish that are less than the minimum length for aged Channel Catfish in their respective season.<sup>7</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;It is not clear that <span class="citation" data-cites="schalletal_2020">Schall et al. (2020)</span> did this, but it is required when using <code>alkIndivAge()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Length)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spring"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Length<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">279</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CCF"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Season<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fall"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Length<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>))</span></code></pre></div>
</div>
</section>
<section id="method-specific-data-wrangling" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="method-specific-data-wrangling">Method-Specific Data Wrangling</h3>
<p>The first step in efficiently applying the ALK to all groups is to “split” the original data frame based on the “groups” with <code>split()</code>. Below <code>dat</code> is split by the combination of <code>Spp</code> (species) and <code>Season</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(dat,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Spp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Season)</span></code></pre></div>
</div>
<p>The result, in <code>dat2</code>, is a list with four items. Each item in the list is a data frame with the same structure as the original <code>dat</code> but reduced to a specific group defined by <code>Spp</code> and <code>Season</code>. Below <code>names()</code> is used to show that the names of the four items in <code>dat2</code> are combinations of the “levels” in <code>Spp</code> and <code>Season</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "CCF.Fall"   "WAE.Fall"   "CCF.Spring" "WAE.Spring"</code></pre>
</div>
</div>
<p>The specifics of one of these items is examined by appending the item name to <code>dat2</code>, separated by a <code>$</code>. Below, as an example, are a few rows from the beginning and end of the data frame in <code>CCF.Spring</code> (Channel Catfish in Spring).<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Note here that it appears that all <code>Spp</code> values are “CCF”, all <code>Season</code> values are “Spring”, and that some fish have ages (the top three) and some do not (the bottom three).</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CCF.Spring)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Spp Length Month Age Season
#R|  1   CCF    279   May   3 Spring
#R|  2   CCF    334   May   4 Spring
#R|  3   CCF    351   May   4 Spring
#R|  491 CCF    701   May  NA Spring
#R|  492 CCF    730   May  NA Spring
#R|  493 CCF    733   May  NA Spring</code></pre>
</div>
</div>
</section>
<section id="applying-alk" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="applying-alk">Applying ALK</h3>
<p>The idea now is to “apply” <code>applyALK()</code> to each data frame in each item of the list in <code>dat2</code>. This can be done with <code>lapply()</code> where the list of data frames is the first argument, the function to apply is the second argument, and the remaining arguments are further arguments to the function being applied. The result is a list with data frames in the items as before, but now with ages for all fish.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(dat2,applyALK,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lvar=</span>Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dat3)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "CCF.Fall"   "WAE.Fall"   "CCF.Spring" "WAE.Spring"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CCF.Spring)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Spp Length Month Age Season lcat
#R|  1   CCF    279   May   3 Spring  270
#R|  2   CCF    334   May   4 Spring  330
#R|  3   CCF    351   May   4 Spring  350
#R|  491 CCF    701   May  17 Spring  700
#R|  492 CCF    730   May  17 Spring  730
#R|  493 CCF    733   May  17 Spring  730</code></pre>
</div>
</div>
<p>The exact same result<sup>9</sup> is also obtained with <code>map()</code> from the <code>purr</code> package, which was loaded with <code>library(tidyverse)</code>. The arguments to <code>map()</code> and the resulting list are the same as those for <code>lapply()</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;Disregarding the randomization inherent in <code>alkIndivAge()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(dat2,applyALK,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lvar=</span>Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dat3)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "CCF.Fall"   "WAE.Fall"   "CCF.Spring" "WAE.Spring"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CCF.Spring)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Spp Length Month Age Season lcat
#R|  1   CCF    279   May   3 Spring  270
#R|  2   CCF    334   May   4 Spring  330
#R|  3   CCF    351   May   4 Spring  350
#R|  491 CCF    701   May  17 Spring  700
#R|  492 CCF    730   May  17 Spring  730
#R|  493 CCF    733   May  17 Spring  730</code></pre>
</div>
</div>
<p>The reason for introducing <code>map()</code> from <code>purr()</code> is that ultimately the four data frames in <code>dat3</code> need to be “row-bound” together to form a single data frame. There are multiple ways to do this, but the simplest is to use <code>map_df()</code> from <code>purr</code>. <code>map_df()</code> has the same arguments as <code>map()</code> and <code>lapply()</code> but it returns a single combined data frame, rather than a list with multiple data frames.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(dat2,applyALK,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avar=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lvar=</span>Length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dat3)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># now column names of the single data frame</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "Spp"    "Length" "Month"  "Age"    "Season" "lcat"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat3)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Spp Length     Month Age Season lcat
#R|  1    CCF    232 September   1   Fall  230
#R|  2    CCF    216 September   1   Fall  210
#R|  3    CCF    238 September   1   Fall  230
#R|  2355 WAE    632       May  10 Spring  630
#R|  2356 WAE    653       May  10 Spring  650
#R|  2357 WAE    720       May  13 Spring  720</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process, as shown above, will not handle situations where the length category bin width required differs among the groups.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="preview---summaries" class="level1">
<h1>Preview - Summaries</h1>
<p>While there are still some issues to deal with before the mortality rate can be estimated via catch curve with these data, the summary table and graphic below provide an indication of how the final result from above can be visualized. The issue of estimating mortality rate from these data will be taken up in <a href="../2023-4-24_Multiple_CatchCurves/">the next post</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">sumdat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Spp,Season,Age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb32-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Length),</span>
<span id="cb32-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(Length))</span>
<span id="cb32-6">sumdat1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 53 × 6
#R|  # Groups:   Spp, Season [4]
#R|     Spp   Season   Age Catch meanL   sdL
#R|     &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|   1 CCF   Fall       1    15  227.  14.7
#R|   2 CCF   Fall       2    22  262.  37.7
#R|   3 CCF   Fall       3     3  309   27.7
#R|   4 CCF   Fall       4    16  359.  15.4
#R|   5 CCF   Fall       5    30  384.  37.5
#R|   6 CCF   Fall       6    21  405.  23.4
#R|   7 CCF   Fall       7    22  430.  25.1
#R|   8 CCF   Fall       8    29  449.  40.6
#R|   9 CCF   Fall       9    22  488.  40.3
#R|  10 CCF   Fall      10    11  495.  29.5
#R|  # … with 43 more rows</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>sumdat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Season)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (yrs)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>),</span>
<span id="cb34-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Spp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb34-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb34-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>),</span>
<span id="cb34-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb34-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-23_Multiple_ALKs/index_files/figure-html/data-sum-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-isermannknight_2005" class="csl-entry">
Isermann, D., and C. Knight. 2005. <a href="https://www.researchgate.net/publication/233185504_A_Computer_Program_for_Age-Length_Keys_Incorporating_Age_Assignment_to_Individual_Fish">A computer program for age–length keys incorporating age assignment to individual fish</a>. North American Journal of Fisheries Management 25:1153–1160.
</div>
<div id="ref-ogleIntroductoryFisheriesAnalyses2016" class="csl-entry">
Ogle, D. H. 2016. <a href="http://derekogle.com/IFAR/">Introductory <span>Fisheries Analyses</span> with <span>R</span></a>. <span>CRC Press</span>, <span>Boca Raton, FL</span>.
</div>
<div id="ref-schalletal_2020" class="csl-entry">
Schall, B. J., C. W. Schoenebeck, and K. D. Koupal. 2020. <a href="https://doi.org/10.3996/JFWM-20-027">Seasonal sampling influence on population dynamics and yield of <span>Channel Catfish</span> and <span>Walleye</span> in a large <span>Great Plains</span> reservoir</a>. Journal of Fish and Wildlife Management 12(1):223–233.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Working with {Multiple} {Age-Length} {Keys}},
  date = {2023-04-23},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-23_Multiple_ALKs},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 23. Working with Multiple Age-Length Keys. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-23_Multiple_ALKs">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-23_Multiple_ALKs</a>.
</div></div></section></div> ]]></description>
  <category>Data Wrangling</category>
  <category>Age-Length Key</category>
  <category>purr</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-23_Multiple_ALKs/</guid>
  <pubDate>Sun, 23 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-23_Multiple_ALKs/preview.png" medium="image" type="image/png" height="63" width="144"/>
</item>
<item>
  <title>Murphy et al. (2021) Model Comparison Plots</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> examined the ability to use Landsat thermal imagery and a variety of possible environmental data to predict water temperatures in small streams in Alaska. Their <a href="https://meridian.allenpress.com/view-large/figure/13414081/i1944-687X-12-1-12-f03.tif">Figure 3</a> is a fairly complex graphic that shows hows Landsat observations and predictions from a variety of generalized additive mixed models (GAMMs) compared to <em>in situ</em> water temperature measurements. Here I use <code>ggplot2</code> to try to recreate their figure.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>FSA</code>, <code>gtext</code>, and <code>scales</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for placing multiple plots</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mgcv)       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for GAMM analyses</span></span></code></pre></div>
</div>
<p>Some of the results below include randomization. To promote reproducibility, the random seed is set here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7834344</span>)</span></code></pre></div>
</div>
<p>Finally, to help keep the <code>ggplot2</code> code near the end simpler, the following custom theme was created. Its components will be described further below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">theme_murphy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() {</span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb3-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>),</span>
<span id="cb3-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb3-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb3-7">}</span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling-i" class="level1 page-columns page-full">
<h1>Data Wrangling I</h1>
<p><span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> provided the raw data to produce Figure 3 in their Data S1 supplemental material, which I loaded below. <code>DateTime</code> was converted to a proper date variable, <code>SiteCode</code> was converted to a factor,<sup>1</sup> only the variables needed for this post were retained, and only observations where both an <em>in situ</em> temperature reading and a Landsat prediction were made.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Which is required by <code>gam()</code> further below.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JFWM-20-048.S1.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">DateTime=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),</span>
<span id="cb4-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SiteCode=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(SiteCode)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(SiteCode,DateTime,In.Situ,Landsat,AirDaily,GageDaily,GageDiff) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(In.Situ),<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Landsat))</span>
<span id="cb4-6">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     SiteCode   DateTime In.Situ Landsat  AirDaily GageDaily     GageDiff
#R|  1      CR-1 2015-05-30  11.625   20.74 14.441667 1.0161458 -0.090178571
#R|  2      CR-1 2015-06-15  14.721   24.46 18.437500 0.9594792 -0.193854167
#R|  3      CR-1 2015-07-01   9.682   14.03  8.554167 0.7387500 -0.006904762
#R|  45     SF-3 2015-08-11  12.727   14.26 10.429167 0.6050000  0.005699405
#R|  46     SF-3 2015-08-18  12.001   14.06 11.433333 0.9793750  0.322574405
#R|  47     SF-3 2015-09-12   8.792    7.52  7.354167 0.9212500 -0.010520833</code></pre>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="gamms" class="level1 page-columns page-full">
<h1>GAMMs</h1>
<p><span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> reported results from the fitting of four GAMMs in panels B-E in their Figure 3. Each model consisted of some combination of Landsat predictions (<code>Landsat</code>) and three environmental variables (<code>AirDaily</code>, <code>GageDaily</code>, and <code>GageDiff</code>) as smoothed fixed effects. Each model also included the specific locations (<code>siteCode</code>) as a smoothed random effect. The four models shown in Figure 3 were the “top models” from many other models considered in the paper.</p>
<section id="fitting-models" class="level2">
<h2 class="anchored" data-anchor-id="fitting-models">Fitting Models</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>My goal here is not to fully demonstrate how to fit GAMMs in R, rather I want to show how Figure 3 was constructed. I am not an expert with GAMMs and am, in fact, still learning how to properly use and interpret them. Thus, be cautious and wary about following my work here.</p>
</div>
</div>
<p>Inputs or results for each of the four GAMMs will be appended with the corresponding panel letter. For example, objects that end with a “B” will be related to the GAMM used in panel B.</p>
<p>Four objects are created below that define the GAMM “formula.” In these formulae, <code>s()</code> is the smoother function provided by <code>mgcv</code> and <code>k=5</code> is the “modest maximum basis size” and <code>bs="cr"</code> is the cubic spline smoother used in <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span>. The <code>bs="re"</code> used for <code>SiteCode</code> causes it to be treated as a “random effect” as in <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span>. This code does not yet perform any analyses, it just creates a “formula” to be used next (and later).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">formB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> In.Situ<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(AirDaily,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(GageDaily,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(GageDiff,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(SiteCode,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>)</span>
<span id="cb6-5">formC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> In.Situ<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(AirDaily,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(GageDaily,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(GageDiff,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(SiteCode,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>)</span>
<span id="cb6-10">formD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> In.Situ<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(AirDaily,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(SiteCode,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>)</span>
<span id="cb6-12">formE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> In.Situ<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cr"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(SiteCode,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>)</span></code></pre></div>
</div>
<p>The actual GAMMs are fit with <code>gam()</code> from <code>mgcv</code>, taking a formula for the model as the first argument and the corresponding data frame in <code>data=</code>. The four lines below fit the four GAMMS of panels B-E using the formula objects created above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">mdlB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span>
<span id="cb7-2">mdlC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(formC,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span>
<span id="cb7-3">mdlD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(formD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span>
<span id="cb7-4">mdlE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(formE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span></code></pre></div>
</div>
<p>For example, a <code>summary()</code> of the model for panel B shows the same r<sup>2</sup> and smooth term p-values as described in the results of <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(mdlB)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  
#R|  Family: gaussian 
#R|  Link function: identity 
#R|  
#R|  Formula:
#R|  In.Situ ~ s(AirDaily, k = 5, bs = "cr") + s(GageDaily, k = 5, 
#R|      bs = "cr") + s(GageDiff, k = 5, bs = "cr") + s(SiteCode, 
#R|      bs = "re")
#R|  
#R|  Parametric coefficients:
#R|              Estimate Std. Error t value Pr(&gt;|t|)    
#R|  (Intercept)  12.5004     0.8018   15.59   &lt;2e-16 ***
#R|  ---
#R|  Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#R|  
#R|  Approximate significance of smooth terms:
#R|                 edf Ref.df      F  p-value    
#R|  s(AirDaily)  1.000      1 46.477  &lt; 2e-16 ***
#R|  s(GageDaily) 1.000      1 18.995  0.00011 ***
#R|  s(GageDiff)  1.000      1  5.128  0.02984 *  
#R|  s(SiteCode)  8.257      9  7.384 2.66e-06 ***
#R|  ---
#R|  Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#R|  
#R|  R-sq.(adj) =  0.716   Deviance explained = 78.6%
#R|  GCV = 3.1696  Scale est. = 2.343     n = 47</code></pre>
</div>
</div>
</section>
<section id="leave-one-out-predictions-and-mse" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="leave-one-out-predictions-and-mse">Leave-One-Out Predictions and MSE</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Acknowledgment
</div>
</div>
<div class="callout-body-container callout-body">
<p>The code in this section would not have been possible without help from the lead author of <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span>. I ultimately modified their code, but the general idea is still theirs. Of course, errors in the code presented here are my responsibility. I thank the authors for providing this code to me.</p>
</div>
</div>
<p><span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> used a leave-one-out cross-validation (LOOCV) procedure to generate the root mean square error (MSE) as well as “LOOCV” predictions for each model. The general idea here is to fit the GAMM with the first observation removed (i.e., “left out”), predict the <em>in situ</em> temperature for the first observation from this model, compute the residual between the observed <em>in situ</em> and predicted <em>in situ</em> temperature for this point, repeat this a number of times,<sup>2</sup> compute mean squared residual, and save the mean squared residuals and mean predicted <em>in situ</em> temperatures. Repeat this process for each of the other observations.<sup>3</sup> Then compute and return the square root of the mean of the mean squared residuals (this is the LOOCV MSE) and the vector of mean predicted <em>in situ</em> temperatures related to each observation (i.e., for each <code>DateTime</code> and <code>SiteCode</code> combination).</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;<span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> repeated this 100 times.</p></div><div id="fn3"><p><sup>3</sup>&nbsp;There were 47 observations in <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span>.</p></div><div id="fn4"><p><sup>4</sup>&nbsp;I modified this function from what the authors provided me by including comments, changing some intermediate variable names, removing some inner loops to speed things up, and returning the results in a different way.</p></div></div><p>This process is coded into the <code>loocv.re()</code> function shown in the folded code below.<sup>4</sup></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">loocv.re <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(form,dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>){</span>
<span id="cb10-2">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)</span>
<span id="cb10-3">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## prepare matrix to received LOOCV prediction values (rows are for ith point</span></span>
<span id="cb10-4">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   left-out, columns are for random iterations)</span></span>
<span id="cb10-5">  predsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>n,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>n.iters)</span>
<span id="cb10-6">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## perform LOOCV loop</span></span>
<span id="cb10-7">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb10-8">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## fit GAMM with ith row removed</span></span>
<span id="cb10-9">    mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(form,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i,])</span>
<span id="cb10-10">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get random effects SE</span></span>
<span id="cb10-11">    sitelevs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s(SiteCode)."</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(dat[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SiteCode"</span>])))</span>
<span id="cb10-12">    re.se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(mod)[sitelevs])</span>
<span id="cb10-13">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get individual SD</span></span>
<span id="cb10-14">    resid.se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sigma</span>(mod)</span>
<span id="cb10-15">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## predict In.Situ for ith left-out point, excluding SiteCode from GAMM fit</span></span>
<span id="cb10-16">    p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mod,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata=</span>dat[i,],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"terms"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exclude=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s(SiteCode)"</span>)</span>
<span id="cb10-17">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get fixed effects portion of prediction</span></span>
<span id="cb10-18">    predsFE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"constant"</span>)</span>
<span id="cb10-19">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add on random random effects portions</span></span>
<span id="cb10-20">    predsRE[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(predsFE,n.iters) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-21">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n.iters,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>re.se) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n.iters,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>resid.se)</span>
<span id="cb10-23">  }</span>
<span id="cb10-24">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Compute mean of predicted values for each observation using FE+RE</span></span>
<span id="cb10-25">  mean.predsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowMeans</span>(predsRE)</span>
<span id="cb10-26">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Find all residuals from predicted values using FE+RE</span></span>
<span id="cb10-27">  residsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>n,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>n.iters)</span>
<span id="cb10-28">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) residsRE[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In.Situ"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> predsRE[i,]</span>
<span id="cb10-29">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Find MSE from residuals from using predictions from FE+RE</span></span>
<span id="cb10-30">  MSERE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowMeans</span>(residsRE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb10-31">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Return all results</span></span>
<span id="cb10-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean.predsRE=</span>mean.predsRE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MSERE=</span>MSERE,</span>
<span id="cb10-33">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resids=</span>residsRE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>form)</span>
<span id="cb10-34">}</span></code></pre></div>
</details>
</div>
<p>The process laid out above is applied to the model in panel B below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">looB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.re</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat)</span></code></pre></div>
</div>
<p>From this result, the MSE can be extracted.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;This MSE may not exactly match that in the published Figure 3 because of the randomization used in making the model predictions. Also 100 iterations is on the low side, such that this value may vary somewhat from run to run (see “Further Thoughts” section.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">looB<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 2.455614</code></pre>
</div>
</div>
<p>The mean LOOCV predicted <em>in situ</em> temperatures for each observation (i.e., location-date combination) may also be examined.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">looB<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|   [1] 12.851791 14.149310 11.636388 14.001670 12.315976 12.552054 14.406877
#R|   [8] 12.111865 14.576413 11.324704 13.884762 13.122397  9.594543 14.072126
#R|  [15] 11.477815 13.830428 12.831921  9.334164 12.429613 14.532410 12.209832
#R|  [22] 12.424465 14.553735 11.631457 13.734138 12.551352  9.853848 12.629046
#R|  [29] 11.580924 14.031804 12.249635  9.467855 15.333607 11.544352 12.818436
#R|  [36] 12.603421  9.896241 14.343051 13.954222 12.598558  9.358737 12.140968
#R|  [43] 14.786858 11.550166 13.681013 12.143915  9.626715</code></pre>
</div>
</div>
<p>The LOOCV process was repeated for the other three models below.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">looC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.re</span>(formC,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat)</span>
<span id="cb16-2">looD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.re</span>(formD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat)</span>
<span id="cb16-3">looE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.re</span>(formE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat)</span></code></pre></div>
</details>
</div>
<p>The resultant MSE values were stored into a named vector for later use.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">MSE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE)</span>
<span id="cb17-2">MSE</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         B        C        D        E 
#R|  2.455614 2.478938 2.499286 2.545127</code></pre>
</div>
</div>
<p>And the resultant mean LOOCV predicted <em>in situ</em> temperatures were stored into a data frame, along with the corresponding <code>SiteCode</code> and <code>DateTime</code> information for later use.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">mean.predsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SiteCode=</span>dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>SiteCode,</span>
<span id="cb19-2">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">DateTime=</span>dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>DateTime,</span>
<span id="cb19-3">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predB=</span>looB<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb19-4">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predC=</span>looC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb19-5">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predD=</span>looD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb19-6">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predE=</span>looE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE)</span>
<span id="cb19-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(mean.predsRE)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     SiteCode   DateTime     predB     predC     predD     predE
#R|  1      CR-1 2015-05-30 12.851791 11.210556 12.144141 12.568541
#R|  2      CR-1 2015-06-15 14.149310 14.470042 14.437798 14.684522
#R|  3      CR-1 2015-07-01 11.636388 12.541739 11.940564 12.973309
#R|  45     SF-3 2015-08-11 13.681013 13.712191 13.659172 12.561452
#R|  46     SF-3 2015-08-18 12.143915 12.791890 13.015895 12.910432
#R|  47     SF-3 2015-09-12  9.626715  9.353639  9.350488  9.646322</code></pre>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="data-wrangling-ii" class="level1 page-columns page-full">
<h1>Data Wrangling II</h1>
<p>A new data frame is created below to facilitate efficiently reproducing Figure 3. This data frame will contain <code>SiteCode</code>, <code>DateTime</code>, <code>InSitu</code>, and <code>Landsat</code> from the original <code>dat</code>, but will also have the mean LOOCV predictions for each model joined from <code>mean.predsRE</code>.<sup>6</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;All variables from <code>dat</code> could have been included but they are not needed to produce Figure 3, so they were removed to decrease clutter when examining the data frame.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(AirDaily<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>GageDiff)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(mean.predsRE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SiteCode"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DateTime"</span>))</span>
<span id="cb21-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     SiteCode   DateTime In.Situ Landsat     predB     predC     predD     predE
#R|  1      CR-1 2015-05-30  11.625   20.74 12.851791 11.210556 12.144141 12.568541
#R|  2      CR-1 2015-06-15  14.721   24.46 14.149310 14.470042 14.437798 14.684522
#R|  3      CR-1 2015-07-01   9.682   14.03 11.636388 12.541739 11.940564 12.973309
#R|  45     SF-3 2015-08-11  12.727   14.26 13.681013 13.712191 13.659172 12.561452
#R|  46     SF-3 2015-08-18  12.001   14.06 12.143915 12.791890 13.015895 12.910432
#R|  47     SF-3 2015-09-12   8.792    7.52  9.626715  9.353639  9.350488  9.646322</code></pre>
</div>
</div>
<p>Each panel in Figure 3 shows the mean <em>in situ</em> temperature for each date as well as either the mean temperature predicted from Landsat imagery or one of the four models. These means are computed below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">sum2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(DateTime) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb23-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnIS=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(In.Situ),</span>
<span id="cb23-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnRL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Landsat),</span>
<span id="cb23-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnB=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predB),</span>
<span id="cb23-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnC=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predC),</span>
<span id="cb23-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnD=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predD),</span>
<span id="cb23-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnE=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predE))</span>
<span id="cb23-10">sum2</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 6 × 8
#R|    DateTime       n  mnIS  mnRL   mnB   mnC   mnD   mnE
#R|    &lt;date&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|  1 2015-05-30     6 12.2  20.0  12.5  12.3  12.7  12.7 
#R|  2 2015-06-15     8 15.2  23.7  14.5  14.6  14.5  14.4 
#R|  3 2015-07-01     8 12.6  12.6  11.6  12.0  12.0  11.6 
#R|  4 2015-08-11     9 13.1  13.9  13.8  13.7  13.2  12.5 
#R|  5 2015-08-18     9 12.1  14.6  12.5  12.4  12.9  13.1 
#R|  6 2015-09-12     7  9.15  8.63  9.59  9.43  9.26  9.83</code></pre>
</div>
</div>
<p>Each panel also shows the MSE between the <em>in situ</em> temperatures and the temperatures predicted from Landsat or one of the four GAMMs. The MSEs from the GAMMs were stored above. Below, the MSE from the Landsat predictions is calculated and prepended to the <code>MSE</code> vector created above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">MSE_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>In.Situ<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Landsat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat2))</span>
<span id="cb25-2">MSE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>MSE_A,MSE)</span>
<span id="cb25-3">MSE</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         A        B        C        D        E 
#R|  5.330851 2.455614 2.478938 2.499286 2.545127</code></pre>
</div>
</div>
<p>Those values are then turned into a vector of labels for the plots below. Note that <code>formatC()</code> is used here rather than <code>round()</code> as it will force the full number of digits to be shown (e.g., “2.50” rather than “2.5”). I also chose two decimals rather than the one used in <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> to better illustrate the differences (though minor) among the models.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">MSE_lbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE ="</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(MSE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb27-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MSE_lbls) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MSE)</span>
<span id="cb27-3">MSE_lbls</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|              A             B             C             D             E 
#R|  "RMSE = 5.33" "RMSE = 2.46" "RMSE = 2.48" "RMSE = 2.50" "RMSE = 2.55"</code></pre>
</div>
</div>
</section>
<section id="make-figure-3" class="level1 page-columns page-full">
<h1>Make Figure 3</h1>
<section id="panel-a" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="panel-a">Panel A</h2>
<p>Panels A-E have the same basic structure of layering together several geoms with both raw and summarized data. I demonstrate this layering for Panel A and, then, in the next section show how this is modified to produce Panel B.</p>
<p>Panel A shows <em>in situ</em> temperature observations and predictions from landsat images for six dates with multiple locations at each date. <em>In situ</em> observations and landsat predictions paired by location are connected within each date. To do this, <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> “jittered” the <em>in situ</em> and landsat results slightly at each date. Jittering usually means adding a random amount to each point, which is not what was done in Figure 3. Rather, the groups were “dodged” left for the <em>in situ</em> observations and right for the landsat predictions. This will be accomplished here by subtracting and adding a small amount to the date (i.e., x-axis) for <em>in situ</em> and landsat results, respectively. Below, I set that amount in an object called <code>ddg</code> so that it can be held constant for multiple geoms in each panel and also across panels.<sup>7</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;Choosing this value is largely a matter of trial-and-error until you find the look you like.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">ddg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span></span></code></pre></div>
</div>
<p>I began panel A by plotting lines at the means for both the <em>in situ</em> and landsat results. The <code>color=</code> is set to a constant string in each <code>geom_line()</code> because the <em>in situ</em> and landsat results are in separate columns in <code>sum2</code> rather than stacked with a second variable describing the source of the value. As seen below, these strings are shown in the legend.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb30-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb30-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Points that demonstrate the observed <em>in situ</em> temperatures and the landsat predicted temperatures are added with <code>geom_point()</code>. <code>ddg</code> is used here to “dodge” the two sets of points. <code>shape=21</code> is an open circle outlined in <code>color=</code> but filled with <code>fill=</code>. Again, because of the arrangement of the data in separate columns, <code>fill=</code> is set to a constant string that matches that used for the <code>geom_line()</code>s.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="6-9">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="6-9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb31-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb31-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb31-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb31-9">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p><span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> connected <em>in situ</em> and landsat temperatures paired by location within each date with light gray lines. This is accopmlished with <code>geom_segment()</code> below. <code>geom_segment()</code> was placed before the <code>geom_point()</code>s so that the gray segments would appear behind the points. It is worth noting here that adding these segments is the reason why the data were not stacked and the <em>in situ</em> and landsat results were kept in separate columns.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="6-8">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="6-8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb32-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb32-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb32-7">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>Landsat),</span>
<span id="cb32-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb32-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb32-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The MSE and panel labels are added below with <code>annotate()</code> using <code>geom="text"</code> as demonstrated in previous posts. Note here that <code>Inf</code> or <code>-Inf</code> cannot be used for the x-axis values because they are dates. Thus, the x-axis position must be chosen by choosing a date and making sure that it is treated as a date with <code>as.Date()</code>.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="13-16">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="13-16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb33-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb33-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb33-7">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>Landsat),</span>
<span id="cb33-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb33-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb33-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb33-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb33-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The x-and y-axes were modified as described in previous posts. Note, however, the use of markdown code in the y-axis title, which will require the use of <code>element_markdown()</code> from <code>ggtext</code> later when a theme is applied.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="17-19">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="17-19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb34-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb34-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb34-7">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>Landsat),</span>
<span id="cb34-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb34-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb34-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb34-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb34-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb34-18">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The colors of the points and lines need to be changed to match those in <span class="citation" data-cites="murphyetal_2021">Murphy et al. (2021)</span> and the issue of multiple legends also needs to be addressed. The colors of the lines are set with <code>scale_color_manual()</code> below and the fills of the points are set with <code>scale_fill_manual()</code> as shown in other posts. Note that <code>values=</code> is set to a <em>named</em> list where the names are the constant text values used in <code>color=</code> for <code>geom_line()</code> and <code>fill=</code> for <code>geom_point()</code> above. The use of <code>name=</code> here must be the same in both <code>scale_fill_manual()</code> and <code>scale_color_manual()</code> so that the two legends above will be merged into a common legend with this name as its title.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="20-23">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="20-23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb35-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb35-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb35-7">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>Landsat),</span>
<span id="cb35-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb35-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb35-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb35-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb35-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb35-18">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb35-21">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue1"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb35-23">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue4"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Finally, <code>theme_murphy()</code> create above was applied. This theme applies the built-in <code>theme_bw()</code>, removes all grid lines, moves the legend into the upper-right corner of the plot layer, removes the legend title, and makes the legend text slightly larger than the default. After this the y-axis title will use <code>element_markdown()</code> so that the markdown code will be rendered and the x-axis title is removed. Finally, this entire plot is saved into the <code>pA</code> object so that it can ultimately be stitched together with the other panels to form Figure 3.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="1,24-27">
<div class="sourceCode cell-code" id="cb36" data-code-line-numbers="1,24-27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">pA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb36-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnRL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb36-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb36-7">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>Landsat),</span>
<span id="cb36-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb36-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Landsat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span>),</span>
<span id="cb36-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb36-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb36-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb36-18">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb36-21">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue1"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb36-23">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb36-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb36-27">pA</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelA-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="panels-b-e" class="level2">
<h2 class="anchored" data-anchor-id="panels-b-e">Panels B-E</h2>
<p>Panel B is constructed very similarly to Panel A. The most important difference is that all references to results related to <code>Landsat</code> must be changed to results related to model B. Of course, the object name and colors for the model were also changed. Finally, this panel did not have titles for either axis.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="1,5-6,9,14-15,18,20,26,29,31,32">
<div class="sourceCode cell-code" id="cb37" data-code-line-numbers="1,5-6,9,14-15,18,20,26,29,31,32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">pB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb37-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,</span>
<span id="cb37-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnB,</span>
<span id="cb37-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff"</span>),</span>
<span id="cb37-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb37-9">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predB),</span>
<span id="cb37-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb37-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,</span>
<span id="cb37-14">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predB,</span>
<span id="cb37-15">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff"</span>),</span>
<span id="cb37-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb37-18">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb37-20">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb37-22">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb37-25">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,</span>
<span id="cb37-26">                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb37-28">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb37-29">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb37-32">pB</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-panelB-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Similar changes were made to produce objects for Panels C-E.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">pC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,</span>
<span id="cb38-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnC,</span>
<span id="cb38-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff + Landsat"</span>),</span>
<span id="cb38-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb38-9">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predC),</span>
<span id="cb38-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,</span>
<span id="cb38-14">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predC,</span>
<span id="cb38-15">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff + Landsat"</span>),</span>
<span id="cb38-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-18">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-20">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb38-22">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-25">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,</span>
<span id="cb38-26">                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff + Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-28">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb38-29">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily + GageDaily + GageDiff + Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb38-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb38-33"></span>
<span id="cb38-34">pD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-36">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,</span>
<span id="cb38-38">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnD,</span>
<span id="cb38-39">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily"</span>),</span>
<span id="cb38-40">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb38-42">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predD),</span>
<span id="cb38-43">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-45">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,</span>
<span id="cb38-47">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predD,</span>
<span id="cb38-48">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily"</span>),</span>
<span id="cb38-49">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-51">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-53">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb38-55">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-58">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,</span>
<span id="cb38-59">                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-61">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb38-62">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = AirDaily"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-63">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-64">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb38-65"></span>
<span id="cb38-66">pE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-68">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum2,</span>
<span id="cb38-70">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnE,</span>
<span id="cb38-71">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = Landsat"</span>),</span>
<span id="cb38-72">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb38-74">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predE),</span>
<span id="cb38-75">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-76">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb38-77">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,</span>
<span id="cb38-79">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predE,</span>
<span id="cb38-80">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = Landsat"</span>),</span>
<span id="cb38-81">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-08-05"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-83">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>MSE_lbls[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>]],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-84">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015-05-30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb38-85">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-86">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb38-87">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-89">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-90">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,</span>
<span id="cb38-91">                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"legend"</span>,</span>
<span id="cb38-93">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb38-94">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model = Landsat"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-95">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>()</span></code></pre></div>
</details>
</div>
</section>
<section id="putting-panels-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-panels-together">Putting Panels Together</h2>
<p>All five panels were then placed together using <code>patchwork()</code> to produce the final Figure 3.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">pA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pB <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pD <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/make-fig3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="further-thoughts" class="level1 page-columns page-full">
<h1>Further Thoughts</h1>
<p>As I noted above, I am no expert on GAMs or GAMMs. Here, though, I demonstrate a couple questions I had from this analysis. This is not intended as a critique of the authors or their paper, I assume that they knew what they were doing and that these questions come from my current lack of understanding about GAMMs.</p>
<section id="question-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1">Question 1</h3>
<p>I don’t understand the point of adding random error in the authors’ LOOCV algorithm when they then average across the iterations. In other words, it seems to me that if you add random error with a mean of 0 to “something” for many iterations and then average across those iterations that you are very likely going to get the original “something.”</p>
<p>To examine this, I modified the authors LOOCV routine to also keep track of the “fixed effects” portion of the predictions (i.e., the “something” prior to adding the random errors).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">loocv.fere <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(form,dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>){</span>
<span id="cb40-2">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)</span>
<span id="cb40-3">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## prepare matrix to received LOOCV prediction values (rows are for ith point</span></span>
<span id="cb40-4">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##   left-out, columns are for random iterations)</span></span>
<span id="cb40-5">  predsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>n,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>n.iters)</span>
<span id="cb40-6">  predsFE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb40-7">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## perform LOOCV loop</span></span>
<span id="cb40-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb40-9">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## fit GAMM with ith row removed</span></span>
<span id="cb40-10">    mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam</span>(form,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i,])</span>
<span id="cb40-11">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get random effects SE</span></span>
<span id="cb40-12">    sitelevs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s(SiteCode)."</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(dat[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SiteCode"</span>])))</span>
<span id="cb40-13">    re.se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(mod)[sitelevs])</span>
<span id="cb40-14">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get individual SD</span></span>
<span id="cb40-15">    resid.se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sigma</span>(mod)</span>
<span id="cb40-16">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## predict In.Situ for ith left-out point, excluding SiteCode from GAMM fit</span></span>
<span id="cb40-17">    p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mod,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata=</span>dat[i,],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"terms"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exclude=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s(SiteCode)"</span>)</span>
<span id="cb40-18">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## get fixed effects portion of prediction</span></span>
<span id="cb40-19">    predsFE[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(p,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"constant"</span>)</span>
<span id="cb40-20">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add on random random effects portions</span></span>
<span id="cb40-21">    predsRE[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(predsFE[i],n.iters) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb40-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n.iters,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>re.se) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n.iters,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>resid.se)</span>
<span id="cb40-24">  }</span>
<span id="cb40-25">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Compute MSE just from the predicted mean FE portion</span></span>
<span id="cb40-26">  MSEFE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((dat[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In.Situ"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>predsFE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb40-27">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Compute mean of predicted values for each observation using FE+RE</span></span>
<span id="cb40-28">  mean.predsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowMeans</span>(predsRE)</span>
<span id="cb40-29">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Find all residuals from predicted values using FE+RE</span></span>
<span id="cb40-30">  residsRE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>n,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>n.iters)</span>
<span id="cb40-31">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) residsRE[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In.Situ"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> predsRE[i,]</span>
<span id="cb40-32">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Find MSE from residuals from using predictions from FE+RE</span></span>
<span id="cb40-33">  MSERE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowMeans</span>(residsRE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb40-34">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Return all results</span></span>
<span id="cb40-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean.predsFE=</span>predsFE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MSEFE=</span>MSEFE,</span>
<span id="cb40-36">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean.predsRE=</span>mean.predsRE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MSERE=</span>MSERE,</span>
<span id="cb40-37">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resids=</span>residsRE,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>form)</span>
<span id="cb40-38">}</span></code></pre></div>
</details>
</div>
<p>I then performed the LOOCV analysis with this modified function using 10, 100 (as was done in the paper), 10000, and 1000000 iterations. For each set of iterations I compute the mean difference between mean predictions with and without adding the randomization and showed the MSE for predictions with and without adding the randomization, as well as the difference between the two. The results are shown in the table below.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.fere</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat)</span>
<span id="cb41-2">tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpFE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsFE,</span>
<span id="cb41-3">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpRE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-4">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpDIFF=</span>mpFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mpRE)</span>
<span id="cb41-5"></span>
<span id="cb41-6">MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,</span>
<span id="cb41-7">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE-MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE)</span>
<span id="cb41-8"></span>
<span id="cb41-9">looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.fere</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb41-10">tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpFE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsFE,</span>
<span id="cb41-11">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpRE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpDIFF=</span>mpFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mpRE)</span>
<span id="cb41-13">MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,</span>
<span id="cb41-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE-MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE)</span>
<span id="cb41-15"></span>
<span id="cb41-16">looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.fere</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb41-17">tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpFE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsFE,</span>
<span id="cb41-18">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpRE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpDIFF=</span>mpFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mpRE)</span>
<span id="cb41-20"></span>
<span id="cb41-21">MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,</span>
<span id="cb41-22">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE-MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE)</span>
<span id="cb41-23"></span>
<span id="cb41-24">looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loocv.fere</span>(formB,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>)</span>
<span id="cb41-25">tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpFE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsFE,</span>
<span id="cb41-26">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpRE=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpDIFF=</span>mpFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mpRE)</span>
<span id="cb41-28"></span>
<span id="cb41-29">MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE,</span>
<span id="cb41-30">                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE_FE-MSE_RE"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSEFE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MSERE)</span>
<span id="cb41-31"></span>
<span id="cb41-32">comp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.iters=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10,000"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1,000,000"</span>),</span>
<span id="cb41-33">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mndiff=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpDIFF),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpDIFF),</span>
<span id="cb41-34">                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpDIFF),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(tmp<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpDIFF))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>,MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span>,MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span>,MSE<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span>))</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">n.iters</th>
<th style="text-align: right;">mndiff</th>
<th style="text-align: right;">MSE_FE</th>
<th style="text-align: right;">MSE_RE</th>
<th style="text-align: right;">MSE_FE-MSE_RE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.0055</td>
<td style="text-align: right;">2.4572</td>
<td style="text-align: right;">2.8127</td>
<td style="text-align: right;">-0.3555</td>
</tr>
<tr class="even">
<td style="text-align: right;">100</td>
<td style="text-align: right;">-0.0156</td>
<td style="text-align: right;">2.4572</td>
<td style="text-align: right;">2.4998</td>
<td style="text-align: right;">-0.0426</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10,000</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">2.4572</td>
<td style="text-align: right;">2.4577</td>
<td style="text-align: right;">-0.0005</td>
</tr>
<tr class="even">
<td style="text-align: right;">1,000,000</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">2.4572</td>
<td style="text-align: right;">2.4577</td>
<td style="text-align: right;">-0.0005</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>From these results it appears that there is no practical difference between the mean LOOCV predictions based on just the fixed-effects portion or the mean after adding randomization. However, it does appear that there is a difference in the MSE calculations between the two methods, but that those differences are dependent on the number of iterations used. Thus, it appears that part of the MSE value is based on an algorithmic choice rather than characteristics of the data.</p>
</section>
<section id="question-2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="question-2">Question 2</h3>
<p>I don’t understand the point of having the red points on panels B-E and why they are connected with a gray line. It seems to me that the gray lines are connecting observations (gray points) to a mean (the red points), which is essentially a model residual. Furthermore, this seems further complicated given that the mean predictions (red points) depend on the chosen number of iterations (analysis above). To further illustrate this second point I recreated panel B from Figure 3 using the different numbers of iterations.<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Note that I “zoomed” the y-axis in a little bit to reduce white space to better see variation.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb42-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(AirDaily<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>GageDiff)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb42-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predB.10=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb42-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predB.100=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb42-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predB.10000=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE,</span>
<span id="cb42-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">predB.1000000=</span>looB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean.predsRE)</span>
<span id="cb42-7"></span>
<span id="cb42-8">sum3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb42-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(DateTime) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb42-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb42-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnIS=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(In.Situ),</span>
<span id="cb42-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnB.10=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>),</span>
<span id="cb42-13">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnB.100=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span>),</span>
<span id="cb42-14">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnB.10000=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span>),</span>
<span id="cb42-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnB.1000000=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span>))</span>
<span id="cb42-16"></span>
<span id="cb42-17">pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-19">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-21">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb42-23">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>),</span>
<span id="cb42-24">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-28">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"09/15/2015"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb42-30">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10 iterations"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb42-32">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb42-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb42-39">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb42-40"></span>
<span id="cb42-41">pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-43">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-45">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb42-47">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span>),</span>
<span id="cb42-48">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-50">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-52">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"09/15/2015"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb42-54">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100 iterations"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb42-56">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb42-62">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb42-63"></span>
<span id="cb42-64">pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-66">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-68">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb42-70">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span>),</span>
<span id="cb42-71">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-72">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-73">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-75">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-76">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"09/15/2015"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb42-77">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10,000 iterations"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb42-79">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-83">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-84">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb42-85">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb42-86"></span>
<span id="cb42-87">pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnIS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-89">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-90">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-91">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,</span>
<span id="cb42-93">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span>),</span>
<span id="cb42-94">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-95">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>In.Situ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span>),</span>
<span id="cb42-96">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-97">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>DateTime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ddg,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>predB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>),</span>
<span id="cb42-98">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-99">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"09/15/2015"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb42-100">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1,000,000 iterations"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (^o^C)"</span>,</span>
<span id="cb42-102">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-104">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indianred3"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-105">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In Situ"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-106">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_murphy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-107">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb42-108">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb42-109"></span>
<span id="cb42-110">pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pB<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1000000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/index_files/figure-html/fig3-compare-niter-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this it appears that the red points are simply “noise” around the red line that is primarily reflective of the number of iterations used in the LOOCV procedure.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>To be clear, neither of these questions does anything to change the authors’ conclusions as they are simply related to relatively minor details about how the results are presented (or how the same results could have been derived differently).</p>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-murphyetal_2021" class="csl-entry">
Murphy, R. D., Jr., J. A. Hagan, B. P. Harris, S. A. Sethi, T. S. Smeltz, and F. Restrepo. 2021. <a href="https://doi.org/10.3996/JFWM-20-048">Can landsat thermal imagery and environmental data accurately estimate water temperatures in small streams?</a> Journal of Fish and Wildlife Management 12(1):12–26.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Murphy Et Al. (2021) {Model} {Comparison} {Plots}},
  date = {2023-04-11},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-11_Murphyetal2021_Fig3},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 11. Murphy et al. (2021) Model Comparison Plots.
<a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-11_Murphyetal2021_Fig3">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-11_Murphyetal2021_Fig3</a>.
</div></div></section></div> ]]></description>
  <category>GAMM</category>
  <category>ggplot2</category>
  <category>annotations</category>
  <category>labels</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/</guid>
  <pubDate>Tue, 11 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-11_Murphyetal2021_Fig3/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>O’Malley et al. (2021) Regression Plots</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> compared morphometric measurements made directly on Cisco (<em>Coregonus artedi</em>) to those made from digitized images. Their <a href="https://meridian.allenpress.com/view-large/figure/13413231/i1944-687X-12-1-208-f02.tif">Figure 2</a> displayed the relationship between the two measurements for 12 morphometric measures. They tested whether the slope of the relationship between two measurements was equal to 1 for all 12 measures, but only showed the regression result on the plot if the slope was significantly different from 1. I use <code>ggplot2</code> here to recreate their figure.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>FSA</code>, <code>tibble</code>, <code>scales</code>, <code>ggtext</code>, and <code>smatr</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<section id="individual-measures" class="level2">
<h2 class="anchored" data-anchor-id="individual-measures">Individual Measures</h2>
<p><span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> provided the raw data for producing Figure 1 in their Archived Material A1, which I loaded below. I retained only the variables needed for this post and renamed them to be shorter.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CiscoMethodMSDataset_20200929.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>SpecimenID,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure=</span>MorphometricAbbreviation,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span>Method,</span>
<span id="cb2-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measurer=</span>MeasurerInitials,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span>Value)</span>
<span id="cb2-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                   id measure        method measurer     value
#R|  1    2018-50-886-20     BDD specimenBased      BPO  66.88000
#R|  2    2018-50-886-20     CPL specimenBased      BPO  26.59000
#R|  3    2018-50-886-20     DOH specimenBased      BPO  42.61000
#R|  3562  2018-38-208-6     PVL    imageBased      JDS  40.41272
#R|  3563  2018-38-208-6     STL    imageBased      JDS 275.50429
#R|  3564  2018-38-208-6     TTL    imageBased      JDS 328.48593</code></pre>
</div>
</div>
<p>The image-based measurements were made by two <code>measurer</code>s. Figure 2 uses only those measurements made by the same <code>measurer</code> as for the specimen-based measurements (i.e., “BPO”).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(measurer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BPO"</span>)</span>
<span id="cb4-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                   id measure        method measurer     value
#R|  1    2018-50-886-20     BDD specimenBased      BPO  66.88000
#R|  2    2018-50-886-20     CPL specimenBased      BPO  26.59000
#R|  3    2018-50-886-20     DOH specimenBased      BPO  42.61000
#R|  2374  2018-38-208-6     PVL    imageBased      BPO  38.73081
#R|  2375  2018-38-208-6     STL    imageBased      BPO 276.25851
#R|  2376  2018-38-208-6     TTL    imageBased      BPO 329.04718</code></pre>
</div>
</div>
<p>These data need to be made “wider” by placing the two <code>method</code>s of measurement into their own columns, rather than in different rows.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from=</span>method,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from=</span>value)</span>
<span id="cb6-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                   id measure measurer specimenBased imageBased
#R|  1    2018-50-886-20     BDD      BPO         66.88   69.05096
#R|  2    2018-50-886-20     CPL      BPO         26.59   28.61097
#R|  3    2018-50-886-20     DOH      BPO         42.61   44.97137
#R|  1186  2018-38-208-6     PVL      BPO         38.64   38.73081
#R|  1187  2018-38-208-6     STL      BPO        267.00  276.25851
#R|  1188  2018-38-208-6     TTL      BPO        325.00  329.04718</code></pre>
</div>
</div>
<p>These data are now ready for plotting <code>imageBased</code> versus <code>specimenBased</code> for each <code>measure</code>.</p>
</section>
<section id="regression-summaries" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="regression-summaries">Regression Summaries</h2>
<p>Figure 2, however, also shows summary results from the linear regression of <code>imageBased</code> on <code>specimenBased</code> for each <code>measure</code> for which the slope was significantly different from 1. Thus, these regressions must be conducted for each <code>measure</code> and the results stored in a data frame for use when plotting. There are a variety of ways to do this, but <code>sapply()</code> is used below.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<code>lmList()</code> from <code>nlme</code> is another option, though manipulation of results afterwards is still required to produce the needed data frame.</p></div></div><p>The original data frame is split on <code>measure</code> to form a list with a data frame for each measure. The result is too big to show here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">dat2.split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(dat2,dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>measure)</span></code></pre></div>
</div>
<p>A function is then defined that will take a data frame as its sole argument, fit the regression of <code>imageBased</code> on <code>specimenBased</code>, extract certain results about the regression and combine them into a vector, and then return that vector.<sup>2</sup> This function is created below and called <code>regfun()</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;To see how this works, run the <code>tmp</code> line below but with <code>data=dat2</code> instead and then use <code>str(tmp)</code> to see what is stored from this result and then extracted in the following lines.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">regfun <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(d) {</span>
<span id="cb9-2">  tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(imageBased<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>specimenBased,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>d))</span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"specimenBased"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span>],</span>
<span id="cb9-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slopeSE=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"specimenBased"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Std. Error"</span>],</span>
<span id="cb9-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Intercept)"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span>],</span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rsq=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared,</span>
<span id="cb9-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span>tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>df[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb9-8">}</span></code></pre></div>
</div>
<p>As an example, <code>regfun</code> is called below with only the data for the “BDD” morphometric measurement in <code>dat2.split</code>. Here you can see that <code>regfun()</code> returns the estimated intercept and slope, the standard error for the slope, the r-squared value, and the residual degrees-of-freedom for the regression.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">regfun</span>(dat2.split<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>BDD)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         slope      slopeSE    intercept          rsq           df 
#R|   1.031474479  0.008749461  0.010705827  0.993068986 97.000000000</code></pre>
</div>
</div>
<p><code>regfun()</code> can be applied to each item in <code>dat2.split</code> with <code>sapply()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(dat2.split,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN=</span>regfun)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                     BDD        CPL         DOH         HLL         MXL
#R|  slope      1.031474479  1.0757713  1.02856998  1.01445030  0.96781162
#R|  slopeSE    0.008749461  0.0352823  0.02442481  0.02186351  0.04933639
#R|  intercept  0.010705827  0.1554068 -0.44887045  0.44980926  1.16453067
#R|  rsq        0.993068986  0.9055193  0.94813927  0.95688676  0.79867605
#R|  df        97.000000000 97.0000000 97.00000000 97.00000000 97.00000000
#R|                    OOL         PAD         PCL         POL         PVL
#R|  slope      0.81350663  0.98313163  1.11895119  0.86621728  0.90627210
#R|  slopeSE    0.05721728  0.02070146  0.02995096  0.05628229  0.04636973
#R|  intercept  1.82831841  0.18526295 -5.15899945  1.78522043  2.71996110
#R|  rsq        0.67574491  0.95876533  0.93501829  0.70946778  0.79748909
#R|  df        97.00000000 97.00000000 97.00000000 97.00000000 97.00000000
#R|                     STL         TTL
#R|  slope      1.033775553  1.02287457
#R|  slopeSE    0.008315711  0.01384976
#R|  intercept  0.017022154 -7.17195762
#R|  rsq        0.993762642  0.98252745
#R|  df        97.000000000 97.00000000</code></pre>
</div>
</div>
<p>However, the result needs to be transposed with <code>t()</code> so that the summary statistics form the columns and the <code>measure</code>s form the rows. The transposed matrix is converted to a data frame for further manipulation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">rsum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(dat2.split,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN=</span>regfun) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span>
<span id="cb14-4">rsum</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|          slope     slopeSE   intercept       rsq df
#R|  BDD 1.0314745 0.008749461  0.01070583 0.9930690 97
#R|  CPL 1.0757713 0.035282303  0.15540677 0.9055193 97
#R|  DOH 1.0285700 0.024424812 -0.44887045 0.9481393 97
#R|  HLL 1.0144503 0.021863514  0.44980926 0.9568868 97
#R|  MXL 0.9678116 0.049336389  1.16453067 0.7986760 97
#R|  OOL 0.8135066 0.057217285  1.82831841 0.6757449 97
#R|  PAD 0.9831316 0.020701457  0.18526295 0.9587653 97
#R|  PCL 1.1189512 0.029950963 -5.15899945 0.9350183 97
#R|  POL 0.8662173 0.056282293  1.78522043 0.7094678 97
#R|  PVL 0.9062721 0.046369732  2.71996110 0.7974891 97
#R|  STL 1.0337756 0.008315711  0.01702215 0.9937626 97
#R|  TTL 1.0228746 0.013849764 -7.17195762 0.9825274 97</code></pre>
</div>
</div>
<p>This data frame is modified by converting the rownames to a variable name (i.e., <code>measure</code>) with <code>rownames_to_column()</code> from <code>tibble</code>. In addition, a t test statistic for the comparison of the estimated slope to 1 is computed and a two-tailed p-value is computed from that test statistic using <code>pt()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">rsum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rsum <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-2">  tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"measure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>(slope<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>slopeSE,</span>
<span id="cb16-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(t),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span>df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb16-5">rsum</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     measure     slope     slopeSE   intercept       rsq df          t
#R|  1      BDD 1.0314745 0.008749461  0.01070583 0.9930690 97  3.5973049
#R|  2      CPL 1.0757713 0.035282303  0.15540677 0.9055193 97  2.1475736
#R|  3      DOH 1.0285700 0.024424812 -0.44887045 0.9481393 97  1.1697113
#R|  4      HLL 1.0144503 0.021863514  0.44980926 0.9568868 97  0.6609323
#R|  5      MXL 0.9678116 0.049336389  1.16453067 0.7986760 97 -0.6524268
#R|  6      OOL 0.8135066 0.057217285  1.82831841 0.6757449 97 -3.2593886
#R|  7      PAD 0.9831316 0.020701457  0.18526295 0.9587653 97 -0.8148399
#R|  8      PCL 1.1189512 0.029950963 -5.15899945 0.9350183 97  3.9715313
#R|  9      POL 0.8662173 0.056282293  1.78522043 0.7094678 97 -2.3769948
#R|  10     PVL 0.9062721 0.046369732  2.71996110 0.7974891 97 -2.0213164
#R|  11     STL 1.0337756 0.008315711  0.01702215 0.9937626 97  4.0616555
#R|  12     TTL 1.0228746 0.013849764 -7.17195762 0.9825274 97  1.6516215
#R|                p
#R|  1  5.081712e-04
#R|  2  3.423944e-02
#R|  3  2.449833e-01
#R|  4  5.102225e-01
#R|  5  5.156691e-01
#R|  6  1.540325e-03
#R|  7  4.171601e-01
#R|  8  1.371816e-04
#R|  9  1.941692e-02
#R|  10 4.600229e-02
#R|  11 9.887411e-05
#R|  12 1.018456e-01</code></pre>
</div>
</div>
<p>The authors determined the significance of the regression with a Bonferroni correction, which they implemented by comparing the calculated p-value to 0.05/12, where 0.05 is the overall rejection criterion value and 12 is the number of p-values calculated. An alternative to this is to multiply the calculated p-values by 12 and then compare those adjusted p-values to 0.05 to determine significance. Either method produces the same result, but the second method, when implemented with <code>p.adjust()</code> provides flexibility to try methods other than Bonferroni (see Further Comments below).<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Bonferroni-corrected p-values greater than 1 are displayed as 1.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">rsum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rsum <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p.bonf=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p.adjust</span>(p,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bonferroni"</span>))</span>
<span id="cb18-3">rsum</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     measure     slope     slopeSE   intercept       rsq df          t
#R|  1      BDD 1.0314745 0.008749461  0.01070583 0.9930690 97  3.5973049
#R|  2      CPL 1.0757713 0.035282303  0.15540677 0.9055193 97  2.1475736
#R|  3      DOH 1.0285700 0.024424812 -0.44887045 0.9481393 97  1.1697113
#R|  4      HLL 1.0144503 0.021863514  0.44980926 0.9568868 97  0.6609323
#R|  5      MXL 0.9678116 0.049336389  1.16453067 0.7986760 97 -0.6524268
#R|  6      OOL 0.8135066 0.057217285  1.82831841 0.6757449 97 -3.2593886
#R|  7      PAD 0.9831316 0.020701457  0.18526295 0.9587653 97 -0.8148399
#R|  8      PCL 1.1189512 0.029950963 -5.15899945 0.9350183 97  3.9715313
#R|  9      POL 0.8662173 0.056282293  1.78522043 0.7094678 97 -2.3769948
#R|  10     PVL 0.9062721 0.046369732  2.71996110 0.7974891 97 -2.0213164
#R|  11     STL 1.0337756 0.008315711  0.01702215 0.9937626 97  4.0616555
#R|  12     TTL 1.0228746 0.013849764 -7.17195762 0.9825274 97  1.6516215
#R|                p      p.bonf
#R|  1  5.081712e-04 0.006098055
#R|  2  3.423944e-02 0.410873238
#R|  3  2.449833e-01 1.000000000
#R|  4  5.102225e-01 1.000000000
#R|  5  5.156691e-01 1.000000000
#R|  6  1.540325e-03 0.018483900
#R|  7  4.171601e-01 1.000000000
#R|  8  1.371816e-04 0.001646179
#R|  9  1.941692e-02 0.233002989
#R|  10 4.600229e-02 0.552027438
#R|  11 9.887411e-05 0.001186489
#R|  12 1.018456e-01 1.000000000</code></pre>
</div>
</div>
<p>The authors used <code>slope.test()</code> from <code>smatr</code> to compute the p-value for the comparison of the estimated slope to 1. The code below uses <code>sapply()</code> to compute these p-values for each group. A comparison of the <code>p</code> column below to the one above shows that the results above are the same as those from <code>smatr</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">sth <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(d) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(d,smatr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slope.test</span>(imageBased,specimenBased,</span>
<span id="cb20-2">                                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test.value=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLS"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p</span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(dat2.split,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN=</span>sth) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                 p
#R|  BDD 5.081712e-04
#R|  CPL 3.423944e-02
#R|  DOH 2.449833e-01
#R|  HLL 5.102225e-01
#R|  MXL 5.156691e-01
#R|  OOL 1.540325e-03
#R|  PAD 4.171601e-01
#R|  PCL 1.371816e-04
#R|  POL 1.941692e-02
#R|  PVL 4.600229e-02
#R|  STL 9.887411e-05
#R|  TTL 1.018456e-01</code></pre>
</div>
</div>
<p>Figure 2 in <span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> showed the regression line, its slope, and the corresponding r<sup>2</sup> value only for those measures for which the slope was significantly different from 1. To facilitate this, three new variables are created that contain the slope, the intercept, and the regression label <strong>only</strong> for those measures with slopes that differed significantly from 1.<sup>4</sup> Use of HTML and markdown code in the label was described in <a href="../2023-3-29_Milleretal2022_Fig1/#reservoir-and-regression-result-labels">this post</a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;I also remove three variables that are not needed further.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">rsum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rsum <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(p.bonf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,intercept,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb22-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(p.bonf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,slope,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb22-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(p.bonf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope = "</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(slope,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb22-5">                                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;R^2^ = "</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(rsq,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb22-6">                    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>slopeSE,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>df,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t)</span>
<span id="cb22-8">rsum</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     measure     slope   intercept       rsq            p      p.bonf           b
#R|  1      BDD 1.0314745  0.01070583 0.9930690 5.081712e-04 0.006098055  0.01070583
#R|  2      CPL 1.0757713  0.15540677 0.9055193 3.423944e-02 0.410873238          NA
#R|  3      DOH 1.0285700 -0.44887045 0.9481393 2.449833e-01 1.000000000          NA
#R|  4      HLL 1.0144503  0.44980926 0.9568868 5.102225e-01 1.000000000          NA
#R|  5      MXL 0.9678116  1.16453067 0.7986760 5.156691e-01 1.000000000          NA
#R|  6      OOL 0.8135066  1.82831841 0.6757449 1.540325e-03 0.018483900  1.82831841
#R|  7      PAD 0.9831316  0.18526295 0.9587653 4.171601e-01 1.000000000          NA
#R|  8      PCL 1.1189512 -5.15899945 0.9350183 1.371816e-04 0.001646179 -5.15899945
#R|  9      POL 0.8662173  1.78522043 0.7094678 1.941692e-02 0.233002989          NA
#R|  10     PVL 0.9062721  2.71996110 0.7974891 4.600229e-02 0.552027438          NA
#R|  11     STL 1.0337756  0.01702215 0.9937626 9.887411e-05 0.001186489  0.01702215
#R|  12     TTL 1.0228746 -7.17195762 0.9825274 1.018456e-01 1.000000000          NA
#R|             m                          lbl
#R|  1  1.0314745 slope = 1.031&lt;br&gt;R^2^ = 0.99
#R|  2         NA                         &lt;NA&gt;
#R|  3         NA                         &lt;NA&gt;
#R|  4         NA                         &lt;NA&gt;
#R|  5         NA                         &lt;NA&gt;
#R|  6  0.8135066 slope = 0.814&lt;br&gt;R^2^ = 0.68
#R|  7         NA                         &lt;NA&gt;
#R|  8  1.1189512 slope = 1.119&lt;br&gt;R^2^ = 0.94
#R|  9         NA                         &lt;NA&gt;
#R|  10        NA                         &lt;NA&gt;
#R|  11 1.0337756 slope = 1.034&lt;br&gt;R^2^ = 0.99
#R|  12        NA                         &lt;NA&gt;</code></pre>
</div>
</div>
<p>Below, <code>b</code> and <code>m</code> will be used to show regressions lines on each facet, but for <code>measure</code>s where these are <code>NA</code> no line will be shown. This same idea will be true for adding the results labels; i.e., <code>measure</code>s where <code>lbl</code> is NA will not show a label. Thus, the regression line and results will only be shown in facets for measures with slopes significantly different from 1.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-1" class="level1">
<h1>Recreating Figure 1</h1>
<p>Once the data are arranged as above, making Figure 1 is a fairly straight-forward application of techniques used in previous posts. I highlight the steps below.</p>
<ul>
<li>Use <code>geom_abline()</code> to make the 1:1 line (i.e., slope of 1, intercept of 0). This is first so that it sits behind the data and potential regression lines.</li>
<li>Use <code>geom_point()</code> with <code>dat2</code> to add points for each observed <code>specimenBased</code> and <code>imageBased</code> pair. <code>shape=1</code> uses an “open circle” for the point. <code>deepskyblue4</code> was my best guess at the <code>color=</code> that <span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> used.</li>
<li>Use <code>geom_abline()</code> with <code>rsum</code> and <code>b</code> mapped to <code>intercept=</code> and <code>m</code> mapped to <code>slope</code>. Do not use <code>intercept</code> and <code>slope</code> here as that will show the regression line on each facet.</li>
<li>Use <code>geom_richtext()</code> from <code>ggtext</code> using <code>rsum</code> with <code>lbl</code> mapped to <code>label=</code> to place the regression result labels in the upper-right corner. <code>geom_richtext()</code> is used here rather than <code>geom_text()</code> because the <code>lbl</code> had HTML and markdown code in them.</li>
<li>Label the x- and y-axes and expand their limits a little more.</li>
<li>Create three rows of facets based on <code>measure</code> with <code>facet_wrap()</code>. <code>scales="free"</code> is used so that each facet has its own x- and y-axis tick mark labels.</li>
<li>Apply the <code>theme_bw()</code> theme and remove the default grid lines.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>specimenBased,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>imageBased),</span>
<span id="cb24-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepskyblue4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span>b,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span>m),</span>
<span id="cb24-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-7">  ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),</span>
<span id="cb24-8">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb24-9">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Specimen-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Image-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(measure),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/index_files/figure-html/make-fig2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="further-thoughts" class="level1 page-columns page-full">
<h1>Further Thoughts</h1>
<section id="same-axes-in-each-facet" class="level2">
<h2 class="anchored" data-anchor-id="same-axes-in-each-facet">Same Axes in Each Facet</h2>
<p>The last part of Figure 2 in <span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> that I could not recreate simply was to ensure that the x- and y-axes were the same (same limits and breaks) in each facet. An especially egregious example of my failure here is for the “OOL” facet.</p>
<p><a href="https://stackoverflow.com/a/32533219/1123933">This StackOverflow answer</a> provided a method for making the x- and y-axes the same within each facet, but also the same across the facets. A simple modification of that answer results in the x- and y-axes being the same within each facet, but different across facets.</p>
<p>There are two “tricks” in this process. The first is to create a data fame that finds the minimum and maximum value of <code>imageBased</code> and <code>specimenBased</code> combined for each <code>measure</code>, then place those values in a single variable that is matched against the <code>measure</code> name, and then repeat that column in a second variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">fctlims <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(measure) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(imageBased,specimenBased),</span>
<span id="cb25-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(imageBased,specimenBased)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span>min<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>max,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name)</span>
<span id="cb25-8">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(fctlims)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     measure        x        y
#R|  1      BDD  33.1800  33.1800
#R|  2      BDD 104.7049 104.7049
#R|  3      CPL  15.6600  15.6600
#R|  22     STL 395.8014 395.8014
#R|  23     TTL 173.8007 173.8007
#R|  24     TTL 463.2827 463.2827</code></pre>
</div>
</div>
<p>These “data” are then added to the plot from above using <code>geom_blank()</code> where <code>x=</code> and <code>y=</code> are mapped to the two columns of “min” and “max” values. This then sets the range of data to be presented on the x- and y-axes, and because the two columns are the same then the axes will appear the same. <code>geom_blank()</code> does not plot any actual data so this effectively just sets the x- and y-axis limits and breaks.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="2">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_blank</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>fctlims,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>specimenBased,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>imageBased),</span>
<span id="cb27-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepskyblue4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span>b,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span>m),</span>
<span id="cb27-7">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),</span>
<span id="cb27-9">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb27-10">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Specimen-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Image-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(measure),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/index_files/figure-html/make-fig2-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>This is pretty nice, but I still could not get the exact breaks in <span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span>. I started to try <code>facetted_pos_scales()</code> from <code>ggh4x</code> but lost my patience with it.</p>
</section>
<section id="alternative-multiple-comparison-procedures" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="alternative-multiple-comparison-procedures">Alternative Multiple Comparison Procedures</h2>
<p>The Bonferroni-correction for multiple comparisons is a “brute-force” method that becomes “too conservative” (i.e., overall error rate less than 0.05), especially as the number of comparisons increases. This, ultimately results in a loss of statistical power (i.e., potentially detecting fewer truly significant results). The Bonferroni method is often employed because it is simple to implement as shown above – you either divide or multiply by the number of tests. However, <code>p.adjust()</code> provides the ability to use a wider variety of other methods that are less conservative than the Bonferroni.<sup>5</sup> Below, the Holm method is demonstrated.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;See <code>?p.adjust</code> for more explanation of these methods.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">p.adjust.methods</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "holm"       "hochberg"   "hommel"     "bonferroni" "BH"        
#R|  [6] "BY"         "fdr"        "none"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">rsum <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p.holm=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p.adjust</span>(p,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"holm"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(measure,p,p.bonf,p.holm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     measure            p      p.bonf      p.holm
#R|  1      BDD 5.081712e-04 0.006098055 0.005081712
#R|  2      CPL 3.423944e-02 0.410873238 0.239676055
#R|  3      DOH 2.449833e-01 1.000000000 0.979933278
#R|  4      HLL 5.102225e-01 1.000000000 1.000000000
#R|  5      MXL 5.156691e-01 1.000000000 1.000000000
#R|  6      OOL 1.540325e-03 0.018483900 0.013862925
#R|  7      PAD 4.171601e-01 1.000000000 1.000000000
#R|  8      PCL 1.371816e-04 0.001646179 0.001508997
#R|  9      POL 1.941692e-02 0.233002989 0.155335326
#R|  10     PVL 4.600229e-02 0.552027438 0.276013719
#R|  11     STL 9.887411e-05 0.001186489 0.001186489
#R|  12     TTL 1.018456e-01 1.000000000 0.509227920</code></pre>
</div>
</div>
<p>In this situation the Bonferroni and Holm methods did not provide different conclusions, so I did not recreate the <code>b</code>, <code>m</code>, and <code>lbl</code> variables. However, alternative correction methods may provide different conclusions in other situations.</p>
</section>
<section id="descriptive-facet-labels" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-facet-labels">Descriptive Facet Labels</h2>
<p>I believe that <span class="citation" data-cites="omalleyetal_2021">O’Malley et al. (2021)</span> used the measure abbreviations in their Figure 2 to tie the results to their Figure 1, which showed the measures on a schematic fish. However, there may be situations where more descriptive facet labels may be useful. For example, below a named vector is created where the name (before the <code>=</code>) is the measure abbreviation used in <code>measure</code> and the “value” (after the <code>=</code>) is a more descriptive name for the measure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">longnames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BDD"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Body Depth"</span>,</span>
<span id="cb32-2">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Caudal Peduncle Length"</span>,</span>
<span id="cb32-3">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DOH"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dorsal Fin Height"</span>,</span>
<span id="cb32-4">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HLL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Head Length"</span>,</span>
<span id="cb32-5">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MXL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maxillary Length"</span>,</span>
<span id="cb32-6">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OOL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Orbital Length"</span>,</span>
<span id="cb32-7">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PAD"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pelvic-Anal Fin Length"</span>,</span>
<span id="cb32-8">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PCL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pectoral Fin Length"</span>,</span>
<span id="cb32-9">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preorbital Length"</span>,</span>
<span id="cb32-10">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PVL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pelvic Fin Length"</span>,</span>
<span id="cb32-11">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"STL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Standard Length"</span>,</span>
<span id="cb32-12">               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TTL"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length"</span>)</span></code></pre></div>
</div>
<p>The abbreviations in the facet strip can be replaced with the longer names by setting <code>labeller=</code> in <code>facet_wrap()</code> to <code>labeller()</code> which has the variable name that creates the facets (i.e., <code>measure</code> here) set equal to the named vector just created.</p>
<div class="cell" data-layout-align="center" data-source-line-numbers="12-13">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="12-13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>specimenBased,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>imageBased),</span>
<span id="cb33-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepskyblue4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept=</span>b,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope=</span>m),</span>
<span id="cb33-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-7">  ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>rsum,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),</span>
<span id="cb33-8">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb33-9">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Specimen-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Image-based (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(measure),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>,</span>
<span id="cb33-13">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labeller</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure=</span>longnames)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/index_files/figure-html/make-fig2-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-omalleyetal_2021" class="csl-entry">
O’Malley, B. P., J. D. Schmitt, J. P. Holden, and B. C. Weidel. 2021. <a href="https://doi.org/10.3996/JFWM-20-029">Comparison of specimen- and image-based morphometrics for <span>Cisco</span></a>. Journal of Fish and Wildlife Management 12(1):208–215.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {O’Malley Et Al. (2021) {Regression} {Plots}},
  date = {2023-04-06},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-6_OMalleyetal2021_Fig2},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 6. O’Malley et al. (2021) Regression Plots. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-6_OMalleyetal2021_Fig2">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-6_OMalleyetal2021_Fig2</a>.
</div></div></section></div> ]]></description>
  <category>Linear Regression</category>
  <category>Data Wrangling</category>
  <category>ggplot2</category>
  <category>facets</category>
  <category>annotations</category>
  <category>labels</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/</guid>
  <pubDate>Thu, 06 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-6_OMalleyetal2021_Fig2/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Vasquez et al. (2022) Kuskal-Wallis Results</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span> examined the nesting materials of Black-Crested Titmice (<em>Baeolophus atricristatus</em>) near San Marcos, Texas. In one part of their analysis they used a Kruskal-Wallis test to identify differences in total nest weight for nests from four different area types (based on a rural to urban gradient). They summarized their results in Panel A of their <a href="https://meridian.allenpress.com/view-large/figure/14538150/i1944-687X-13-1-236-f02.tif">Figure 2</a>. Here I recreate their statistics, but summarize the results differently.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>FSA</code>, <code>car</code>, <code>DescTools</code>, and <code>scales</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1">
<h1>Data Wrangling</h1>
<p><span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span> provided the raw data in their Data Supplement S1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JFWM-21-058.S1.csv"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|   [1] "Number"            "Location2"         "Location"         
#R|   [4] "Nest.Weight.and.P" "Plastic.Weight"    "Nest.Weight"      
#R|   [7] "Plastic"           "Cotton"            "Moss"             
#R|  [10] "Twigs"             "Leaves"            "Snake.Skin"       
#R|  [13] "Natural"           "Anthro"            "eggs.laid"        
#R|  [16] "eggs.hatch"        "Date"              "Julian"           
#R|  [19] "Beetle"            "First.Attempt"     "Second.Attempt"   
#R|  [22] "X2nd.Clutch"       "Photo"             "p.plastic"        
#R|  [25] "p.cotton"          "p.moss"            "p.twigs"          
#R|  [28] "p.leaves"          "p.snake"           "p.art"            
#R|  [31] "p.nat"             "total.prop"</code></pre>
</div>
</div>
<p>There is both a <code>Location</code> and a <code>Location2</code> variable in this data frame, but neither contains text that exactly match the “area types” shown in <span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Location<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Location2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|              Location2
#R|  Location     Rural Semi Rural Semi Urban Urban
#R|    ACampus        0          0          0     7
#R|    BResidence     0          1         11     0
#R|    CPark          0          5          0     0
#R|    DFreeman      21          0          0     0</code></pre>
</div>
</div>
<p>However, sample sizes for the <code>Location</code> variable groups match those in the paper. Therefore, I created <code>Location3</code> by mapping the names in <code>Location</code> to the names used in the paper. I also turned <code>Location3</code> into a factor to order the levels along the rural to urban gradient as <span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span> did. Finally, for this post, I only focus on the total weight of the nest, so I only retained <code>Nest.Weight</code> and <code>Location3</code> for further analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Location3=</span>plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapvalues</span>(Location,</span>
<span id="cb6-3">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACampus"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BResidence"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPark"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DFreeman"</span>),</span>
<span id="cb6-4">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Urban"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residential"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parks"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rural"</span>)),</span>
<span id="cb6-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Location3=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rural"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parks"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residential"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Urban"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Location3,Nest.Weight)</span>
<span id="cb6-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Location3 Nest.Weight
#R|  1        Urban        27.5
#R|  2        Urban        31.8
#R|  3        Urban        35.4
#R|  43 Residential        65.8
#R|  44 Residential        44.7
#R|  45 Residential        43.7</code></pre>
</div>
</div>
</section>
<section id="kruskal-wallis-test" class="level1 page-columns page-full">
<h1>Kruskal-Wallis Test</h1>
<section id="assumption-checking" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="assumption-checking">Assumption Checking</h2>
<p><span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span> chose to use a Kruskal-Wallis test<sup>1</sup> to determine if nest weights differed among area types because of concerns over normality and equal variances. They tested normality with a Shapiro-Wilk test, but this is difficult to do given the small sample sizes, especially in the “Parks” and “Urban” areas. Instead of the test I examined a density plot of total nest weight for each area type.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;I assume the reader is familiar with a Kruskal-Wallis Test. If not, <a href="https://www.statology.org/kruskal-wallis-test/">this</a> is one resource that may be useful.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Nest.Weight)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rug</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nest Weight (g)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Location3)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/index_files/figure-html/examine-normality-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, Q-Q plots<sup>2</sup> may be used to examine normality.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;I assume the reader is familiar with a Q_Q plot. If not, <a href="https://www.statology.org/q-q-plot-normality/">this</a> is one resource that may be useful.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample=</span>Nest.Weight)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_qq</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_qq_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nest Weight (g)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Location3)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/index_files/figure-html/examine-normality-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>With either plot, the data do not appear to follow a normal distribution but, given the sample size, they do not look terribly non-normal either.</p>
<p><span class="citation" data-cites="vasquezetal_2022">Vasquez et al. (2022)</span> examined homogeneity of variances with the Bartlett test. I prefer to use Levene’s test for this purpose as it does not assume a normal distribution. Both <code>bartlett.test()</code> and <code>leveneTest()</code> (from <code>car</code>) require a formula of the form <code>response~explanatory</code><sup>3</sup> as the first argument and the corresponding data frame in <code>data=</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Or <code>dependent~independent</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bartlett.test</span>(Nest.Weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  
#R|     Bartlett test of homogeneity of variances
#R|  
#R|  data:  Nest.Weight by Location3
#R|  Bartlett's K-squared = 10.009, df = 3, p-value = 0.01849</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">car<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leveneTest</span>(Nest.Weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  Levene's Test for Homogeneity of Variance (center = median)
#R|        Df F value Pr(&gt;F)
#R|  group  3  2.2121 0.1012
#R|        41</code></pre>
</div>
</div>
<p>Unfortunately, the two results give different answers, with Bartlett’s test suggesting unequal variances and Levene’s test suggesting the opposite.</p>
<p>Given these results it may have been appropriate to analyze these data with a one-way ANOVA. I suspect, however, that other variables in the data set more egregiously violated these assumptions and the authors wanted to use consistent methods for all variables. And, of course, using the Kruskal-Wallis test here <em>a priori</em> would not be incorrect, though there is some loss of power.</p>
</section>
<section id="kruskal-wallis-test-1" class="level2">
<h2 class="anchored" data-anchor-id="kruskal-wallis-test-1">Kruskal-Wallis Test</h2>
<p>The Kruskal-Wallis test may be performed with <code>kruskal.test()</code> using the same arguments as <code>bartlett.test()</code> or <code>leveneTest()</code> above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kruskal.test</span>(Nest.Weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  
#R|     Kruskal-Wallis rank sum test
#R|  
#R|  data:  Nest.Weight by Location3
#R|  Kruskal-Wallis chi-squared = 11.571, df = 3, p-value = 0.009006</code></pre>
</div>
</div>
<p>This result provides strong evidence that the <strong>median</strong> total nest weight is different for at least one of the area types.</p>
</section>
<section id="post-hoc-multiple-comparisons" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="post-hoc-multiple-comparisons">Post-hoc Multiple Comparisons</h2>
<p>Dunn’s test<sup>4</sup> may be used, after a significant Kruskal-Wallis test, to determine which pairs of <strong>medians</strong> differ after adjusting for multiple comparisons. Dunn’s test is performed with <code>dunnTest()</code> from <code>FSA</code> using the same arguments as given to <code>kruskal.test()</code> above. As noted in the results below, <code>dunnTest()</code> defaults to using the “Holm” method to adjust for multiple comparisons. Other methods may be used with <code>method=</code>.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;I assume that the reader is familiar with Dunn’s Test. If not <a href="https://www.statology.org/dunns-test/">this</a> is one resources that may be helpful.</p></div><div id="fn5"><p><sup>5</sup>&nbsp;See the possible methods with <code>?dunn.test::dunn.test</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dunnTest</span>(Nest.Weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|             Comparison        Z     P.unadj      P.adj
#R|  1 Parks - Residential 0.233670 0.815241172 0.81524117
#R|  2       Parks - Rural 1.007831 0.313535451 0.62707090
#R|  3 Residential - Rural 1.042160 0.297337581 0.89201274
#R|  4       Parks - Urban 2.751550 0.005931397 0.02965699
#R|  5 Residential - Urban 3.126111 0.001771347 0.01062808
#R|  6       Rural - Urban 2.542487 0.011006664 0.04402666</code></pre>
</div>
</div>
<p>From these results it is apparent that the <strong>median</strong> nest weight in the “Urban” areas differs from the other three area types, which all have statistically equal medians.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="displaying-results" class="level1 page-columns page-full">
<h1>Displaying Results</h1>
<section id="create-summary-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="create-summary-data-frame">Create Summary Data Frame</h2>
<p>The Kruskal-Wallis test is a test of the equality of <strong>medians</strong> across groups. Thus, in my opinion, a summary graphic for this test should plot the medians with their respective confidence intervals. Computing the confidence intervals for medians across groups takes a bit of work in R. This process is described below.</p>
<p>The original data frame is converted to a list with separate vectors of nest weights for each area type.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Nest.Weight,dat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Location3)</span>
<span id="cb18-2">tmp</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  $Rural
#R|   [1] 45.7 52.6 32.2 61.5 93.9 22.2 54.2 40.9 63.1 47.1 19.2 52.2 39.1 82.8 50.8
#R|  [16] 25.6 58.5 38.8 23.8 85.4 23.8
#R|  
#R|  $Parks
#R|  [1] 38.7 54.2 87.9 55.1 45.7
#R|  
#R|  $Residential
#R|   [1] 44.1 69.1 37.1 47.0 70.4 51.7 79.2 53.8 44.4 65.8 44.7 43.7
#R|  
#R|  $Urban
#R|  [1] 27.5 31.8 35.4 35.6 18.5 32.2 27.5</code></pre>
</div>
</div>
<p><code>MedianCI()</code> from <code>DescTools</code> may be used to compute the median and corresponding confidence interval for a vector of values. Below is an example for the “Urban” area. The default is to use a so-called “exact” method, but here I prefer to use “bootstrapping” instead so I include <code>method="boot"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">DescTools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MedianCI</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Urban,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boot"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  median lwr.ci upr.ci 
#R|    31.8   28.2   36.1</code></pre>
</div>
</div>
<p><code>sapply()</code> can be used to “apply” <code>MedianCI()</code> to each item in the <code>tmp</code> list (so each area type) and return the result as a matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN=</span>DescTools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MedianCI,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boot"</span>)</span>
<span id="cb22-2">tmp</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         Rural Parks Residential Urban
#R|  median  47.1  54.2       49.35  31.8
#R|  lwr.ci  40.0  20.5       31.25  28.2
#R|  upr.ci  55.4  69.7       54.45  36.1</code></pre>
</div>
</div>
<p>However, the “median”, “lwr.ci”, and “upper.ci” should be the columns rather than the rows of this matrix. Thus, <code>t()</code> is used below to “transpose” the matrix which is then given to <code>data.frame()</code> to convert the matrix to a data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">sumNW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(tmp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb24-3">sumNW</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|              median lwr.ci upr.ci
#R|  Rural        47.10  40.00  55.40
#R|  Parks        54.20  20.50  69.70
#R|  Residential  49.35  31.25  54.45
#R|  Urban        31.80  28.20  36.10</code></pre>
</div>
</div>
<p>Now, unfortunately, the area type names are row names and not a variable. Below, these row names are used to create a new <code>Location3</code> variable and then converted to a factor with the levels controlled to match the authors’ order along a rural to urban gradient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">sumNW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sumNW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Location3=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(sumNW),</span>
<span id="cb26-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Location3=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Location3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rural"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parks"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residential"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Urban"</span>)))</span>
<span id="cb26-4">sumNW</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|              median lwr.ci upr.ci   Location3
#R|  Rural        47.10  40.00  55.40       Rural
#R|  Parks        54.20  20.50  69.70       Parks
#R|  Residential  49.35  31.25  54.45 Residential
#R|  Urban        31.80  28.20  36.10       Urban</code></pre>
</div>
</div>
<p>Finally, a new variable is added that contains “significance letters” that communicate the results from Dunn’s Test above. Groups that have the same letter are statistically equal and those with different letters are statistically not equal. In this case, “Urban” was different than the other three which were all the same. Thus, “Urban” will have a unique letter that is different then the same letter used for the other three. I usually start the letters on the left, so “Rural” gets an “a” which it will share with “Parks” and “Residential” before “Urban” gets a “b.”</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">sumNW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sumNW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">letsH=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>))</span>
<span id="cb28-3">sumNW</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|              median lwr.ci upr.ci   Location3 letsH
#R|  Rural        47.10  40.00  55.40       Rural     a
#R|  Parks        54.20  20.50  69.70       Parks     a
#R|  Residential  49.35  31.25  54.45 Residential     a
#R|  Urban        31.80  28.20  36.10       Urban     b</code></pre>
</div>
</div>
<p>This data frame is the used to construct the summary graphic below.</p>
</section>
<section id="summary-graphic" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="summary-graphic">Summary Graphic</h2>
<p>I created the summary graphic below by …</p>
<ul>
<li>Mapping <code>Location3</code> to the x-axis for all geoms.</li>
<li>Mapping <code>lwr.ci</code> and <code>upr.ci</code> to <code>ymin=</code> and <code>ymax=</code>, respectively, in <code>geom_errobar()</code> to create the “intervals.” Here <code>linewidth=</code> was increased to make the interval lines “heavier”<sup>6</sup> and <code>width=</code> was reduced to make the “caps” at the end of the interval lines narrower.</li>
<li>Mapping <code>median</code> to <code>y=</code> in <code>geom_point()</code> to place a point at the median. <code>geom_point()</code> came afer <code>geom_errorbar()</code> so that the point would be “on top” of the interval line. Here an open circle was used for the point with an inner portion a light gray and a black outline. The point was made larger than the default, as was the “stroke” used to draw the outline.<sup>7</sup></li>
<li>Mapping <code>letsH</code> to <code>labels=</code> and <code>upr.ci=</code> to <code>y</code> in <code>geom_text()</code> to place the significance letters at the upper CI value. The <code>vjust=</code> was used to move the text up slightly<sup>8</sup> and <code>size=</code> was used to show the letters in a 12 pt font.<sup>9</sup></li>
<li>The y-axis was labeled, the breaks were controlled at 10 g intervals, the lower limit was constrained to be at 0, and the lower expansion was removed so that the x-axis was shown at a y of 0.</li>
<li>The x-axis was labeled.</li>
<li>The black-and-white theme was applied.</li>
<li>The axis titles were set a 14 pt font, and the axis tick mark labels were set to be black and in a 12 pt font.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;The use of <code>linewidth=</code> was discussed in more detail in <a href="../2023-4-4_Size/">this post</a>.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;The use of <code>size=</code> and <code>stroke=</code> was discussed in more detail in <a href="../2023-4-4_Size/">this post</a>.</p></div><div id="fn8"><p><sup>8</sup>&nbsp;The use of <code>vjust=</code> was discussed in more detail in <a href="../2023-3-10-Text_Annotation_Position/">this post</a>.</p></div><div id="fn9"><p><sup>9</sup>&nbsp;The use of <code>size=</code> was discussed in more detail in <a href="../2023-4-4_Size/">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sumNW,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Location3)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>lwr.ci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>upr.ci),</span>
<span id="cb30-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>median),</span>
<span id="cb30-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb30-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>letsH,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>upr.ci),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Median Nest Weight (g)"</span>,</span>
<span id="cb30-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb30-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Area Type"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb30-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb30-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/index_files/figure-html/make-figure-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-vasquezetal_2022" class="csl-entry">
Vasquez, M. P., R. J. Rylander, J. M. Tleimat, and S. R. Fritts. 2022. <a href="https://doi.org/10.3996/JFWM-21-058">Use of anthropogenic nest materials by <span>Black-Crested Titmice</span> along an urban gradient</a>. Journal of Fish and Wildlife Management 13(1):236–242.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Vasquez Et Al. (2022) {Kuskal-Wallis} {Results}},
  date = {2023-04-05},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-5_Vasquez2022_Fig2},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 5. Vasquez et al. (2022) Kuskal-Wallis Results.
<a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-5_Vasquez2022_Fig2">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-5_Vasquez2022_Fig2</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>confidence intervals</category>
  <category>significance letters</category>
  <category>Kruskal-Wallis Test</category>
  <category>Dunn Test</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/</guid>
  <pubDate>Wed, 05 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-5_Vasquez2022_Fig2/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>How Does Size Work in ggplot2</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I often struggle with “size” of ggplot objects. It has seemed that <code>size=</code> behaved differently in certain situations and was unrelated to <code>linewidth=</code>. I often just fiddle with the values until I get something that looks like I want. Dissatisfied with this approach, I explored the idea of “size” in <code>ggplot2</code> further.</p>
<p>The rest of this post is split into two main sections. In the first, I describe a confusion that I had from reading the <code>ggplot2</code> documentation with respect to the size of text, points, and lines. That section finishes with a summary of my findings with respect to this confusion, which is largely a summary of one answer I received on StackOverflow (as of 1-Apr-2023), and a possible solution which seems to address my confusion. In the second section, I discuss how to set the “size” for text, lines, and points, and what these sizes mean.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="aesthetic-specification-documentation" class="level1 page-columns page-full">
<h1>Aesthetic Specification Documentation</h1>
<p>Aesthetic specifications are defined in <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">this online documentation</a>. Below I copied some of the text from that documentation as it appeared on 1-Apr-2023. Under <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#linewidth">linewidth</a> the documentation reads:</p>
<blockquote class="blockquote">
<p>Due to a historical error, the unit of linewidth is roughly 0.75 mm. Making it exactly 1 mm would change a very large number of existing plots, so we’re stuck with this mistake.</p>
</blockquote>
<p>Under <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#font-size">Font size</a> the documentation reads:</p>
<blockquote class="blockquote">
<p>The <code>size</code> of text is measured in mm. This is unusual, but makes the size of text consistent with the size of lines and points. Typically you specify font size using points (or pt for short), where 1 pt = 0.35mm. <code>ggplot2</code> provides this conversion factor in the variable <code>.pt</code>, so if you want to draw 12pt text, set <code>size = 12 / .pt</code>.</p>
</blockquote>
<p>Under <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#colour-and-fill-1">Colour and fill</a> for points the documentation reads:</p>
<blockquote class="blockquote">
<p>Note that shapes 21-24 have both stroke <code>colour</code> and a <code>fill</code>. The size of the filled part is controlled by <code>size</code>, the size of the stroke is controlled by <code>stroke</code>. Each is measured in mm, and the total size of the point is the sum of the two.</p>
</blockquote>
<p>My read of these portions of the documentation leads me to conclude that using the same value for <code>linewidth=</code> for a line and <code>size=</code> for a point and text should result in either (a) all three being the same size but scaled to approximately 0.75 mm rather than 1 mm or (b) the point and text being the same size and scaled to 1 mm and the line being smaller and scaled to 0.75 mm.</p>
<p>I tested these expectations with the plot below using a “base size” of 24 such that</p>
<ul>
<li>The gray text used <code>size=24</code> in <code>geom_text()</code>.</li>
<li>The blue-and-red point used <code>size=12</code> and <code>stroke=12</code> in <code>geom_point()</code>.</li>
<li>The orange point used <code>size=24</code> and <code>stroke=0</code> in <code>geom_point()</code>.</li>
<li>The green point used <code>size=0</code> and <code>stroke=24</code> in <code>geom_point()</code>.</li>
<li>The green-and-orange point use <code>size=12</code> and <code>stroke=12*0.753</code><sup>1</sup> in <code>geom_point()</code>.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;More about 0.753 later, but note that it is “roughly 0.75” from the documentation for <code>linewidth=</code> shown above.</p></div></div><p>From these choices and my interpretation of the documentation above, I expected the following:</p>
<ol type="1">
<li>All but the green-and-orange point to be equally sized or the black line to be smaller than all but the green-and-orange point to which it would be equal in size.</li>
<li>Regardless of the relation to the black line and the text, I expected all but the green-and-orange point to be equal in size.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">sz <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb2-2">cf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .pt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.stroke</span>
<span id="cb2-3">  </span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>sz) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Text"</span>),</span>
<span id="cb2-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>label),</span>
<span id="cb2-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y),</span>
<span id="cb2-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>sz<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y),</span>
<span id="cb2-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y),</span>
<span id="cb2-14">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>sz,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y),</span>
<span id="cb2-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>sz<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limit=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.275</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aspect.ratio=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-doc-confusion-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this, it seems like an obvious issue is related to <code>stroke=</code>. Comparing the orange (only) to the green (only) point suggests that the size” of <code>stroke=</code> is larger than the size of <code>size=</code> such that <code>size=</code> plus <code>stroke=</code> does equal the overall size of the point, but not in a one-to-one way. For example, you can not reduce <code>size=</code> by some number of units and increase <code>stroke=</code> by the same number of units to have the same overall size of point. For example, each point below has the same sum of <code>size=</code> (first number, red fill) and <code>stroke=</code> (second number, blue).<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;All overlaid on a line constructed with <code>linewidth=24</code>.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## mostly from stefan in https://stackoverflow.com/a/75896754/1123933</span></span>
<span id="cb3-2">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>stroke<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>sz)</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>size)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>sz) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>stroke,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(size,stroke,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" / "</span>)),</span>
<span id="cb3-10">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aspect.ratio=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-doc-confusion-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I asked a question about all of this on <a href="https://community.rstudio.com/t/units-of-linewidth/162885">Posit Community</a> and on <a href="https://stackoverflow.com/questions/75894278/how-are-size-and-linewidth-related-in-ggplot20">StackOverlow</a>. While responses on both platforms ultimately did not clarify the issue above, one answer on StackOverflow was instructive. There, “Stefan” pointed out that <code>size=</code> is converted to pts with a constant built-in to <code>ggplot2</code> as <code>.pt</code> and that <code>stroke=</code> is converted to pts with a constant built-in to <code>ggplot2</code> as <code>.stroke</code>. These two conversion constants are different.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">.pt</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 2.845276</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">.stroke</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 3.779528</code></pre>
</div>
</div>
<p>Interestingly, their ratio is 0.753 which sounds like the “roughly 0.75” from the documentation about <code>linewidth=</code> above. “Stefan” went on to show in his StackOverflow answer that if you multiply the stroke value by the ratio of these two constants, which he called a “correction factor”, that the overall size of the point will follow my expectations. This is illustrated below where each point below has the same sum of <code>size=</code> (first number, orange fill) and <code>stroke=</code> times the correction factor (second number, green).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## mostly from stefan in https://stackoverflow.com/a/75896754/1123933</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>size)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>sz) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>stroke<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cf,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size),</span>
<span id="cb8-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(size,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" / "</span>,stroke,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*cf"</span>)),</span>
<span id="cb8-7">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aspect.ratio=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-doc-confusion-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this it appears to me that <code>size=</code>, <code>stroke=</code>, and <code>linewidth=</code> will provide the same size for their respective objects if <code>stroke=</code> is multiplied by the “correction factor” derived from the ratio of <code>.pt</code> to <code>.stroke</code>.</p>
<p>It is worth noting at this point that this “issue” of the overall size of the point may be moot in most situations as the default <code>size=</code> is 1.5 and default <code>stroke=</code> is <code>0.5</code>. Thus, the overall point will be larger than what would be expected for a <code>size=</code> plus <code>stroke=</code> of 2, but will likely not be perceptible to most eyes. That being said, you can always set <code>stroke=0.5*.pt/*.stroke</code> for default points to adjust for this issue.</p>
<p>&nbsp;</p>
</section>
<section id="setting-sizes" class="level1 page-columns page-full">
<h1>Setting Sizes</h1>
<section id="text" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="text">Text</h2>
<section id="default-sizes" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="default-sizes">Default Sizes</h3>
<p>Unless modified by the user, the default “base” font size in most <code>ggplot2</code> themes is 11 pt, as shown below for <code>theme_grey()</code> (the default <code>ggplot2</code> theme). This can be modified with <code>base_size=</code> to the theme function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_grey</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  List of 11
#R|   $ family       : chr ""
#R|   $ face         : chr "plain"
#R|   $ colour       : chr "black"
#R|   $ size         : num 11
#R|   $ hjust        : num 0.5
#R|   $ vjust        : num 0.5
#R|   $ angle        : num 0
#R|   $ lineheight   : num 0.9
#R|   $ margin       : 'margin' num [1:4] 0points 0points 0points 0points
#R|    ..- attr(*, "unit")= int 8
#R|   $ debug        : logi FALSE
#R|   $ inherit.blank: logi TRUE
#R|   - attr(*, "class")= chr [1:2] "element_text" "element"</code></pre>
</div>
</div>
<p>Several of the default font sizes for other items are based off of this base size. For example, for most themes the axis titles are the base size, the plot title is 1.2× larger than the base size, and the axis tick labels and facet strip labels are 0.8× the base size.<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;I chose not to show the code by default for some of these plots because the point demonstrated by the plot is the point, not the code. However, click “code” if you would like to see the code.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">pd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Base Font Size (11)"</span>,</span>
<span id="cb11-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb11-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.8X Base Font Size"</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Base Font Size (11)"</span>,</span>
<span id="cb11-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>),</span>
<span id="cb11-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.8X Base Font Size"</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2X Base Font Size"</span>)</span>
<span id="cb11-10">pd</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-default-text-sizes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Text added to the plot with <code>geom_text()</code> is shown at the base font size by default.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">pd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Text at Default Base Font Size"</span>),</span>
<span id="cb12-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>label))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-default-label-size-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="text-label-font-sizes" class="level3">
<h3 class="anchored" data-anchor-id="text-label-font-sizes">Text Label Font Sizes</h3>
<p><code>geom_text()</code> has a <code>size=</code> argument for changing the size of the text. As such, you might change it to 13.2 assuming that its size would then match the size of plot title (i.e., 1.2×11).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">pd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Text at 'size=13.2'"</span>),</span>
<span id="cb13-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>label),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-default-label-issue-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>This clearly did not meet expectations. Why? Because the units for <code>size=</code> is <strong>not</strong> pts, rather it is mm. In <code>geom_text()</code> those mm units get converted to pts for displaying the text. There are a little over 72 dots (or “pts”) per inch, which corresponds to approximately 2.835 dots per mm. Thus, <code>size=13.2</code> sets the text size at approximately 13.2×2.835=37.4 pts. Thus, the very large text above.</p>
<p>This phenomenon is also evident in the default “size” used in <code>geom_text()</code> shown below. Note that 3.88×2.835=11.0 or, approximately, the 11 pt base font size.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">GeomText<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  Aesthetic mapping: 
#R|  * `colour`     -&gt; "black"
#R|  * `size`       -&gt; 3.88
#R|  * `angle`      -&gt; 0
#R|  * `hjust`      -&gt; 0.5
#R|  * `vjust`      -&gt; 0.5
#R|  * `alpha`      -&gt; NA
#R|  * `family`     -&gt; ""
#R|  * `fontface`   -&gt; 1
#R|  * `lineheight` -&gt; 1.2</code></pre>
</div>
</div>
<p>The exact conversion factor from mm to pts is stored in the <code>ggplot2</code> constant <code>.pt</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">.pt</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 2.845276</code></pre>
</div>
</div>
<p>Thus, to use <code>size=</code> in <code>geom_text()</code> to display text at a specific pt size, then divide the desired pt size by <code>.pt</code>. For example, the plot below uses <code>size=11*1.2/.pt</code> for the top text and <code>size=16/.pt</code> for the bottom text.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">pd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>),</span>
<span id="cb18-3">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Text at 1.2X Base Font Size"</span>,</span>
<span id="cb18-4">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Text at 16 pt Font Size"</span>)),</span>
<span id="cb18-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>label),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-default-label-issue-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set the font size in <code>geom_text()</code> or <code>geom_label()</code> to a desired point size by setting <code>size=</code> to the desired point size divided by the <code>ggplot2</code> constant in <code>.pt</code>. For example, use <code>size=16/.pt</code> to use a 16 pt font size.</p>
</div>
</div>
<p>The following “chart” gives an idea of how a particular <code>size=</code> will be converted to a pt size (on the left) and how a particular pt size corresponds to a <code>size=</code> value (on the right).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sz1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb19-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pts2=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sz2=</span>pts2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,</span>
<span id="cb19-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pts1=</span>sz1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>.pt,</span>
<span id="cb19-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sz1)),</span>
<span id="cb19-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(sz1),</span>
<span id="cb19-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl1=</span>glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size={sz1}; {round(pts1,1)} pt"</span>),</span>
<span id="cb19-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sz2)),</span>
<span id="cb19-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl2=</span>glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{pts2} pts; size={round(sz2,1)}"</span>))</span>
<span id="cb19-10"></span>
<span id="cb19-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl1)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>sz2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb19-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb19-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/show-mm-to-pt-conversion-examples-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="theme-related-font-sizes" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theme-related-font-sizes">Theme-Related Font Sizes</h3>
<p>Text related to plot titles,<sup>4</sup> axis titles, axis tick labels, and facet strip labels are all modified using <code>element_text()</code> with specific arguments in <code>theme()</code>. <code>element_text()</code> has <code>size=</code> for altering the size of text. However, the units of <code>size=</code> in this element function <strong>is</strong> pts and is not mm. The text sizes for the plot title, axis title, and axis tick marks for a <code>ggplot2</code> object called <code>pd2</code> are modified as shown below.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;And subtitles, captions, and tags.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">pd2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16 pt Font"</span>,</span>
<span id="cb20-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb20-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12 pt Font"</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18 pt Font"</span>,</span>
<span id="cb20-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>),</span>
<span id="cb20-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11 pt Font"</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24 pt Font"</span>)</span></code></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">pd2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),</span>
<span id="cb21-3">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>),</span>
<span id="cb21-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb21-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb21-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-theme-text-sizes-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Set the font size for <code>ggplot2</code> plot labels, axis titles, axis tick labels, and facet strip labels using <code>size=</code> in <code>element_text()</code> set equal to specific arguments related to these items in <code>theme()</code>. The values used in <code>size=</code> here is pts and, thus, do <strong>not</strong> need to be converted to pts.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="lines" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="lines">Lines</h2>
<p>Objects that are “lines” of some sort (see table below)<sup>5</sup> all control their size or thickness with <code>linewidth=</code>. As noted in the first section, <code>linewidth=</code> is measured in mm but due to an historical error it actually scales to “roughly 0.75 mm.”<sup>6</sup> The default linewidth for most geoms is 0.5, though some differ as shown below.<sup>7</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;There are still other geoms that use <code>linewidth=</code>.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;The actual mm depends on the resolution of the display device.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;These defaults come from, for example, <code>GeomLine$default_aes</code>.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom_</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abline()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"area()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bar()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boxplot()"</span>,</span>
<span id="cb22-2">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contour()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"curve()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"errorbar()"</span>),</span>
<span id="cb22-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(GeomAbline<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-4">                            GeomArea<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-5">                            GeomBar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-6">                            GeomBoxplot<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-7">                            GeomCol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-8">                            GeomContour<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-9">                            GeomCurve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-10">                            GeomErrorbar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth),</span>
<span id="cb22-11">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">     </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"     "</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb22-12">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom_</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hline()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"line()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pointrange()"</span>,</span>
<span id="cb22-13">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"polygon()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"segment()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smooth()"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tile()"</span>),</span>
<span id="cb22-14">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(GeomHline<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-15">                            GeomLine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-16">                            GeomPath<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-17">                            GeomPointrange<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-18">                            GeomPolygon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-19">                            GeomSegment<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-20">                            GeomSmooth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth,</span>
<span id="cb22-21">                            GeomTile<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>linewidth),</span>
<span id="cb22-22">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb22-23">tmp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-24">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full_width=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb22-25">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bootstrap_options=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"striped"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hover"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-26">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column_spec</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4em"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">geom_</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">default</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">geom_</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">abline()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">hline()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">area()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">line()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bar()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">path()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">boxplot()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">pointrange()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">col()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">polygon()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">contour()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">segment()</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">curve()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">smooth()</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">errorbar()</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: left; width: 4em;"></td>
<td style="text-align: left;">tile()</td>
<td style="text-align: right;">0.1</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>The display below gives an idea of the relative sizes of the different <code>linewidth=</code> values.<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;The most common default linewidth is shown in red.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">dat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lw=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(lw)),</span>
<span id="cb23-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(lw)),</span>
<span id="cb23-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(lw),</span>
<span id="cb23-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>y)</span>
<span id="cb23-6"></span>
<span id="cb23-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>yend,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>lw)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linewidth="</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>dat1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>dat1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lw) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_linewidth_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb23-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb23-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb23-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-linewidths-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="points" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="points">Points</h2>
<p>As alluded to in the first section, points consist of a <code>size=</code> “fill” portion and a <code>stroke=</code> “color” outline portion. As shown above, the total “size” of the point is the sum of the <code>size=</code> and <code>stroke=</code> value, though these values seem to be scaled differently. The <code>size=</code> portion of the point is scaled to the same as <code>size=</code> for text and <code>linewidth=</code> for lines. However, <code>stroke=</code> is scaled larger and, thus, you cannot “trade” values from <code>scale=</code> to <code>stroke=</code> to get the same size of point.</p>
<p>The default values for points are <code>size=1.5</code> and <code>stroke=0.5</code>.<sup>9</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;Because of the small <code>stroke=</code> value, the issue discussed above is likely not going to be noticeable.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">GeomPoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>default_aes</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  Aesthetic mapping: 
#R|  * `shape`  -&gt; 19
#R|  * `colour` -&gt; "black"
#R|  * `size`   -&gt; 1.5
#R|  * `fill`   -&gt; NA
#R|  * `alpha`  -&gt; NA
#R|  * `stroke` -&gt; 0.5</code></pre>
</div>
</div>
<p>The following figure gives an idea of what different sizes look like for different shapes of “points.”<sup>10</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn10"><p><sup>10</sup>&nbsp;The default <code>stroke=</code> of 0.5 was used.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">szs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb26-2">dat4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Size=</span>szs,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Shape=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fShape=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Shape,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),</span>
<span id="cb26-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fSize=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Size))</span>
<span id="cb26-5"></span>
<span id="cb26-6">stroke <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb26-7"></span>
<span id="cb26-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat4,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>fShape,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>fSize,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>Size,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>Shape)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(szs),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>szs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>stroke,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray90"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(szs),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span>szs,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray95"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke=</span>stroke) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>szs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shape"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb26-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/demo-points-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="examples" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="scatterplot-with-best-fit-line" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="scatterplot-with-best-fit-line">Scatterplot with Best-Fit Line</h3>
<p>As an example, suppose that you have log-transformed catch-at-age data that looks like this.<sup>11</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;This is typical, though idealistic, catch curve data.</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">173</span>)</span>
<span id="cb27-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">-0.4</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb27-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(catch,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb27-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">logcatch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(catch))</span>
<span id="cb27-6">dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    age catch logcatch
#R|  1   1   311 5.739793
#R|  2   2   176 5.170484
#R|  3   3   125 4.828314
#R|  4   4    60 4.094345
#R|  5   5    42 3.737670
#R|  6   6    18 2.890372
#R|  7   7    12 2.484907
#R|  8   8    26 3.258097</code></pre>
</div>
</div>
<p>And a simple “catch curve” plot is constructed that looks like this.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logcatch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span>lm,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log(Catch)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/example-plot-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>However, suppose that you made the following changes to meet some (perhaps yours) requirements.</p>
<ul>
<li>Points that are twice as big (i.e., <code>size=3</code> rather than default <code>size=1.5</code>).</li>
<li>A “best-fit” line that is 50% thicker (i.e., <code>linewidth=1.5</code> rather than default <code>linewidth=1</code>).</li>
<li>Axis title labels that are 14 pt.</li>
<li>Axis tick mark labels that are 12 pt.</li>
<li>A species annotation label (in the upper-right corner) that uses 14 pt font.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logcatch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span>lm,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log(Catch)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freshwater Drum"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,</span>
<span id="cb30-7">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb30-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb30-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/example-plot-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bar-chart-with-labels" class="level3">
<h3 class="anchored" data-anchor-id="bar-chart-with-labels">Bar Chart with Labels</h3>
<p>Suppose these same data are presented as a bar chart without the fitted line.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/example-plot-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>And further suppose that you want to make the same textual changes as above and …</p>
<ul>
<li>Borders of the bars two times heavier (i.e., <code>linewidth=1</code> rather than the default <code>linewidth=0.5</code>).</li>
<li>Horizontal gridlines four times heavier (i.e., <code>linewidth=2</code> rather than the default <code>linewidth=0.5</code>).</li>
<li>Numeric labels of the catch amount above each bar in 12 pt font.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>catch),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freshwater Drum"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,</span>
<span id="cb32-7">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb32-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb32-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb32-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/index_files/figure-html/example-plot-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {How {Does} {Size} {Work} in Ggplot2},
  date = {2023-04-03},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-4_Size},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 3. How Does Size Work in ggplot2. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-4_Size">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-4_Size</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>size</category>
  <category>annotations</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/</guid>
  <pubDate>Mon, 03 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-4_Size/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Miller et al. (2022) Catch Curve Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-1_Milleretal2022_Fig4/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the third and last post related to <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>. I do not have plans to recreate their Figure 5 as it looks like they largely followed <a href="../2019-12-31_vonB_plots_1/">this post</a>.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> examined life history characteristics of Goldeye (<em>Hiodon alosoides</em>) in two Kansas reservoirs. Their <a href="https://meridian.allenpress.com/view-large/figure/14538582/i1944-687X-13-1-243-f04.tif">Figure 4</a> represents a catch curve (log catch at age) for Goldeye captured in Milford Reservoir in 2020. I use <code>FSA</code> and <code>ggplot2</code> here to recreate this figure.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>readxl</code> and <code>scales</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for use of markdown in text/labels</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FSA)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for catchCurve et al.</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> provided the raw data for producing Figure 4 in their Data Supplement S2. These are the same data used to recreate Figures 2 and 3 <a href="../2023-3-31_Milleretal2022_Fig23/">in this post</a>. Thus, I do not explain the data wrangling used to obtain <code>dat2</code> below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../2023-3-31_Milleretal2022_Fig23/JFWM-21-090.S2.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ann<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    netid  tl   w agecap ann bclen
#R|  1     6 385 521      6   1   210
#R|  2     6 357 466      4   1   213
#R|  3     6 397 725      5   1   209
#R|  4     8 393 610      8   1   202
#R|  5     8 373 571      4   1   193
#R|  6     8 389 656      6   1   163</code></pre>
</div>
</div>
<p>The total catch of individuals at each age-at-capture is required to construct Figure 4. One issue that occurs with these data is that no age-2 fish were captured and <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> treat this as an observed zero. If the data are simply grouped by <code>agecap</code> and summarized then no age-2 data will be present in the result. There are several ways to deal with this but I am going to handle it by first creating a new variable <code>fagecap</code> that is a factored version of <code>agecap</code>. The key here, though, is to set the levels of this new variable to cover the entire range of observed ages.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fagecap=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span></code></pre></div>
</div>
<p>The “sample size” (i.e., catch) at each <code>fagecap</code> is then found. It is important to use <code>.drop=FALSE</code> so that the age-2 “level” is not removed from the resultant data frame because it did not exist in the original data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sum_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(fagecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.drop=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span>
<span id="cb5-4">sum_a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 2
#R|    fagecap catch
#R|    &lt;fct&gt;   &lt;int&gt;
#R|  1 1         122
#R|  2 2           0
#R|  3 3           5
#R|  4 4           7
#R|  5 5          10
#R|  6 6           3
#R|  7 7           2
#R|  8 8           3</code></pre>
</div>
</div>
<p>The issue now with using these data is that <code>fcapage</code> is a factor rather than a numeric. Thus, a new <code>agecap</code> variable is created below that treats age as numeric.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;This conversion code comes from <code>?factor</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">sum_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sum_a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">agecap=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(fagecap)))</span>
<span id="cb7-3">sum_a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 3
#R|    fagecap catch agecap
#R|    &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;
#R|  1 1         122      1
#R|  2 2           0      2
#R|  3 3           5      3
#R|  4 4           7      4
#R|  5 5          10      5
#R|  6 6           3      6
#R|  7 7           2      7
#R|  8 8           3      8</code></pre>
</div>
</div>
<p>Finally, the catch curve analysis ultimately requires log-transforming the catch variable. The zero for age-2 will cause an error when log-transforming. The authors addressed this by adding 1 to all of the <code>catch</code>es. This is common practice, but I comment on it further below. Also, for use when recreating Figure 4, the log of these modified catches are added to the data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">sum_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sum_a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch1=</span>catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb9-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">logcatch1=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(catch1))</span>
<span id="cb9-4">sum_a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 5
#R|    fagecap catch agecap catch1 logcatch1
#R|    &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
#R|  1 1         122      1    123      4.81
#R|  2 2           0      2      1      0   
#R|  3 3           5      3      6      1.79
#R|  4 4           7      4      8      2.08
#R|  5 5          10      5     11      2.40
#R|  6 6           3      6      4      1.39
#R|  7 7           2      7      3      1.10
#R|  8 8           3      8      4      1.39</code></pre>
</div>
</div>
</section>
<section id="catch-curve-analysis" class="level1 page-columns page-full">
<h1>Catch Curve Analysis</h1>
<p>Catch curves analysis<sup>2</sup> may be conducted with <code>catchCurve()</code> from <code>FSA</code>. <code>catchCurve</code> require a formula of the form <code>catch~age</code> as the first argument and the corresponding data frame in <code>data=</code>. The “weighted catch curve” that <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> used requires <code>weighted=TRUE</code> in <code>catchCurve()</code>. The results should be saved to an object.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;I assume the reader is familiar with catch curves. If not see Chapter 11 in <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">cc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(catch1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum_a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>The point estimates of <img src="https://latex.codecogs.com/png.latex?Z"> and <img src="https://latex.codecogs.com/png.latex?A"> may be extracted with <code>coef()</code> or seen in the <code>Estimate</code> column of the <code>summary()</code> results.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cc1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|           Z          A 
#R|   0.2709483 23.7344113</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(cc1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Estimate Std. Error  t value  Pr(&gt;|t|)
#R|  Z  0.2709483  0.2544583 1.064805 0.3279271
#R|  A 23.7344113         NA       NA        NA</code></pre>
</div>
</div>
<p>The so-called “recruitment coefficient of determination” (RCD) in <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> is just the usual r<sup>2</sup>, which can be extracted from the <code>summary()</code> of the <code>lm</code> object in <code>cc1</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">( r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(cc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lm)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 0.1589346</code></pre>
</div>
</div>
<p>These results were put into a label that will ultimately be placed on the plot.<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;This process is discussed in several previous posts, including <a href="../2023-3-29_Milleretal2022_Fig1/#reservoir-and-regression-result-labels">this one</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">lbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*Z* = "</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cc1)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>]],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb18-2">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;*A* = "</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cc1)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>]],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>,</span>
<span id="cb18-3">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;RCD = "</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(r2,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb18-4">lbl</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "*Z* = 0.27&lt;br&gt;*A* = 23.73%&lt;br&gt;RCD = 0.16"</code></pre>
</div>
</div>
<p>The <code>cc1</code> object also contains the data used in the catch curve analysis, including the weights in an object called <code>weights.e</code>. These weights are added to the <code>sum_a</code> data frame as they are needed to produce Figure 4.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The weights can be produced “manually” as described in <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span>, but this process using <code>catchCurve()</code> is more efficient and less prone to error.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">sum_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sum_a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wts=</span>cc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>weights.e)</span>
<span id="cb20-3">sum_a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 6
#R|    fagecap catch agecap catch1 logcatch1   wts
#R|    &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
#R|  1 1         122      1    123      4.81  2.68
#R|  2 2           0      2      1      0     2.45
#R|  3 3           5      3      6      1.79  2.22
#R|  4 4           7      4      8      2.08  1.98
#R|  5 5          10      5     11      2.40  1.75
#R|  6 6           3      6      4      1.39  1.52
#R|  7 7           2      7      3      1.10  1.29
#R|  8 8           3      8      4      1.39  1.06</code></pre>
</div>
</div>
<p>The data in <code>sum_a</code> are now ready to recreate Figure 4.</p>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-4" class="level1 page-columns page-full">
<h1>Recreating Figure 4</h1>
<p>Figure 4 is simply a scatterplot with a regression line overlaid. Constructing these kinds of plots was discussed in detail in <a href="../2023-3-31_Milleretal2022_Fig23/#recreating-figure-3">this post</a>. Thus, most of the code below are not discussed in depth. A very important detail, though, is that mapping <code>weight=wts</code> will provide the <code>wts</code> to <code>lm()</code> in <code>geom_smooth()</code> as weights, so that the weighted regression is used in the same way as was done in <code>catch_curve()</code>.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;In my opinion, the y-axis title should clearly note that 1 was added to the catches. Thus, my y-axis title is different than that in <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum_a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logcatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight=</span>wts)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated age"</span>,</span>
<span id="cb22-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb22-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log(catch+1)"</span>,</span>
<span id="cb22-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb22-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb22-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl,</span>
<span id="cb22-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-1_Milleretal2022_Fig4/index_files/figure-html/make-fig4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<section id="possible-modifications" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="possible-modifications">Possible Modifications</h3>
<p>As with other posts related to <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>, a confidence band can be added to this regression.<sup>6</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Note use of <code>coord_cartesian()</code> as the confidence band extends outside the desired range of the y-axis.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum_a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>logcatch1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight=</span>wts)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated age"</span>,</span>
<span id="cb23-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb23-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log(catch+1)"</span>,</span>
<span id="cb23-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb23-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb23-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb23-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl,</span>
<span id="cb23-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-1_Milleretal2022_Fig4/index_files/figure-html/make-fig4-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Here, I think the confidence band is critical to include because it demonstrates that the regression line is NOT statistically declining.<sup>7</sup> Obviously, there is mortality in this population, so this indicates data issues.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;This was also apparent by the “large” p-value for the slope in the <code>summary(cc1)</code> results above.</p></div></div><p>A major assumption of catch curve analysis is that recruitment is constant, which it clearly is not here. The most glaring evidence of this is the complete lack of age-2 fish. I don’t know if the age-2 fish should be considered as an observed zero (i.e., that age-class is actually very low) or if there is a sampling issue (i.e., was the gear highly selective; here is some evidence for that in the length frequency histogram in their Figure 2 and in <a href="../2023-3-31_Milleretal2022_Fig23/#recreating-figure-2">this post</a>.)</p>
<p>It is common to add 1 to “integer” data that has zeroes prior to log-transformation. However, this can be problematic. For example, adding 1 to the catch of age-1 fish is relatively minor (&lt;1% change from 122 to 123), but the same modification is relatively important for the catch of age-7 fish (50% increase from 2 to 3). This can influence mortality estimates. For example, below one was added <strong>only</strong> to the age-2 catch.<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;I am not suggesting that this is the correct thing to do. However, the authors would not have added a 1 if <em>one</em> age-2 fish had been captured. Thus, this will demonstrate some level of sensitivity to the data collection and analysis choice.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">sum_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sum_a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch1a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(agecap<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,catch))</span>
<span id="cb24-3">sum_a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 8 × 7
#R|    fagecap catch agecap catch1 logcatch1   wts catch1a
#R|    &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
#R|  1 1         122      1    123      4.81  2.68     122
#R|  2 2           0      2      1      0     2.45       1
#R|  3 3           5      3      6      1.79  2.22       5
#R|  4 4           7      4      8      2.08  1.98       7
#R|  5 5          10      5     11      2.40  1.75      10
#R|  6 6           3      6      4      1.39  1.52       3
#R|  7 7           2      7      3      1.10  1.29       2
#R|  8 8           3      8      4      1.39  1.06       3</code></pre>
</div>
</div>
<p>And the catch curve analysis was conducted with these data instead.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">cc1a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(catch1a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum_a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(cc1a)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Estimate Std. Error  t value  Pr(&gt;|t|)
#R|  Z  0.3400406  0.2737122 1.242329 0.2604674
#R|  A 28.8258572         NA       NA        NA</code></pre>
</div>
</div>
<p>The issue of no statistical decline is still evident, but the point estimates of A, for example, has increased substantially.</p>
<p>Ignoring the age-2 “fish” completely has an even larger effect.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">cc1b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catchCurve</span>(catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>agecap,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>sum_a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ages2use=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(cc1b)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Estimate Std. Error t value  Pr(&gt;|t|)
#R|  Z  0.6105809  0.1688334 3.61647 0.0152761
#R|  A 45.6964676         NA      NA        NA</code></pre>
</div>
</div>
<p>I am not sure what is the best way to handle this problem, but this exercise suggests to me that the published mortality estimate should be considered cautiously.</p>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-milleretal_2022" class="csl-entry">
Miller, B. T., E. Flores, D. S. Waters, and B. C. Neely. 2022. <a href="https://doi.org/10.3996/JFWM-21-090">An evaluation of <span>Goldeye</span> life history characteristics in two <span>Kansas</span> reservoirs</a>. Journal of Fish and Wildlife Management 13(1):243–249.
</div>
<div id="ref-ogleIntroductoryFisheriesAnalyses2016" class="csl-entry">
Ogle, D. H. 2016. <a href="http://derekogle.com/IFAR/">Introductory <span>Fisheries Analyses</span> with <span>R</span></a>. <span>CRC Press</span>, <span>Boca Raton, FL</span>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Miller Et Al. (2022) {Catch} {Curve} {Plot}},
  date = {2023-04-01},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-4-1_Milleretal2022_Fig4},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, April 1. Miller et al. (2022) Catch Curve Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-4-1_Milleretal2022_Fig4">https://fishr-core-team.github.io/fishR//blog/posts/2023-4-1_Milleretal2022_Fig4</a>.
</div></div></section></div> ]]></description>
  <category>Mortality</category>
  <category>Catch Curve</category>
  <category>ggplot2</category>
  <category>line plot</category>
  <category>regression</category>
  <category>labels</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-4-1_Milleretal2022_Fig4/</guid>
  <pubDate>Sat, 01 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-4-1_Milleretal2022_Fig4/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Miller et al. (2022) Size Plots</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the second of several posts related to <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>. I thank the authors for making their data available with their publication.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> examined life history characteristics of Goldeye (<em>Hiodon alosoides</em>) in two Kansas reservoirs. Their <a href="https://meridian.allenpress.com/view-large/figure/14538579/i1944-687X-13-1-243-f02.tif">Figure 2</a> and <a href="https://meridian.allenpress.com/view-large/figure/14538580/i1944-687X-13-1-243-f03.tif">Figure 3</a> examined the length frequency and weight-length relationship of Goldeye captured in Milford Reservoir in 2020. I use <code>ggplot2</code> here to recreate both figures.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>readxl</code>, <code>FSA</code>, and <code>scales</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for use of markdown in text/labels</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1">
<h1>Data Wrangling</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> provided the raw data for producing Figures 2 and 3 in their Data Supplement S2, which I loaded below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JFWM-21-090.S2.csv"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    netid  tl   w agecap ann bclen
#R|  1     6 385 521      6   1   210
#R|  2     6 385 521      6   2   264
#R|  3     6 385 521      6   3   299
#R|  4     6 385 521      6   4   329
#R|  5     6 385 521      6   5   358
#R|  6     6 385 521      6   6   378
#R|  7     6 357 466      4   1   213
#R|  8     6 357 466      4   2   262</code></pre>
</div>
</div>
<p>The first six rows above all have the same <code>tl</code>, <code>w</code>, and <code>age</code> because these variables were repeated for each of the six observed annuli on this fish’s otoliths. To construct a proper length frequency and weight-length relationship, the data need to be reduced to only one observation of <code>tl</code> and <code>w</code> per fish. Thus, below, only records that corresponded to the first <code>ann</code>ulus are retained.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ann<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    netid  tl   w agecap ann bclen
#R|  1     6 385 521      6   1   210
#R|  2     6 357 466      4   1   213
#R|  3     6 397 725      5   1   209
#R|  4     8 393 610      8   1   202
#R|  5     8 373 571      4   1   193
#R|  6     8 389 656      6   1   163</code></pre>
</div>
</div>
<p>Total length of these fish was summarized below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">sumtl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb6-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mdnTL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb6-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minTL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb6-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxTL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb6-6">sumtl</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      n mdnTL minTL maxTL
#R|  1 152   268   235   431</code></pre>
</div>
</div>
<p>These results match the summary results in the paragraph above Figure 2 in <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>. These data are ready to recreate Figures 2 and 3.</p>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-2" class="level1 page-columns page-full">
<h1>Recreating Figure 2</h1>
<p>Figure 2 is a histogram of total length, which can be created with <code>geom_histogram()</code> with <code>tl</code> mapped to the x-axis. Bin widths of 10 mm that started on 0 mm and were closed on the left, as is typical for most fisheries applications, were used.<sup>1</sup> It is difficult to discern what the authors did with respect to these arguments but my result is at least close to theirs.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Making histograms in <code>ggplot2</code> was discussed in detail in <a href="../2019-12-28_Length_Frequency_Histograms/">this post</a>.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Curiously all of their bars seem shifted left by about 5 mm; this is most noticeable at 350 mm.</p></div><div id="fn3"><p><sup>3</sup>&nbsp;Adding labels such as these was discussed in more detail in <a href="../2023-3-10-Text_Annotation_Position/">this post</a>.</p></div></div><p>To try to match the authors’ other choices I named, set limits, and defined breaks for both axes; removed the lower expansion for the y-axis so the bars did not hover about the x-axis and reduced the other expansion factors for both axes; applied the black-and-white theme; increased the font size and bolded the axis titles and tick mark labels; changed the tick mark labels to black; and used <code>annotate()</code> to add the sample size label in the upper-left corner.<sup>3</sup></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>,</span>
<span id="cb8-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb8-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>),</span>
<span id="cb8-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb8-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb8-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N ="</span>,sumtl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb8-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<section id="possible-modifications" class="level3">
<h3 class="anchored" data-anchor-id="possible-modifications">Possible Modifications</h3>
<p>I find the use of a solid fill color with no delineation of the actual bars to be difficult on the eyes. I personally like to outline the bars with <code>color="black"</code> and then fill the bars with <code>fill=</code> set to some version of gray in <code>geom_histogram()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb9-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>,</span>
<span id="cb9-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb9-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>),</span>
<span id="cb9-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb9-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb9-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N ="</span>,sumtl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb9-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig2-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>If you really like the dark fill then I would outline the bars with a lighter color.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb10-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray60"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray20"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>,</span>
<span id="cb10-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb10-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>),</span>
<span id="cb10-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb10-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb10-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N ="</span>,sumtl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb10-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig2-alt2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-3" class="level1 page-columns page-full">
<h1>Recreating Figure 3</h1>
<p>Figure 3 is a scatterplot of weight versus length, with a best-fit regression line overlaid. The authors used a log-scale for both axes rather than plotting the log-transformed data. The basic scatterplot is constructed with <code>geom_point()</code> with the appropriate variables mapped to their respective axes. The authors used points that were outlined in black and semi-transparent in the middle. Circles with separate outline and fill colors are made with <code>shape=21</code>, with the outline color in <code>color=</code> and the fill color in <code>fill=</code>. <code>col2rgbt()</code> from <code>FSA</code> adds a transparency value (the second argument) to a named color.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col2rgbt</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb11-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Log-scales can be created in a variety of ways, but I prefer to use <code>trans=log10</code> in <code>scale_(x|y)_continuous()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col2rgbt</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb12-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">440</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb12-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass (g)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb12-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb12-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb12-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The linear regression line is added with <code>geom_smooth()</code> using <code>method="lm"</code>,<sup>4</sup> <code>se=FALSE</code> to suppress showing the confidence band, and <code>color="black"</code> to show the line in black.<sup>5</sup> Because <code>trans="log10"</code> was used for both scales, the regression will be performed with log-transformed lengths and weights.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The default is to use a loess model.</p></div><div id="fn5"><p><sup>5</sup>&nbsp;The default is blue.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb13-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">440</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb13-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass (g)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb13-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb13-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb13-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb13-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Creating the regression results labels is similar to that shown in <a href="../2023-3-29_Milleretal2022_Fig1/#reservoir-and-regression-result-labels">this previous post</a>. The regression must be performed on the log-log scale and, thus, variables for the log of weight and length are added to the data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">logtl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log10</span>(tl),</span>
<span id="cb14-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">logw=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log10</span>(w))</span></code></pre></div>
</div>
<p>The regression is then fit and the summarized results saved to an object called <code>tmp</code>. The r<sup>2</sup>, intercept (stored in <code>b</code>), and slope (in <code>m</code>) are extracted and assigned to objects. Each was rounded to two decimals to match the authors’ choices.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(logw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>logtl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2))</span>
<span id="cb15-2">( r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 0.98</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">( b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Intercept)"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] -4.38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">( m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logtl"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 2.75</code></pre>
</div>
</div>
<p>These results are then turned into labels using markdown language code. Recall that text wrapped in <code>*</code> or <code>&lt;emph&gt;</code>will be italicized, text wrapped in <code>^</code> or <code>&lt;sup&gt;</code> will be superscripted, and text wrapped in <code>~</code> or <code>&lt;sub&gt;</code> will be subscripted.<sup>6</sup> The <code>&amp;times;</code> is specific code to produce the × symbol. <code>paste0</code> pastes text together with no separation between the provided parts.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;I had inconsistent problems using <code>^</code> in the equation so I used <code>&lt;sup&gt;</code> here.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*r*^2^ = "</span>,r2)</span>
<span id="cb21-2">eqn1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass = 10&lt;sup&gt;("</span>,b,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>,m,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;times;log~10~TL)&lt;/sup&gt;"</span>)</span></code></pre></div>
</div>
<p>These labels are then added to the plot with <code>annotate()</code> using <code>geom="richtext"</code> so that the markdown language code will be rendered appropriately. Note that <code>Inf</code> does not work well with <code>trans="log10"</code> so the <code>x=</code> and <code>y=</code> coordinates had to be specified.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb22-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">440</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb22-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass (g)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb22-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb22-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb22-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>r2,</span>
<span id="cb22-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>eqn1,</span>
<span id="cb22-17">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<section id="possible-modifications-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="possible-modifications-1">Possible Modifications</h3>
<p>The equation of the regression is presented oddly in the sense that the left-hand-side is on the original mass scale but the right-hand-side shows log-transformed length but has that in a superscript of 10 suggesting a back-transformation to the original scale. If the actual values of the intercept and slope on the transformed scale are important for some reason then I suggest showing the results as a fully-transformed (linear) model. However, if the idea is to show the power function on the original scale then I suggest fully back-transforming the right-hand-side. Below I show this second option. Note that <code>formatC()</code> is used with <code>format="f"</code> so that the back-transformed intercept is not presented in scientific notation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">( bb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Intercept)"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span>]),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "0.000041"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">eqn2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass = "</span>,bb,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TL&lt;sup&gt;"</span>,m,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/sup&gt;"</span>)</span></code></pre></div>
</div>
<p>It is not really that important, but it seems odd to me to have the r<sup>2</sup> above the model equation. Thus, I switched these two below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb26-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">440</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb26-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass (g)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb26-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb26-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb26-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>eqn2,</span>
<span id="cb26-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>r2,</span>
<span id="cb26-17">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The authors presented a confidence band in their Figure 5 and I showed how to add one to their Figure 1 in <a href="../2023-3-29_Milleretal2022_Fig1/#confidence-band">this post</a>. As I said there, for the purposes of consistency I would add a confidence band to this plot as well by simply removing <code>se=FALSE</code> from <code>geom_smooth()</code>.<sup>7</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;The regression line is so strong that the confidence band is barely noticeable.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>w)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb27-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">440</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb27-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mass (g)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>,</span>
<span id="cb27-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb27-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb27-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>eqn2,</span>
<span id="cb27-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"richtext"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>r2,</span>
<span id="cb27-17">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/index_files/figure-html/make-fig3-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-milleretal_2022" class="csl-entry">
Miller, B. T., E. Flores, D. S. Waters, and B. C. Neely. 2022. <a href="https://doi.org/10.3996/JFWM-21-090">An evaluation of <span>Goldeye</span> life history characteristics in two <span>Kansas</span> reservoirs</a>. Journal of Fish and Wildlife Management 13(1):243–249.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Miller Et Al. (2022) {Size} {Plots}},
  date = {2023-03-31},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-31_Milleretal2022_Fig23},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 31. Miller et al. (2022) Size Plots. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-31_Milleretal2022_Fig23">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-31_Milleretal2022_Fig23</a>.
</div></div></section></div> ]]></description>
  <category>Length Frequency</category>
  <category>Size Structure</category>
  <category>Weight-Length</category>
  <category>Linear Regression</category>
  <category>ggplot2</category>
  <category>line plot</category>
  <category>histogram</category>
  <category>annotations</category>
  <category>labels</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/</guid>
  <pubDate>Fri, 31 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-31_Milleretal2022_Fig23/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Nested X-Axis Labels</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Recently a Twitter follower asked …</p>
<blockquote class="blockquote">
<p>Any thought on easy ways to add a second x axis? Ex: sampling periods (sequential) on x axis and reviewer asking for the correspoding year as an additional axis under/over primary axis. It appears…hard to do.</p>
</blockquote>
<p>Here I explore a few different ways to do this.</p>
<p>The following packages are used here. Also note that a few functions from <code>FSA</code> and <code>scales</code> are used with <code>::</code> so that the entire package is not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for ggplot2 and dplyr</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggh4x)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for a variety of "hacks" described below</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="option-1---facets" class="level1 page-columns page-full">
<h1>Option 1 - Facets</h1>
<section id="example-1---bar-chart" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="example-1---bar-chart">Example 1 - Bar Chart</h2>
<section id="sample-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sample-data">Sample Data</h3>
<p>Suppose you have very simple data where some numeric summary has been made for each group and that those groups are also categorized to a higher level. For example, total catch by species with species also categorized by family.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Family is made a <code>factor()</code> here so that the order could be controlled (rather than alphabetical by default).</p></div></div><div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centrarchid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centrarchid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Esocid"</span>),</span>
<span id="cb2-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bluegill"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pumpkinseed"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Walleye"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sauger"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Muskellunge"</span>),</span>
<span id="cb2-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(family,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centrarchid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Esocid"</span>)))</span>
<span id="cb2-5">dat1</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         family     species catch
#R|  1 Centrarchid    Bluegill    34
#R|  2 Centrarchid Pumpkinseed    45
#R|  3      Percid     Walleye    23
#R|  4      Percid      Sauger    36
#R|  5      Esocid Muskellunge     7</code></pre>
</div>
</div>
<p>A simple bar chart of these data is created with <code>geom_col()</code> with <code>species</code> mapped to the x-axis and <code>catch</code> mapped to the y-axis. Here I provided a title for the y-axis, removed the lower expansion and reduce the upper expansion of the y-axis, applied the classic theme, increased the size of the axis title and tick mark text, made the axis titles bold, made the tick mark text black, and removed the x-axis title.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb4-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-fig-base-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>What the Twitter follower would want in this case is another layer of x-axis labels that would succinctly identify the family for each species.</p>
</section>
<section id="specifying-facets" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="specifying-facets">Specifying Facets</h3>
<p>Faceting provides one option for applying these labels. Below I added one row of facets based on the family name with <code>facet_grid()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb5-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>This does not look immediately helpful!! However, adding <code>scales="free_x"</code> to <code>facet_grid()</code> reduces each x-axis to only the species present in that facet (i.e., family).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb6-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Adding <code>space=free_x</code> to <code>facet_grid()</code> ensures that the “bars” in each facet are the same width by adjusting the facet width to match the space needed to show just the data for that facet.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb7-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Finally, adding <code>switch="x"</code> to <code>facet_grid()</code> moves the facet strip labels to the bottom of the plot area for each facet.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb8-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The next step is to move the facet strip labels “outside”<sup>2</sup> the axis tick mark labels with <code>strip.placement='outside'</code> in <code>theme()</code>. The facet strip “box” was also removed with <code>strip.background.x=</code> and the facet strip text was altered with <code>strip.text=</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Rather than the default “inside”.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb9-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb9-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.placement=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outside'</span>,</span>
<span id="cb9-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Finally, facets were “smushed” together so that the x-axis looks continuous by reducing <code>panel.spacing.x=</code> to 0.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb10-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb10-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.placement=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outside'</span>,</span>
<span id="cb10-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb10-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The family categorization could be further highlighted with a <code>fill=</code> color mapped to <code>family</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>family)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_grey</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(family),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb11-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb11-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.placement=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outside'</span>,</span>
<span id="cb11-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb11-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb11-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-facet-6-add-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Open Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>I could not, using this method, figure out how to reduce the inter-facet gap between bars so that it matched the intra-facet gap between bars.</p>
</div>
</div>
</section>
</section>
<section id="example-2---bar-chart-with-dates" class="level2">
<h2 class="anchored" data-anchor-id="example-2---bar-chart-with-dates">Example 2 - Bar Chart with Dates</h2>
<p>The Twitter follower’s questions was about dates. So, imagine data that is the total catch of a species from the second(ish) week of each month over a few year period.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample_date=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-8-12"</span>),</span>
<span id="cb12-2">                                   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-4-7"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample_date=</span>sample_date<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>((<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_date),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb12-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_date),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>)))</span>
<span id="cb12-5"></span>
<span id="cb12-6">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     sample_date catch
#R|  1   2020-08-14    73
#R|  2   2020-09-15   110
#R|  3   2020-10-15   149
#R|  18  2022-01-14   131
#R|  19  2022-02-07    83
#R|  20  2022-03-10    54</code></pre>
</div>
</div>
<p>Now extract the month and year from the sample dates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mon=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(sample_date,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb14-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yr=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(sample_date))</span>
<span id="cb14-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     sample_date catch mon   yr
#R|  1   2020-08-14    73 Aug 2020
#R|  2   2020-09-15   110 Sep 2020
#R|  3   2020-10-15   149 Oct 2020
#R|  18  2022-01-14   131 Jan 2022
#R|  19  2022-02-07    83 Feb 2022
#R|  20  2022-03-10    54 Mar 2022</code></pre>
</div>
</div>
<p>A plot using the faceting method is created below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>mon,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(yr))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(yr),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'free_x'</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'free_x'</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb16-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb16-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.placement=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outside'</span>,</span>
<span id="cb16-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb16-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb16-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat2-facet-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="option-2---ggh4x" class="level1 page-columns page-full">
<h1>Option 2 - ggh4x</h1>
<section id="example-1---bar-chart-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="example-1---bar-chart-1">Example 1 - Bar Chart</h2>
<p>The <code>ggh4x</code> package provides <code>guide_axis_nested()</code> and related helpers for creating the secondary x-axis. This function, however, is predicated on plotting the <em>interaction</em> between the variables that defined the primary and secondary labels on the x-axis. An “interaction” is created with <code>interaction()</code> with, for these purposes, the nested variable listed second. For further below it is important to note that the parts of the interactions are separated by a single dot/period.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">dat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sfint=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interaction</span>(species,family))</span>
<span id="cb17-3">dat1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         family     species catch                   sfint
#R|  1 Centrarchid    Bluegill    34    Bluegill.Centrarchid
#R|  2 Centrarchid Pumpkinseed    45 Pumpkinseed.Centrarchid
#R|  3      Percid     Walleye    23          Walleye.Percid
#R|  4      Percid      Sauger    36           Sauger.Percid
#R|  5      Esocid Muskellunge     7      Muskellunge.Esocid</code></pre>
</div>
</div>
<p>The basic bar chart from above is modified by mapping this interaction variable, rather than <code>species</code>, to the x-axis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sfint,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb19-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb19-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-fig-base-with-interaction-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The parts of the interactions can be disentangled and turned into nested axes by setting <code>guide_axis_nested()</code> equal to <code>guide=</code> in <code>scale_x_discrete()</code>. Note that <code>delim="."</code> is used in <code>guide_axis_nested()</code> because the parts of the interaction were separated with a single dot/period.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sfint,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis_nested</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb20-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-ggh4x-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The primary tick mark labels are controlled with <code>axis.text.x=</code> which inherits from <code>axis.text=</code> if not given. Thus, the “species” labels are 10 pt black as defined above. The secondary tick mark labels inherit from <code>axis.text.x=</code> unless modifications are made in <code>ggh4x.axis.nesttext.x=</code> using <code>element_text()</code>. Below the “family” labels are set to 12 pt bold text.<sup>3</sup> Finally, the line that separates the levels of labels is controlled with <code>element_line()</code> in <code>ggh4x.axis.nestline.x=</code>. The line is made slightly heavier below for illustration.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;And will be black because <code>axis.text=</code> was set to black.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sfint,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis_nested</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb21-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb21-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.nesttext.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb21-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.nestline.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-ggh4x-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Open Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>I could not, using this method, figure out how to make the line between the two levels of labels longer. For example, I would prefer the “Centrarchid” line to extend further right to more completely cover “Pumpkinseed.”</p>
</div>
</div>
</section>
<section id="example-2-bar-chart-with-dates" class="level2">
<h2 class="anchored" data-anchor-id="example-2-bar-chart-with-dates">Example 2 – Bar Chart with Dates</h2>
<p>The data frame used for Option 1 must be modified to include the interaction between the <code>mon</code> and <code>yr</code> for use with <code>ggh4x</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">myint=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interaction</span>(mon,yr))</span>
<span id="cb22-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     sample_date catch mon   yr    myint
#R|  1   2020-08-14    73 Aug 2020 Aug.2020
#R|  2   2020-09-15   110 Sep 2020 Sep.2020
#R|  3   2020-10-15   149 Oct 2020 Oct.2020
#R|  18  2022-01-14   131 Jan 2022 Jan.2022
#R|  19  2022-02-07    83 Feb 2022 Feb.2022
#R|  20  2022-03-10    54 Mar 2022 Mar.2022</code></pre>
</div>
</div>
<p>A plot using <code>ggh4x</code> is created below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>myint,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(yr))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis_nested</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb24-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb24-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.nesttext.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb24-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.nestline.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>),</span>
<span id="cb24-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat2-ggh4x-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="option-3---manual-placement" class="level1 page-columns page-full">
<h1>Option 3 - Manual Placement</h1>
<section id="example-1---bar-chart-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="example-1---bar-chart-2">Example 1 - Bar Chart</h2>
<p>A third options is to create space below the x-axis and “place” the secondary axis “manually.” Before creating this space it is important to order primary axis labels so that categories to be grouped by the secondary level are next to each other. In this example, the species variable must be converted to a factor with the levels controlled so that families are grouped together.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">dat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bluegill"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pumpkinseed"</span>,</span>
<span id="cb25-3">                                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Walleye"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sauger"</span>,</span>
<span id="cb25-4">                                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Muskellunge"</span>)))</span></code></pre></div>
</div>
<p>Space below the x-axis is created by increasing the <code>b</code>ottom margin around the plot with <code>plot.margin=</code> in <code>theme()</code>. Below the bottom margin was increased to two “lines” and the other margins were set to one “line”.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The top, left, and right margins are defined by <code>t=</code>, <code>l=</code> and <code>r=</code> in <code>margin()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb26-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb26-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-manual-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Plot “clipping” must be turned off with <code>clip="off"</code> in <code>coord_caresian()</code> to be able to place “objects” in the space just created.<sup>5</sup> In addition, the y-axis limits should be set with <code>ylim=</code> in <code>coord_cartesian()</code> so that the y-axis limits do not change as labels are added beneath the x-axis. As a demonstration, I placed my name at the x=1.5 and y=-5 coordinate.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Because that space is outside of the main plot area.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb27-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb27-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Derek"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-manual-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Choosing a value for the y-coordinate beneath the axis is largely a matter of trial-and-error after an initial first guess. The x-coordinate, though, can largely be determined from the x-axis. The levels for a factor such as <code>species</code> are recorded as integers “behind-the-scenes.” In this example, a “Bluegill” is defined with a “1” as it is the first level and its bar will be above an invisible “1” on the x-axis. Thus, placing my name at x=1.5 centers it between the first and second bars.</p>
<p>Here I want to create a secondary axis similar to what <code>ggh4x</code> produced – a line segment with a label underneath it. The first segment for the secondary axis should cover “Bluegill” and “Pumpkinseed.” Thus, it should start a little below 1 and end a little above 2. Other segments are defined similarly and stored in a data frame below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">x2lns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xstart=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.55</span>),</span>
<span id="cb28-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.45</span>))</span>
<span id="cb28-3">x2lns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    xstart xend
#R|  1   0.55 2.45
#R|  2   2.55 4.45
#R|  3   4.55 5.45</code></pre>
</div>
</div>
<p>At first, I roughly guess at starting and ending points and then come back to adjust these values if the lines need to be extended or shortened to look good. These segments are added to the plot with <code>geom_segment()</code> using this new data frame with the variables mapped appropriately. I set <code>y=</code> and <code>yend=</code> outside of <code>aes()</code> as the y-coordinate is constant for all these segments. Finally, the segment was made slightly heavier.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb30-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb30-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb30-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb30-11">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-manual-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Once the segments are set as desired, another data frame is created that has the x-axis coordinate and text for the secondary axis label. Below, the coordinate was found by averaging <code>xstart</code> and <code>xend</code> for each segment in <code>x2lns</code>.<sup>6</sup> The text for the labels was then entered manually.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;This x coordinates in this data frame could have been entered manually, but computing the average makes it easier to put the label in the center of the segment.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">x2lbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x2lns <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(xstart,xend))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centrarchid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percid"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Esocid"</span>))</span>
<span id="cb31-6">x2lbls</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 3 × 2
#R|        x lbl        
#R|    &lt;dbl&gt; &lt;chr&gt;      
#R|  1   1.5 Centrarchid
#R|  2   3.5 Percid     
#R|  3   5   Esocid</code></pre>
</div>
</div>
<p>These labels are then added with <code>geom_text()</code> using the new data frame with the variables mapped appropriately. Again, <code>y=</code> was set outside of <code>aes()</code> as this coordinate is constant for all labels. The text was adjusted to be a 12 pt bold.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb33-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb33-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb33-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb33-11">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb33-13">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat1-manual-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Choosing how much to increase the bottom margin and choosing the x- and y-coordinates for the secondary x-axis labels with this method is largely a matter of trial-and-error.</p>
</div>
</div>
</section>
<section id="example-3---line-plot" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="example-3---line-plot">Example 3 - Line Plot</h2>
<p>Options 1 and 2 cannot handle situations where the plot is not “discrete.”<sup>7</sup> For example, suppose that a line plot of total catch in <code>dat2</code> by <em>sample date</em> (rather than month) is desired.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;At least, I could not make them work for these situations.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sample_date,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>),</span>
<span id="cb34-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b %y"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb34-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb34-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat2-line-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>However, the x-axis is cluttered and suppose that a reviewer wants the months shown on the x-axis ticks with years as a secondary axis below that. The methods from above may be tried, but faceting clearly does not work (see below) and I could not get the <code>ggh4x</code> method to work with <code>scale_x_date()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sample_date,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>),</span>
<span id="cb35-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(yr),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'free_x'</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'free_x'</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">switch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb35-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb35-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb35-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.placement=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outside'</span>,</span>
<span id="cb35-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb35-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb35-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat2-line-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>Option 3, however, will work for situations like this. For this example, segments should “cover” Sep-Dec for 2021, Jan-Dec for 2022, and Jan-Mar for 2023. Starting (in <code>xstart</code>) and ending (in <code>xend</code>) dates for these segments are put in a data frame below. A data frame of labels is then constructed from it similar to before, except that the label is the year extracted from the x-coordinate date.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">x2lns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xstart=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20-Aug-2020"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20-Dec-2020"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20-Dec-2021"</span>),</span>
<span id="cb36-2">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%d-%B-%Y"</span>),</span>
<span id="cb36-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15-Dec-2020"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15-Dec-2021"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15-Mar-2022"</span>),</span>
<span id="cb36-4">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%d-%B-%Y"</span>))</span>
<span id="cb36-5"></span>
<span id="cb36-6">x2lbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x2lns <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(xstart,xend))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(x))</span></code></pre></div>
</div>
<p>Segments and labels are then added as before.<sup>8</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Note the use of <code>coord_cartesian()</code>, <code>geom_segment()</code>, <code>geom_text()</code>, and <code>plot.margin=</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sample_date,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>),</span>
<span id="cb37-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total catch"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>),</span>
<span id="cb37-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb37-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb37-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span id="cb37-13">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>,</span>
<span id="cb37-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/dat2-line-manual-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-4---histogram" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="example-4---histogram">Example 4 - Histogram</h2>
<p>In this example, I use data on female Walleye captured from location “2” in Lake Erie in 2010.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WalleyeErie2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSAdata"</span>)</span>
<span id="cb38-2">waedat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WalleyeErie2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(loc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>,sex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female"</span>)</span>
<span id="cb38-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(waedat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        setID loc grid year  tl    w    sex    mat age
#R|  1   2010019   2 1005 2010 642 3138 female mature   7
#R|  2   2010019   2 1005 2010 686 3360 female mature   7
#R|  3   2010019   2 1005 2010 685 3489 female mature  11
#R|  919 2010058   2 1230 2010 715 4169 female mature  10
#R|  920 2010058   2 1230 2010 549 1853 female mature   3
#R|  921 2010058   2 1230 2010 596 2432 female mature   7</code></pre>
</div>
</div>
<p>Suppose we want to make a simple length frequency histogram like that below,<sup>9</sup> but with Gabelhouse length categories (“stock”, “quality”, etc.) listed below the lengths but above the title on the x-axis.<sup>10</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;See <a href="../2019-12-28_Length_Frequency_Histograms/">this post</a> about making length frequency histograms in <code>ggplot2</code>.</p></div><div id="fn10"><p><sup>10</sup>&nbsp;There are probably better ways to create these labels, but this works as a demonstration of the secondary x-axis.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>waedat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb40-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/wae-hist-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The values for the Gabelhouse length categories are obtained from <code>psdVal()</code> in <code>FSA</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">( waepsd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">psdVal</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Walleye"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">incl.zero=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      stock   quality preferred memorable    trophy 
#R|        250       380       510       630       760</code></pre>
</div>
</div>
<p>These values are used to make the endpoints of the segment lines, noting that each stops 2 mm before the next segment starts so as to provide a visible break in the segments. A data frame of labels was created as above, except that the text for the labels came from the names provided with <code>psdVal()</code>. Also note that 810 (i.e., the end of the x-axis) was appended to the segment ends so that the “trophy” segment would have an end point.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">x2lns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xstart=</span>waepsd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(waepsd[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">810</span>))</span>
<span id="cb43-2">x2lns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|            xstart xend
#R|  stock        250  378
#R|  quality      380  508
#R|  preferred    510  628
#R|  memorable    630  758
#R|  trophy       760  810</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">x2lbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x2lns <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb45-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb45-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(xstart,xend))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb45-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb45-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(waepsd))</span>
<span id="cb45-6">x2lbls</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 5 × 2
#R|        x lbl      
#R|    &lt;dbl&gt; &lt;chr&gt;    
#R|  1   314 stock    
#R|  2   444 quality  
#R|  3   569 preferred
#R|  4   694 memorable
#R|  5   785 trophy</code></pre>
</div>
</div>
<p>Making room for the secondary labels is a little different here because the x-axis title is maintained. Thus, instead of changing <code>plot.margin()</code> as above, more space is added by increasing the top margin of the x-axis title with <code>axis.title.x=</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>waedat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb47-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb47-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb47-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/wae-hist-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>This space is then filled with the secondary axis labels as before.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>waedat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb48-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb48-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb48-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb48-12">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb48-14">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/wae-hist-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="further-thoughts" class="level1 page-columns page-full">
<h1>Further Thoughts</h1>
<p>Option 3 provides a great deal of flexibility. For example, suppose for the length frequency histogram that the segments are separated with vertical lines rather than breaks. To accomplish this, the 2 mm spacing in the segments data frame must be removed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">x2lns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xstart=</span>waepsd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(waepsd[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">810</span>))</span>
<span id="cb49-2"></span>
<span id="cb49-3">x2lbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x2lns <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(xstart,xend))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbl=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(waepsd))</span></code></pre></div>
</div>
<p>Then, for the segments, arrows are added at the beginning, but with a 90<sup>o</sup> angle so that they look like vertical lines.<sup>11</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;“Arrows” only at the beginning of the segments will make the last “trophy” segment appear open-ended, as it should.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>waedat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb50-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb50-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb50-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb50-12">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,</span>
<span id="cb50-13">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb50-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/wae-hist-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>As another example, <code>geom_rect()</code> with judicious choices for <code>ymin=</code> and <code>ymax=</code> can be used to provide more options for the secondary axis labels.<sup>12</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn12"><p><sup>12</sup>&nbsp;Note here that <code>data=</code> and <code>mapping=</code> had to moved out of <code>ggplot()</code> and put into <code>geom_histogram()</code> for this to work.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>waedat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>tl),</span>
<span id="cb51-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">boundary=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">closed=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb51-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Length (mm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>),</span>
<span id="cb51-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb51-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clip=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lns,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin=</span>xstart,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax=</span>xend),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb51-13">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray30"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>x2lbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbl),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.75</span>,</span>
<span id="cb51-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/index_files/figure-html/wae-hist-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Nested {X-Axis} {Labels}},
  date = {2023-03-30},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-30_Nested_xaxis},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 30. Nested X-Axis Labels. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-30_Nested_xaxis">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-30_Nested_xaxis</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>axes</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/</guid>
  <pubDate>Thu, 30 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-30_Nested_xaxis/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Miller et al. (2022) CPE Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the first of several posts related to <span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span>. I thank the authors for making their data available with their publication.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> examined life history characteristics of Goldeye (<em>Hiodon alosoides</em>) in two Kansas reservoirs. Their <a href="https://meridian.allenpress.com/view-large/figure/14538577/i1944-687X-13-1-243-f01.tif">Figure 1</a> displayed a time series of catch-per-unit-effort (CPE) from 1997 to 2020 for both reservoirs, including a regression line to demonstrate the decline in abundance. I use <code>ggplot2</code> here to recreate both figures.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>readxl</code>, <code>FSA</code>, <code>scales</code>, and <code>rstatix</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for use of markdown in text/labels</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<p><span class="citation" data-cites="milleretal_2022">Miller et al. (2022)</span> provided the raw data for producing Figure 1 in the Data Supplement S1, which I loaded below. I converted the “reservoir” (<code>impd</code>) variable to a factor, reordered the levels so that the facets created below would be in the order used by the authors, and replaced the reservoir abbreviations with their longer names/labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JFWM-21-090.S1.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">impd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(impd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MILR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LOVR"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milford"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lovewell"</span>)))</span>
<span id="cb2-3"></span>
<span id="cb2-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         impd   yr fish nets net_area_m2   catch_m2
#R|  1  Lovewell 1997  496   16    1189.158 0.41710171
#R|  2  Lovewell 1998  499   16    1189.158 0.41962450
#R|  3  Lovewell 1999  324   16    1189.158 0.27246160
#R|  45  Milford 2017   73   20     891.870 0.08185049
#R|  46  Milford 2018   10   20     891.870 0.01121240
#R|  47  Milford 2020   49   20     891.870 0.05494074</code></pre>
</div>
</div>
<p>I double-checked to make sure that the provided CPE variable (<code>catch_m2</code>) was equal to catch (<code>fish</code>) divided by the areal effort (<code>net_area_m2</code>).<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<code>all_equal()</code> checks equality between two vectors with a tolerance for machine precision.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all.equal</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fish<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>net_area_m2,dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>catch_m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] TRUE</code></pre>
</div>
</div>
<p>These data are ready to recreate Figure 1.</p>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-1" class="level1 page-columns page-full">
<h1>Recreating Figure 1</h1>
<section id="basic-plot-with-regression-line" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="basic-plot-with-regression-line">Basic Plot with Regression Line</h3>
<p>The basic time series plot is created with <code>geom_line()</code> by mapping <code>yr</code> to the x-axis and <code>catch_m2</code> to the y-axis, and using a shade of gray and slightly thicker line to match the authors’ choices. A linear regression is added with <code>geom_smooth()</code> using <code>method="lm"</code>.<sup>2</sup> Here <code>se=FALSE</code> was used so a confidence band is not shown, and the line was changed to dashed, made black,<sup>3</sup> and made a little thicker than the time series line to match the authors’ choices. A facet based on <code>impd</code> was created with <code>ncol=1</code> to stack the two plots and <code>scales="free_x"</code> so that labeled ticks would appear on the x-axis of both facets. Finally, the y-axis was labelled (more on this below), both axis limits were controlled and were expanded in a way to try to match the authors’ choices, and the basic black-and-white theme was added.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;The default is to add a loess smoother, <code>lm</code> is for a linear model.</p></div><div id="fn3"><p><sup>3</sup>&nbsp;It defaults to blue.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The portion of the regression line for Lovewell that extends below 0 was cut off in the published Figure 1. It is tempting to accomplish this by limiting the extent of the y-axis with <code>limits=</code> in <code>scale_y_continuous()</code> as has been done in other posts. However, in this case, that will remove the years for which the regression extends below zero from the data used to compute the regression, effectively altering the results. The better way to handle this is to limit the extent of the y-axis with <code>ylim=</code> in <code>coord_cartesian()</code>. With this all data is used in the regression, but the axis is clipped for viewing.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The theme was then modified to try to match choices made by the authors. Specifically, the grid lines were removed; the x-axis title was removed; the axes tick mark labels were made slightly larger, bold, and black; and the facet strip labels were removed. In addition, the y-axis title was formatted with <code>element_markdown()</code> which forces any markdown language code in the title to be rendered appropriately. In this case, the “carets” around the “2” in <code>name=</code> (in <code>scale_y_continuous()</code>) is markup code to superscript the “2.” Other arguments to <code>element_markdown()</code> are treated the same as those in <code>element_text()</code>. Thus, the y-axis title was also made slightly larger and bold.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reservoir-and-regression-result-labels" class="level3">
<h3 class="anchored" data-anchor-id="reservoir-and-regression-result-labels">Reservoir and Regression Result Labels</h3>
<p>The last part to add to the plot is the reservoir label along with the significance (of the slope) and “r-squared” value from the regression. This takes a little bit of work.</p>
<p>First, the regressions for each reservoir were fit “outside” of ggplot and the results returned from <code>summary()</code> were saved to individual objects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">mreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(catch_m2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat,impd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milford"</span>)))</span>
<span id="cb9-2">lreg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(catch_m2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat,impd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lovewell"</span>)))</span></code></pre></div>
</div>
<p>These objects contain the pertinent p-value and r-squared, which will be extracted for use. The p-value is in the second row and <code>Pr(&gt;|t|)</code> column of the <code>$coefficients</code> portion of the results. These values were extracted from both regression results, saved into a vector <code>ps</code>, and then that vector was given to <code>p_format()</code> from <code>rstatix</code> for formatting. This particular use of <code>p_format()</code> will include the <code>p=</code> or <code>p&lt;</code> label, will use one significant digit, and will convert any p-value that is less than 0.001 to “p&lt;0.001”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">( ps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mreg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pr(&gt;|t|)"</span>],lreg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pr(&gt;|t|)"</span>]) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 7.148242e-03 3.053910e-08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">( ps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>rstatix<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p_format</span>(ps,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add.p=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "p=0.007" "p&lt;0.001"</code></pre>
</div>
</div>
<p>The r-squared values are stored in <code>$r.squared</code> of the regression results and are extracted below and placed into a vector <code>rs</code>. They are then rounded to three decimal places and appended to <code>r^2^</code> which is markdown language for r<sup>2</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">( rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mreg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared,lreg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 0.2971323 0.7588716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">( rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r^2^="</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(rs,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)) )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "r^2^=0.297" "r^2^=0.759"</code></pre>
</div>
</div>
<p>Finally, a small data frame was created that had the reservoir names (in factor format to match the original data frame) and the <code>ps</code> and <code>rs</code> pasted together with <code>&lt;br&gt;</code> in between in a variable called <code>lbls</code>. The <code>&lt;br&gt;</code> will force a “line break” when the markdown language is rendered, thus forming a label with the r-squared value beneath to p-value result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">dlbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">impd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milford"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lovewell"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milford"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lovewell"</span>)),</span>
<span id="cb18-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbls=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(ps,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,rs))</span>
<span id="cb18-3">dlbls</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        impd                  lbls
#R|  1  Milford p=0.007&lt;br&gt;r^2^=0.297
#R|  2 Lovewell p&lt;0.001&lt;br&gt;r^2^=0.759</code></pre>
</div>
</div>
<p>The reservoir names are added with <code>geom_text()</code> below as described in <a href="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-18-Rooketal2022_CiscoHarvest/#recreating-figure-2">this post</a>. Note here that <code>size=13/.pt</code> will use a 13 pt font and that <code>fontface="bold"</code> will make the font bold. <code>geom_richtext()</code> is very similar to <code>geom_text()</code> except that it will render the markdown code appropriately. By default <code>geom_richtext()</code> places a box around the text, which is removed with <code>label.color=NA</code>. The reservoir label and the regression statistics were placed on the plot separately because the authors used a larger font for the reservoir label.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>impd),</span>
<span id="cb20-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb20-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dlbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbls),</span>
<span id="cb20-8">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb20-9">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb20-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="further-thoughts" class="level1 page-columns page-full">
<h1>Further Thoughts</h1>
<section id="confidence-band" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="confidence-band">Confidence Band</h3>
<p>In the authors’ Figure 5 they included a confidence band around the fitted von Bertalanffy growth curve. They did not include a confidence band in their Figure 1. A confidence band can be added to Figure 1 by simply removing <code>se=FALSE</code> from <code>geom_smooth()</code>.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The default is <code>se=TRUE</code> which adds the confidence band.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>impd),</span>
<span id="cb21-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb21-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dlbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbls),</span>
<span id="cb21-8">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.pt,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb21-9">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb21-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-ci-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="information-label" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="information-label">Information Label</h3>
<p>The process of adding the reservoir name with the regression results above was hacky because the reservoir name was in a larger font then the regression results. This, can, however be solved more elegantly, but more verbosely, using HTML code in <code>geom_richtext()</code>.<sup>5</sup> Here, though, the reservoir label and the regression results need to be wrapped in paired <code>&lt;span&gt;</code> and <code>&lt;\span&gt;</code> couplets, with <code>&lt;span&gt;</code> including a <code>style=</code> that sets the font size as shown below.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Markdown is flexible enough to render HTML code appropriately.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milford"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lovewell"</span>)</span>
<span id="cb22-2">dlbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">impd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span>tmp),</span>
<span id="cb22-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbls=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;span style='font-size:13pt;'&gt;"</span>,tmp,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/span&gt;&lt;br&gt;"</span>,</span>
<span id="cb22-4">                                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;span style='font-size:10pt;'&gt;"</span>,ps,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb22-5">                                rs,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/span&gt;"</span>))</span>
<span id="cb22-6">dlbls</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        impd
#R|  1  Milford
#R|  2 Lovewell
#R|                                                                                                           lbls
#R|  1  &lt;span style='font-size:13pt;'&gt;Milford&lt;/span&gt;&lt;br&gt;&lt;span style='font-size:10pt;'&gt;p=0.007&lt;br&gt;r^2^=0.297&lt;/span&gt;
#R|  2 &lt;span style='font-size:13pt;'&gt;Lovewell&lt;/span&gt;&lt;br&gt;&lt;span style='font-size:10pt;'&gt;p&lt;0.001&lt;br&gt;r^2^=0.759&lt;/span&gt;</code></pre>
</div>
</div>
<p>With this new <code>dlbls</code> data frame, the <code>geom_text()</code> from above that put on the reservoir labels can be removed and, in <code>geom_richtext()</code>, the <code>size=</code> should be removed as the font size is set in <code>dlbls</code> and <code>vjust=</code> should be adjusted up a little bit.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>yr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>catch_m2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dlbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>lbls),</span>
<span id="cb24-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb24-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(impd),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Catch/m^2^"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb24-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/index_files/figure-html/make-fig1-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you know a little bit of markdown or HTML, then <code>ggtext</code> is a simple but powerful package for handling these kinds of issues. See more about <code>ggtext</code> <a href="https://wilkelab.org/ggtext/index.html">here</a>.</p>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-milleretal_2022" class="csl-entry">
Miller, B. T., E. Flores, D. S. Waters, and B. C. Neely. 2022. <a href="https://doi.org/10.3996/JFWM-21-090">An evaluation of <span>Goldeye</span> life history characteristics in two <span>Kansas</span> reservoirs</a>. Journal of Fish and Wildlife Management 13(1):243–249.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Miller Et Al. (2022) {CPE} {Plot}},
  date = {2023-03-29},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-29_Milleretal2022_Fig1},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 29. Miller et al. (2022) CPE Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-29_Milleretal2022_Fig1">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-29_Milleretal2022_Fig1</a>.
</div></div></section></div> ]]></description>
  <category>CPE</category>
  <category>Linear Regression</category>
  <category>Data Wrangling</category>
  <category>ggplot2</category>
  <category>line plot</category>
  <category>facets</category>
  <category>annotations</category>
  <category>labels</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/</guid>
  <pubDate>Wed, 29 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-29_Milleretal2022_Fig1/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>McCarrick et al. (2022) Back-Calculated TL Plots</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the fifth, and last, of several posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>. I thank the authors for making their data available with their publication.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> examined the population dynamics of Yellowstone Cutthroat Trout (<em>Oncorhynchus clarkii bouvieri</em>) in Henrys Lake, Idaho over a nearly two decade period. Their <a href="https://meridian.allenpress.com/view-large/figure/14538511/i1944-687X-13-1-169-f06.tif">Figure 6</a> showed the back-calculated total length of both Cutthroat Trout at three ages separated by decade and their <a href="https://meridian.allenpress.com/view-large/figure/14538512/i1944-687X-13-1-169-f07.tif">Figure 7</a> showed the mean (and SE) back-calculated TL at age for two time periods. I use <code>ggplot2</code> here to recreate both figures.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>readxl</code>, <code>FSA</code>, <code>scales</code>, and <code>lemon</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will see below that I could recreate the structure but not the exact results of the author’s Figure 6 or Figure 7. This may be due to issues present in the data provided with the publication that I discuss below, but it could also be that my data wrangling differs from theirs. I defer to the authors here as they are the experts with their data; I am just an interloper. I actually appreciate these data issues from an educational perspective as they provide rich opportunities to demonstrate a variety of techniques with “real” “messy” data.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<section id="reading-excel-file-and-handling-some-initial-issuees" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="reading-excel-file-and-handling-some-initial-issuees">Reading Excel File and Handling Some Initial Issuees</h3>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> provided raw data for these figures as an Excel file in their Data Supplement S2. An initial glance at the Excel file revealed that every other line in the file was essentially a header line for the annular measurements on the scales or otoliths.<sup>1</sup> Fortunately, when these data were read in below, those lines appeared as missing data for the age-at-capture variable (as well as several others). Thus, I immediately removed rows with missing values in the age-at-capture variable. The variable names in Excel were also longer than I prefer so I renamed the variables that I chose to retain.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;This was not immediately obvious in the Excel file as a filter had been applied to hide those rows. I had to remove the filter in Excel to see the issue.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Download.xlsx"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ID=</span>Fish_Number,Structure,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">capAge=</span>Age_at_Capture,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">capTL=</span>Total_Length_mm,</span>
<span id="cb2-3">         edge,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"annulus"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(capAge))</span>
<span id="cb2-5"></span>
<span id="cb2-6">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Year   ID Structure capAge capTL edge annulus1 annulus2 annulus3 annulus4
#R|  1    2020  143   Otolith      3   402  982      464      754      982       NA
#R|  2    2020  122   Otolith      2   266  692      428      692       NA       NA
#R|  3    2020 1599   Otolith      2   452  994      702      994       NA       NA
#R|  3257 1987   NA     Scale      2   240  435      155      352       NA       NA
#R|  3258 1987   NA     Scale      3   305  531      137      331      431       NA
#R|  3259 1987   NA     Scale      3   453  695      145      338      537       NA
#R|       annulus5 annulus6 annulus7 annulus8 annulus9 annulus10 annulus11
#R|  1          NA       NA       NA       NA       NA        NA        NA
#R|  2          NA       NA       NA       NA       NA        NA        NA
#R|  3          NA       NA       NA       NA       NA        NA        NA
#R|  3257       NA       NA       NA       NA       NA        NA        NA
#R|  3258       NA       NA       NA       NA       NA        NA        NA
#R|  3259       NA       NA       NA       NA       NA        NA        NA</code></pre>
</div>
</div>
<p>These data are in what I call “one-fish-per-line” format. This is the “tidy” format for performing analyses on a fish, but it is not in a “tidy” format for performing analyses on lengths at specific ages. This will become more evident in the following sections.</p>
<p>For consideration below, note that <code>Structure</code> contains only <code>Scale</code> and <code>Otolith</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Structure)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "Otolith" "Scale"</code></pre>
</div>
</div>
</section>
<section id="back-calculation" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="back-calculation">Back-Calculation</h3>
<p>The authors used the Dahl-Lea method of back-calculation for otoliths and the Fraser-Lee method for scales.<sup>2</sup> The length adjustment term in the Fraser-Lee method came from the intercept of the regression of length-at-capture on scale radius-at-capture. This regression is performed using the “per fish” data in <code>dat</code>, but filtered to only the data from scales. The intercept is extracted from the regression results and stored in <code>a</code> for use below.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;I assume the reader is familiar with back-calculation methods. If not <a href="https://fishr-core-team.github.io/RFishBC/articles/BCIntro.html">see here</a> or examine the methods in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">LonR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(capTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>edge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat,Structure<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scale"</span>))</span>
<span id="cb6-2">( a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(LonR)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Intercept)"</span>]] )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] 54.99758</code></pre>
</div>
</div>
<p>Back-calculating length at a previous age requires the data to be in a “one-annulus-per-line” format. For this purpose, the data in <code>dat</code> is considered “wide” (annuli are in multiple columns of each row) and need to be “pivoted” to “long” format with <code>pivot_longer()</code>. The columns that contain the annular measurements are given to <code>cols=</code>, <code>values_to=</code> gets a name for the column to contain these annular measurements, and <code>names_to=</code> gets a name for the column to contain the “label” for the annular measurements. The new <code>bcAge</code> variable (from <code>names_to=</code>) will contain the old columns names (i.e., “annulus 1”, “annulus 2”, etc.) by default. <code>names_prefix=</code> is used below to remove “annulus” from these labels and leave just the numeric age <em>labels</em> (e.g., “1”, “2”, etc.). The age “labels” are converted to numeric values with <code>as.numeric()</code> in <code>mutate()</code>. Finally, many rows in the new <code>Radius</code> variable will be missing because annular measurements were not made for ages older than the age-at-capture for the fish (e.g., <code>Radius</code> will be missing for all ages greater than 3 for an age-3 fish). These rows are removed with <code>filter()</code> below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span>annulus1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>annulus11,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Radius"</span>,</span>
<span id="cb8-3">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bcAge"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_prefix=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"annulus"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bcAge=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(bcAge)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Radius))</span>
<span id="cb8-6"></span>
<span id="cb8-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Year  ID Structure capAge capTL edge bcAge Radius
#R|  1    2020 143   Otolith      3   402  982     1    464
#R|  2    2020 143   Otolith      3   402  982     2    754
#R|  3    2020 143   Otolith      3   402  982     3    982
#R|  8754 1987  NA     Scale      3   453  695     1    145
#R|  8755 1987  NA     Scale      3   453  695     2    338
#R|  8756 1987  NA     Scale      3   453  695     3    537</code></pre>
</div>
</div>
<p>This data frame is now prepared to back-calculate lengths at previous ages from the measurements in <code>Radius</code>, the structure size-at-capture in <code>edge</code>, and the fish’s length at capture in <code>capTL</code>. This calculation is somewhat complicated by the fact that different back-calculation equations are used depending on the structure examined. This is handled below using <code>case_when()</code> within <code>mutate()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bcTL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb10-3">    Structure<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scale"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ((capTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>edge)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Radius<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>a,</span>
<span id="cb10-4">    Structure<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Otolith"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> capTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Radius<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>edge</span>
<span id="cb10-5">  ))</span>
<span id="cb10-6"></span>
<span id="cb10-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Year  ID Structure capAge capTL edge bcAge Radius     bcTL
#R|  1    2020 143   Otolith      3   402  982     1    464 189.9470
#R|  2    2020 143   Otolith      3   402  982     2    754 308.6640
#R|  3    2020 143   Otolith      3   402  982     3    982 402.0000
#R|  8754 1987  NA     Scale      3   453  695     1    145 138.0341
#R|  8755 1987  NA     Scale      3   453  695     2    338 248.5585
#R|  8756 1987  NA     Scale      3   453  695     3    537 362.5189</code></pre>
</div>
</div>
<p>At this point, I felt the need to see if these calculations “worked.” I made a plot of back-calculated length-at-age and noticed that most results were reasonable, but there were a handful of VERY large back-calculated lengths. This seemed like date error rather than systematic calculation error. I was further concerned that there may be errors of very low back-calculated lengths; thus, I used a log scale for the y-axis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>bcAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>bcTL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Structure)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_jitter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/index_files/figure-html/data-examine-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>The large back-calculated lengths were from four individual fish, three of which had lengths-at-capture that were clearly errors (i.e., <code>capTL</code> over 2000 mm). Additionally, at least two of the small back-calculated lengths were from errors in length-at-capture (i.e., <code>capTL</code> less that 50 mm). A few of the other problems appeared related to bad <code>edge</code> measurements.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(bcTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 13 × 9
#R|      Year    ID Structure capAge capTL  edge bcAge Radius  bcTL
#R|     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
#R|   1  2012  2055 Otolith        2  2778   665     1    394 1646.
#R|   2  2012  2055 Otolith        2  2778   665     2    665 2778 
#R|   3  2009   208 Otolith        3  3370   740     1    344 1567.
#R|   4  2009   208 Otolith        3  3370   740     2    547 2491.
#R|   5  2009   208 Otolith        3  3370   740     3    740 3370 
#R|   6  2008    69 Otolith        4  4692   925     1    352 1785.
#R|   7  2008    69 Otolith        4  4692   925     2    531 2693.
#R|   8  2008    69 Otolith        4  4692   925     3    726 3683.
#R|   9  2008    69 Otolith        4  4692   925     4    925 4692 
#R|  10  2004  1098 Otolith        4   460   100     1    333 1532.
#R|  11  2004  1098 Otolith        4   460   100     2    619 2847.
#R|  12  2004  1098 Otolith        4   460   100     3    811 3731.
#R|  13  2004  1098 Otolith        4   460   100     4   1000 4600</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(bcTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 10 × 9
#R|      Year    ID Structure capAge capTL  edge bcAge Radius  bcTL
#R|     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
#R|   1  2014    19 Otolith        2   145   610     1    313 74.4 
#R|   2  2008   257 Otolith        2    15   667     1    321  7.22
#R|   3  2008   257 Otolith        2    15   667     2    667 15   
#R|   4  2006   149 Otolith        3    43   938     1    363 16.6 
#R|   5  2006   149 Otolith        3    43   938     2    636 29.2 
#R|   6  2006   149 Otolith        3    43   938     3    938 43   
#R|   7  2007   319 Otolith        2   302  7110     1    374 15.9 
#R|   8  2007   319 Otolith        2   302  7110     2    710 30.2 
#R|   9  2004   135 Otolith        3   160   986     1    482 78.2 
#R|  10  2004   218 Otolith        3   190   841     1    305 68.9</code></pre>
</div>
</div>
<p>I examined the length-at-capture and radius-at-capture data more closely.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>capTL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb17-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## &lt;100 and &gt;1000 seem to be errors</span></span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>edge)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb17-11"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## &lt;200? and &gt;1500 seem to be errors</span></span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/index_files/figure-html/data-examine-3a-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>From this analysis, it seems that lengths-at-capture less than 100 mm and greater than 1000 mm are data errors. In addition, it seems that edge measurements of less than 200 and greater than 1500 are also data errors. If I had access to the original records, I would attempt to determine if these are data entry errors and fix them. I don’t have that access, so I deleted fish with these measurements from the <code>dat</code> data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(capTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,capTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(edge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,edge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>)</span></code></pre></div>
</div>
<p>Because the original <code>dat</code> data frame has now been altered, the regression and creation of <code>dat2</code> above needed to be repeated before continuing. <strong>I did not show the repeated code here.</strong></p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       Year  ID Structure capAge capTL edge bcAge Radius     bcTL
#R|  1    2020 143   Otolith      3   402  982     1    464 189.9470
#R|  2    2020 143   Otolith      3   402  982     2    754 308.6640
#R|  3    2020 143   Otolith      3   402  982     3    982 402.0000
#R|  8732 1987  NA     Scale      3   453  695     1    145 139.1931
#R|  8733 1987  NA     Scale      3   453  695     2    338 249.3108
#R|  8734 1987  NA     Scale      3   453  695     3    537 362.8518</code></pre>
</div>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-6" class="level1">
<h1>Recreating Figure 6</h1>
<p>A decade variable is added to <code>dat2</code> and the data was reduced to only age-2 to age-4 fish, as those were the only ages used in Figure 6.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Decade=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(Year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb20-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Decade=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(Decade<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>,Decade),</span>
<span id="cb20-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Decade=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Decade)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(bcAge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,bcAge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
</div>
<p>Figure 6 is a boxplot that can be produced with <code>geom_boxplot()</code>, with <code>Decade</code> mapped to the x-axis and <code>bcTL</code> mapped to the y-axis. Note that the x-axis variables should not be numeric, which is why <code>Decade</code> was converted to a factor above. Because of this, the x-axis is modified with <code>scale_x_discrete()</code> rather than <code>scale_x_continuous()</code>. The rest of functions used here were described in the previous posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Decade,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>bcTL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,bcAge)),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb21-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Back-calculated length (mm)"</span>,</span>
<span id="cb21-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb21-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Decade"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-9">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(bcAge),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/index_files/figure-html/make-fig6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-7" class="level1 page-columns page-full">
<h1>Recreating Figure 7</h1>
<p>Figure 7 is a bar chart based on summarized data, which needs to be constructed from <code>dat2</code>. Below, <code>dat2</code> is restricted to only otoliths, the two periods shown in Figure 7 are created and converted to a factor, and then the sample size and the mean and standard error of back-calculated total lengths are calculated by age for each period. <code>.drop=FALSE</code> is used in <code>group_by()</code> so that the same number of ages will be shown for both periods, though both periods don’t have the same range of ages.<sup>3</sup> This will make the bars in the plot before appear in their proper locations even if a result is missing for the other period.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;So, some ages will have <code>NA</code> for the mean and SE.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">dat4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Structure<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Otolith"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Period=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(Year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2002-2010"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-2020"</span>),</span>
<span id="cb22-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Period=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Period,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2002-2010"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-2020"</span>)),</span>
<span id="cb22-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bcAge=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(bcAge)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Period,bcAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.drop=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb22-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnTL=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(bcTL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb22-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seTL=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">se</span>(bcTL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb22-11">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat4)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        Period bcAge    n     mnTL       seTL
#R|  1  2002-2010     1 1190 174.2867  0.9124273
#R|  2  2002-2010     2 1048 302.2455  1.2765006
#R|  3  2002-2010     3  455 405.1318  2.2456338
#R|  20 2011-2020     9    4 498.3248 29.0737028
#R|  21 2011-2020    10    4 534.1058 26.7635020
#R|  22 2011-2020    11    1 524.0000         NA</code></pre>
</div>
</div>
<p>These summary data are then ready to make a bar chart, very similar to what was done in <a href="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/#recreating-figure-4">this post</a>. Note here, though, that the width of the bars (in <code>geom_col()</code>) was reduced to create more room between the bars at each age. The <code>width=</code> of dodging in <code>position_dodge()</code> had to then be reduced a commensurate amount so that the bars at each age would touch. Finally, <code>legend.key.width=</code> and <code>legend.key.height=</code> were used in <code>theme()</code> to make the elongated “keys” in the legend as was done in Figure 7.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">pd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>dat4,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>bcAge,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mnTL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Period)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>mnTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>seTL,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>mnTL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>seTL),</span>
<span id="cb24-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean back-calculated length (mm)"</span>,</span>
<span id="cb24-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb24-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2002-2010"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-2020"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb24-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>),</span>
<span id="cb24-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb24-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.width=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>),</span>
<span id="cb24-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.height=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>),</span>
<span id="cb24-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/index_files/figure-html/make-fig7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>I am not a fan of showing “error bars” that are only one SE. This is akin to showing a 68% confidence interval, which is not something that someone would usually do. I did that here because that is what was done in the published Figure 7, but I urge you not to do this … show a proper confidence interval instead.</p>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-mccarricketal_2022" class="csl-entry">
McCarrick, D. K., J. C. Dillon, B. High, and M. C. Quist. 2022. <a href="https://doi.org/10.3996/JFWM-21-074">Population dynamics of <span>Yellowstone Cutthroat Trout</span> in <span>Henrys Lake</span>, <span>Idaho</span></a>. Journal of Fish and Wildlife Management 13(1):169–181.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {McCarrick Et Al. (2022) {Back-Calculated} {TL} {Plots}},
  date = {2023-03-28},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-28_McCarricketal2022_Fig6},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 28. McCarrick et al. (2022) Back-Calculated TL
Plots. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-28_McCarricketal2022_Fig6">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-28_McCarricketal2022_Fig6</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>box plot</category>
  <category>bar chart</category>
  <category>facets</category>
  <category>Data Wrangling</category>
  <category>Growth</category>
  <category>Back-calculation</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/</guid>
  <pubDate>Tue, 28 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-28_McCarricketal2022_Fig6/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>McCarrick et al. (2022) Age Composition Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the fourth of several posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> examined the population dynamics of Yellowstone Cutthroat Trout (<em>Oncorhynchus clarkii bouvieri</em>) in Henrys Lake, Idaho over a nearly two decade period. Their <a href="https://meridian.allenpress.com/view-large/figure/14538510/i1944-687X-13-1-169-f05.tif">Figure 5</a> showed the relative age composition of Cutthroat Trout across years. I use <code>ggplot2</code> to recreate that figure here.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>FSA</code>, <code>plyr</code>, <code>lemon</code>, and <code>forcats</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> provided raw data for Figure 2 in a MSWord table as a supplement. I copied the table from Word, pasted it into Excel, and saved it for loading here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT_AgeComp.xlsx"</span>)</span>
<span id="cb2-2">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 19 × 12
#R|      Year `Age 1` `Age 2` `Age 3` `Age 4` `Age 5` `Age 6` `Age 7` `Age 8` `Age 9`
#R|     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
#R|   1  2002   0.113   0.46    0.394   0.034   0       0       0       0       0    
#R|   2  2003   0.207   0.207   0.194   0.289   0.058   0.025   0       0       0.019
#R|   3  2004   0.39    0.472   0.084   0.034   0.003   0.007   0.007   0.003   0    
#R|   4  2005   0.368   0.527   0.078   0.015   0.013   0       0       0       0    
#R|   5  2006   0.091   0.276   0.52    0.107   0.002   0.004   0       0       0    
#R|   6  2007   0.025   0.708   0.13    0.128   0.009   0       0       0       0    
#R|   7  2008   0       0.536   0.298   0.146   0.021   0       0       0       0    
#R|   8  2009   0.051   0.27    0.502   0.177   0       0       0       0       0    
#R|   9  2010   0.028   0.753   0.092   0.116   0.008   0.003   0       0       0    
#R|  10  2011   0.003   0.774   0.187   0.029   0.005   0.003   0       0       0    
#R|  11  2012   0.017   0.594   0.348   0.029   0.004   0.006   0       0       0    
#R|  12  2013   0.004   0.61    0.22    0.14    0.02    0.002   0.004   0       0    
#R|  13  2014   0.007   0.353   0.437   0.136   0.05    0.013   0.002   0.002   0    
#R|  14  2015   0.021   0.399   0.239   0.271   0.031   0.04    0       0       0    
#R|  15  2016   0       0.594   0.238   0.082   0.053   0.033   0       0       0    
#R|  16  2017   0.02    0.518   0.197   0.197   0.027   0.035   0       0.007   0    
#R|  17  2018   0.053   0.137   0.505   0.148   0.101   0.013   0.031   0.013   0    
#R|  18  2019   0.013   0.765   0.127   0.037   0.027   0.014   0.004   0.013   0    
#R|  19  2020   0.005   0.206   0.677   0.096   0.003   0.005   0.005   0.002   0    
#R|  # … with 2 more variables: `Age 10` &lt;dbl&gt;, `Age 11` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The data were provided in a wide format that needs to be “tidied” to a long format with the proportions at age in the <code>Age X</code> columns stacked on top of each other with a corresponding variable that indicates the age. Note that the columns to pivot in <code>cols=</code> were selected by ignoring <code>year</code> and, thus, leaving all of the <code>Age X</code> columns.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;The columns also could have been selected with <code>starts_with("Age")</code>, among other possibilities.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>)</span>
<span id="cb4-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Year    Age Proportion
#R|  1   2002  Age 1      0.113
#R|  2   2002  Age 2      0.460
#R|  3   2002  Age 3      0.394
#R|  207 2020  Age 9      0.000
#R|  208 2020 Age 10      0.001
#R|  209 2020 Age 11      0.000</code></pre>
</div>
</div>
<p>The <code>Age</code> variable should be converted to a factor so that the levels can be controlled, otherwise “Age 10” will follow “Age 1”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 6"</span>,</span>
<span id="cb6-3">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 11"</span>)))</span></code></pre></div>
</div>
<p>This data frame is ready for recreating Figure 5.</p>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-5" class="level1 page-columns page-full">
<h1>Recreating Figure 5</h1>
<p>Figure 5 is an “area plot” which is easily constructed in <code>ggplot2</code> with <code>geom_area()</code>, with the variable that defines the colored areas (i.e., <code>Age</code>) mapped to <code>fill=</code>.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;I plotted every other on the x-axis as the font needed to be so small to show every year at in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb7-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb7-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>I won’t address color here (but see further below) as these colors are no uglier than what is shown in the published Figure 5. However, there are other adjustments that need to be made to match Figure 5.</p>
<p>First, the ages above are stacked opposite of what is in Figure 5; i.e., age-1 is at the top, age-2 below that, etc. rather than age-1 at the bottom, age-2 on top of that, etc. The order of stacking is reversed with <code>position=</code> in <code>geom_area()</code> as shown below. Second, the authors included two digits for the values on the y-axis for some reason. Assuming this behavior is desired it can be obtained with <code>scales::label_number()</code> in <code>scale_y_continuous()</code> as shown below.<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;This was demonstrated in <a href="../2023-3-15-Axis_Magic/#numeric-label-format">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb8-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb8-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb8-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Third, the legend needs to be moved to below the x-axis. This is easily accomplished with <code>legend.position="bottom"</code> in <code>theme()</code>. However, doing this alone shows the legend in three rows. One row was used for the legend as shown below with <code>guides()</code>. Finally, other theme options were altered to remove the legend title and make the legend symbols and text smaller.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb9-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb9-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb9-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb9-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>),</span>
<span id="cb9-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>This largely recreates Figure 5 in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
<p>&nbsp;</p>
</section>
<section id="possible-modifications" class="level1 page-columns page-full">
<h1>Possible Modifications</h1>
<p>Area plots are notorious for being difficult for readers to interpret.<sup>4</sup> Below I offer some modifications that may(?) aid interpretation.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;See <a href="https://leancrew.com/all-this/2011/11/i-hate-stacked-area-charts/">this</a> for example.</p></div></div><section id="lump-ages" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="lump-ages">Lump Ages</h3>
<p>Many potential ages are shown in Figure 5 though ages greater than age-5 are rarely visible (or noticeable) as they never represent more than 10% in total or 4% individually of the fish in any given year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find maximum proportion by age, is that more than 5%</span></span>
<span id="cb10-2">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxP=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Proportion))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 11 × 2
#R|     Age     maxP
#R|     &lt;fct&gt;  &lt;dbl&gt;
#R|   1 Age 1  0.39 
#R|   2 Age 2  0.774
#R|   3 Age 3  0.677
#R|   4 Age 4  0.289
#R|   5 Age 5  0.101
#R|   6 Age 6  0.04 
#R|   7 Age 7  0.031
#R|   8 Age 8  0.013
#R|   9 Age 9  0.019
#R|  10 Age 10 0.002
#R|  11 Age 11 0.001</code></pre>
</div>
</div>
<p>The number of colors used in the plot, and the number of areas that the reader looks for, can be reduced by lumping together ages that are not well-represented in the data. Below <code>fct_collapse()</code> from <code>forcats</code> is used to collapse the “Age 6” to “Age 11” levels in <code>Age</code> to one level called “Age 6+”. To preserve the original data this data frame was called <code>dat2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age=</span>forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_collapse</span>(Age,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age 6+</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 8"</span>,</span>
<span id="cb12-3">                                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age 11"</span>)))</span>
<span id="cb12-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Year    Age Proportion
#R|  1   2002  Age 1      0.113
#R|  2   2002  Age 2      0.460
#R|  3   2002  Age 3      0.394
#R|  207 2020 Age 6+      0.000
#R|  208 2020 Age 6+      0.001
#R|  209 2020 Age 6+      0.000</code></pre>
</div>
</div>
<p>However, “Age 6+” was simply repeated for the original “Age 6”, “Age 7”, etc. The proportions for these ages should be summed, within each year, to get a proper proportion of “Age 6+” fish.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Summing the proportions for the ages that were lumped will just return the proportion for those ages.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Year,Age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Proportion=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Proportion)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb14-5">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      Year    Age Proportion
#R|  1   2002  Age 1      0.113
#R|  2   2002  Age 2      0.460
#R|  3   2002  Age 3      0.394
#R|  112 2020  Age 4      0.096
#R|  113 2020  Age 5      0.003
#R|  114 2020 Age 6+      0.013</code></pre>
</div>
</div>
<p>To save some typing below, I set the theme to the theme items above with the exception that I moved the legend back to the right where I think it is more appropriate.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(</span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>),</span>
<span id="cb16-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb16-7">)</span></code></pre></div>
</div>
<p>The code for Figure 5 is largely repeated below with these data. However, I reversed the order of the labels in the legend with <code>guides()</code> so that the labels more naturally followed how the areas were plotted and I removed the unnecessary extra digit in the y-axis labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb17-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb17-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="color" class="level3">
<h3 class="anchored" data-anchor-id="color">Color</h3>
<p>Changing the color is not necessarily going to make the figure easier to interpret. However, a gradient of color can be used to more clearly represent the gradient of age. Here, I form a gradient of grays with <code>scale_fill_grey()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb18-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb18-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_grey</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>A sequential palette that ranges from dark green to light blue is used below with <code>scale_fill_brewer()</code>. A variety of palettes may be chosen in this function as described in its documentation. Note that <code>direction=-1</code> was used here to reverse the palette order as I preferred the darker colors for age-1 and the lighter colors for age-6+.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb19-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb19-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BuGn"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>Other palette algorithms can also be used. Below, <code>scale_fill_viridis_d()</code> is used as an example.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is both an art and a science behind choosing colors for plots. Unfortunately, I am not strong nor fully knowledgeable in either. Thus, I show how to alter colors here, but I don’t claim that these choices are ideal.</p>
</div>
</div>
</section>
<section id="add-lines" class="level3">
<h3 class="anchored" data-anchor-id="add-lines">Add Lines</h3>
<p>I sometimes feel that the colors in area plots “run together” in my eyes. One way to make more clear “breaks” is to highlight the color changes. Below I also map <code>Age</code> to <code>color=</code>, use <code>scale_color_viridis_d()</code> with the same options as <code>scale_fill_viridis_d()</code>, except that for the fill I set a slight transparency with <code>alpha=</code>. Here <code>color=</code> is used for the boundaries of the areas and since the fill was made transparent these boundaries are a bit darker and, thus, appear as lines between the areas. Further note that both <code>fill=</code> and <code>color=</code> had to be “reversed” in <code>guides()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb21-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb21-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb21-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bar-chart" class="level3">
<h3 class="anchored" data-anchor-id="bar-chart">Bar Chart</h3>
<p>Most people that eschew the use of area plots suggests using bar charts instead. This is easily accomplished here by replacing <code>geom_area()</code> with <code>geom_col()</code>. However, the limits of the x-axis will need to be extended by one year on both sides so that the first and last year will be shown correctly.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_stack</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb22-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb22-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="facets" class="level3">
<h3 class="anchored" data-anchor-id="facets">Facets</h3>
<p>Finally, I think that if the goal is to show annular trends for the specific ages, that they should be plotted as lines for each age. Here lines are used with <code>geom_line()</code> and faceting was used on <code>Age</code>. The use of color is superfluous here, but I kept it for comparing with the previous options.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Proportion,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>)),</span>
<span id="cb23-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb23-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Age),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/index_files/figure-html/make-fig5-alt7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>In my view, it is much easier to decipher what is going on with age-2 to age-4 fish from this plot.</p>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-mccarricketal_2022" class="csl-entry">
McCarrick, D. K., J. C. Dillon, B. High, and M. C. Quist. 2022. <a href="https://doi.org/10.3996/JFWM-21-074">Population dynamics of <span>Yellowstone Cutthroat Trout</span> in <span>Henrys Lake</span>, <span>Idaho</span></a>. Journal of Fish and Wildlife Management 13(1):169–181.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {McCarrick Et Al. (2022) {Age} {Composition} {Plot}},
  date = {2023-03-27},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-27_McCarricketal2022_Fig5},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 27. McCarrick et al. (2022) Age Composition
Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-27_McCarricketal2022_Fig5">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-27_McCarricketal2022_Fig5</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>area chart</category>
  <category>bar chart</category>
  <category>facets</category>
  <category>color</category>
  <category>Data Wrangling</category>
  <category>Age</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/</guid>
  <pubDate>Mon, 27 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-27_McCarricketal2022_Fig5/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>McCarrick et al. (2022) Wr Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the third of several posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
</div>
</div>
<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> examined the population dynamics of Yellowstone Cutthroat Trout (<em>Oncorhynchus clarkii bouvieri</em>) in Henrys Lake, Idaho over a nearly two decade period. Their <a href="https://meridian.allenpress.com/view-large/figure/14538508/i1944-687X-13-1-169-f04.tif">Figure 4</a> showed mean (with confidence interval) relative weight (Wr) for various length categories of Cutthroat Trout across years. I use <code>ggplot2</code> to recreate that figure here.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>lubridate</code>, <code>FSA</code>, <code>plyr</code>, <code>scales</code>, <code>gghrx</code>, <code>lemon</code>, and <code>ggtext</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> computed what I am calling an overall PSD<sup>1</sup> and what are called “incremental” PSD indices. I assume that these are familar to most fisheries scientists, but they are described in more detail in Chapter 8 of <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span>.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;This is the most common PSD measure.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Also see <span class="citation" data-cites="blackwelletal_2000">Blackwell et al. (2000)</span>.</p></div></div><p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<section id="individual-fish-data-frame" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="individual-fish-data-frame">Individual Fish Data Frame</h3>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> provided raw data for Figure 2 as an Excel file in their Data Supplement S1. The same data wrangling, up to where catch-per-unit-effort was calculated, used in <a href="../2023-3-22_McCarricketal2022_Fig2/#data-wrangling">this previous post</a> is used here<sup>3</sup> and, thus, will not be discussed in detail.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;And in <a href="../2023-3-25_McCarricketal2022_Fig3/">this post</a></p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../2023-3-22_McCarricketal2022_Fig2/download.xlsx"</span>,</span>
<span id="cb2-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"??"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY ="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UNK"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NO TAG"</span>),</span>
<span id="cb2-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb2-4">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span>lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(Date),</span>
<span id="cb2-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1905</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>Species,year,length,weight)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-10">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yct"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,</span>
<span id="cb2-11">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHB"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHUB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,</span>
<span id="cb2-12">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> species</span>
<span id="cb2-13">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species2=</span>plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapvalues</span>(species,</span>
<span id="cb2-16">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>),</span>
<span id="cb2-17">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cutthroat Trout"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Utah Chub"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gcat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">psdAdd</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">len=</span>length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>species2))</span>
<span id="cb2-19"></span>
<span id="cb2-20">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        species year length weight        species2     gcat
#R|  1         YCT 2002    150     NA Cutthroat Trout substock
#R|  2         YCT 2002    160     NA Cutthroat Trout substock
#R|  3         YCT 2002    160     NA Cutthroat Trout substock
#R|  19900     YCT 2020    391    550 Cutthroat Trout  quality
#R|  19901     YCT 2020    284    229 Cutthroat Trout    stock
#R|  19902     YCT 2020    440    853 Cutthroat Trout  quality</code></pre>
</div>
</div>
<p>The relative weigt for each fish needs to be added to this data frame, preferably with <code>wrAdd()</code> from <code>FSA</code>. Note, however, that there are two standard weight equations for Cutthroat Trout, one for lentic and one for lotic populations. We want to make sure to use the one for lentic populations here and, thus, cannot use the species name found in the data frame within <code>wrAdd()</code>. Note below that the data frame was also reduced to just Cutthroat Trout for which a weight was recorded, and the two species variables were dropped (just to simplify the output).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(species<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(weight)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wr=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wrAdd</span>(weight,length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spec=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cutthroat Trout (lentic)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>))</span>
<span id="cb4-5">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|       year length weight     gcat        wr
#R|  1    2004    174     54 substock 102.34315
#R|  2    2004    227    130    stock 108.45450
#R|  3    2004    305    380    stock 127.41903
#R|  5208 2020    391    550  quality  85.68508
#R|  5209 2020    284    229    stock  95.69629
#R|  5210 2020    440    853  quality  92.31113</code></pre>
</div>
</div>
</section>
<section id="wr-summary-data-frame" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="wr-summary-data-frame">Wr Summary Data Frame</h3>
<p>Summary statistics of relative weight for all fish is computed below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">wr_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb6-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mn_wr=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb6-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd_wr=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb6-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se_wr=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">se</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb6-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wr_all)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year   n     mn_wr     sd_wr     se_wr
#R|  1  2004 300 116.50388 16.405045 0.9650026
#R|  2  2005 305 103.70058 14.860984 0.8509375
#R|  3  2006 269 107.66011 20.258635 1.2351908
#R|  15 2018  76 107.05779 25.899713 2.9709008
#R|  16 2019 219  97.20635  7.485436 0.5058189
#R|  17 2020 198  94.78333  8.648857 0.6146475</code></pre>
</div>
</div>
<p>Summary statistics of relative weight for each length category is computed below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">wr_gcat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year,gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb8-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mn_wr=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb8-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd_wr=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb8-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se_wr=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">se</span>(wr,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb8-8">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wr_gcat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year      gcat   n     mn_wr     sd_wr     se_wr
#R|  1  2004  substock 110 103.54857 13.477955 1.3545854
#R|  2  2004     stock 130 123.09751 11.535665 1.0117447
#R|  3  2004   quality  34 127.50055 12.158543 2.0851728
#R|  68 2020     stock  52  95.40331 10.326851 1.4320766
#R|  69 2020   quality 132  94.78427  8.119609 0.7067213
#R|  70 2020 preferred  13  92.28008  6.826683 1.8933812</code></pre>
</div>
</div>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> only plotted fish in the “stock”, “quality”, and “preferred” length categories in Figure 4; thus, only these length categories are retained below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">wr_gcat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wr_gcat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gcat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stock"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quality"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferred"</span>))</span></code></pre></div>
</div>
<p>The summaries for all fish and fish by length categories are row-bound (i.e., stacked) together to form an overall summary data frame. Because the data frame for all fish did not have a <code>gcat</code> variable, that variable will be populated with <code>NA</code> when the two data frames are bound. The <code>ifelse()</code> below converts these <code>NA</code> values to <code>All</code>, before <code>gcat</code> is factored with levels ordered as they would appear in Figure 4 and with more descriptive labels. Finally, for aesthetic purposes, I moved <code>gcat</code> to be the first variable and sorted the results by year within length category.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">wr_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(wr_all,wr_gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gcat=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(gcat),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(gcat)),</span>
<span id="cb11-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gcat=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(gcat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stock"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quality"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferred"</span>),</span>
<span id="cb11-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All fish"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stock to Quality"</span>,</span>
<span id="cb11-5">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quality to Preferred"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preferred to Memorable"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(gcat,year)</span>
<span id="cb11-8">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wr_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                       gcat year   n     mn_wr     sd_wr     se_wr
#R|  1                All fish 2004 300 116.50388 16.405045 0.9650026
#R|  2                All fish 2005 305 103.70058 14.860984 0.8509375
#R|  3                All fish 2006 269 107.66011 20.258635 1.2351908
#R|  66 Preferred to Memorable 2018  22  98.79180 17.476556 3.7260144
#R|  67 Preferred to Memorable 2019  17  98.61326  8.666677 2.1019780
#R|  68 Preferred to Memorable 2020  13  92.28008  6.826683 1.8933812</code></pre>
</div>
</div>
<p>Finally, the lower and upper confidence intervals for each mean are added to the data frame using normal distribution theory.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;<code>qt()</code> returns a the 97.5th percent critical value from a t-distribution with <code>df</code> degrees-of-freedom.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">wr_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wr_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lci=</span>mn_wr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qt</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span>n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>se_wr,</span>
<span id="cb13-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uci=</span>mn_wr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qt</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span>n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>se_wr)</span>
<span id="cb13-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(wr_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|                       gcat year   n     mn_wr     sd_wr     se_wr       lci
#R|  1                All fish 2004 300 116.50388 16.405045 0.9650026 114.60482
#R|  2                All fish 2005 305 103.70058 14.860984 0.8509375 102.02610
#R|  3                All fish 2006 269 107.66011 20.258635 1.2351908 105.22820
#R|  66 Preferred to Memorable 2018  22  98.79180 17.476556 3.7260144  91.04313
#R|  67 Preferred to Memorable 2019  17  98.61326  8.666677 2.1019780  94.15727
#R|  68 Preferred to Memorable 2020  13  92.28008  6.826683 1.8933812  88.15476
#R|          uci
#R|  1  118.4029
#R|  2  105.3750
#R|  3  110.0920
#R|  66 106.5405
#R|  67 103.0693
#R|  68  96.4054</code></pre>
</div>
</div>
<p>This data frame, now called <code>wr_dat</code>, is ready for recreating Figure 4.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-4" class="level1 page-columns page-full">
<h1>Recreating Figure 4</h1>
<p>Figure 4 is a simple bar plot facetted across years similar to the PSD plot in <a href="../2023-3-25_McCarricketal2022_Fig3/#recreating-figure-3">this previous post</a>. Confidence intervals are added as described in <a href="../2023-3-25_McCarricketal2022_Fig3/#adding-confidence-intervals">that same post</a>. Thus, many of the details below are not discussed further here. However, there are two new things to consider here.</p>
<p>First, the y-axis in Figure 4 in <span class="citation" data-cites="mccarricketal_2020">(<strong>mccarricketal_2020?</strong>)</span> is limited from 70 to 140. If <code>limits=c(70,140)</code> is used in <code>scale_y_continuous()</code> as described in <a href="">this post</a> the bars will be removed because their “data” extends to zero.<sup>5</sup> Thus, the limits of the y-axis must be set with <code>ylim=</code> in <code>coord_cartesian()</code> to preserved the bars.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Data points outside axis limits created in this way are treated as missing and are removed from the figure.</p></div></div><p>Second, the y-axis label in Figure 4 in <span class="citation" data-cites="mccaricketal_2020">(<strong>mccaricketal_2020?</strong>)</span> is italicized with a subscript “r”. In the markdown language, asterisks are used to denoted italics and the tilde is used to create a subscript, which can be seen in <code>name=</code> in <code>scale_y_continuous()</code>. However, to make this markdown code render properly <code>axis.title.y=</code> in <code>theme</code> must be set to <code>element_markdown()</code> from <code>ggtext</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>wr_dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mn_wr)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>lci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>uci),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>gcat),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb15-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*W~r~*"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb15-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb15-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb15-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-12">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gcat),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb15-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb15-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb15-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/index_files/figure-html/make-fig4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="further-thoughts" class="level1">
<h1>Further Thoughts</h1>
<section id="point-and-lines-plot" class="level3">
<h3 class="anchored" data-anchor-id="point-and-lines-plot">Point-and-Lines Plot</h3>
<p>As mentioned in <a href="../2023-3-25_McCarricketal2022_Fig3/#further-thoughts">this previous post</a> I understand that these are the much derided <a href="https://simplystatistics.org/posts/2019-02-21-dynamite-plots-must-die/">“dynamite plots”</a>. Personally, I find the bars distracting (so much gray with little purpose and starting at 70) and find a point-and-lines plot, possibly with a horizontal line at the common reference value of 100.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>wr_dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>mn_wr)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>lci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>uci),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>gcat),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb16-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*W~r~*"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb16-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb16-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb16-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-13">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gcat),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span>ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/index_files/figure-html/make-fig4-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-blackwelletal_2000" class="csl-entry">
Blackwell, B., M. Brown, and D. Willis. 2000. <a href="https://doi.org/10.1080/10641260091129161">Relative <span>Weight</span> (<span>Wr</span>) <span>Status</span> and <span>Current Use</span> in <span>Fisheries Assessment</span> and <span>Management</span></a>. Reviews in Fisheries Science 8:1–44.
</div>
<div id="ref-mccarricketal_2022" class="csl-entry">
McCarrick, D. K., J. C. Dillon, B. High, and M. C. Quist. 2022. <a href="https://doi.org/10.3996/JFWM-21-074">Population dynamics of <span>Yellowstone Cutthroat Trout</span> in <span>Henrys Lake</span>, <span>Idaho</span></a>. Journal of Fish and Wildlife Management 13(1):169–181.
</div>
<div id="ref-ogleIntroductoryFisheriesAnalyses2016" class="csl-entry">
Ogle, D. H. 2016. <a href="http://derekogle.com/IFAR/">Introductory <span>Fisheries Analyses</span> with <span>R</span></a>. <span>CRC Press</span>, <span>Boca Raton, FL</span>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {McCarrick Et Al. (2022) {Wr} {Plot}},
  date = {2023-03-26},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-26_McCarricketal2022_Fig4},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 26. McCarrick et al. (2022) Wr Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-26_McCarricketal2022_Fig4">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-26_McCarricketal2022_Fig4</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>bar chart</category>
  <category>facets</category>
  <category>axes</category>
  <category>confidence intervals</category>
  <category>Data Wrangling</category>
  <category>Relative Weight</category>
  <category>Condition</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/</guid>
  <pubDate>Sun, 26 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-26_McCarricketal2022_Fig4/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>McCarrick et al. (2022) PSD Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the second of several posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
</div>
</div>
<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> examined the population dynamics of Yellowstone Cutthroat Trout (<em>Oncorhynchus clarkii bouvieri</em>) in Henrys Lake, Idaho over a nearly two decade period. Their <a href="https://meridian.allenpress.com/view-large/figure/14538507/i1944-687X-13-1-169-f03.tif">Figure 3</a> showed various proportional stock distribution (PSD) calculations of Cutthroat Trout across years. I use <code>ggplot2</code> to recreate that figure here. I also modified their plot by adding confidence intervals to the calculations.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>lubridate</code>, <code>FSA</code>, <code>plyr</code>, <code>tidyr</code>, <code>scales</code>, <code>gghrx</code>, and <code>lemon</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span></code></pre></div>
</div>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> computed what I am calling an overall PSD<sup>1</sup> and what are called “incremental” PSD indices. I assume that these are familar to most fisheries scientists, but they are described in more detail in Chapter 6 of <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span>.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;This is the most common PSD measure.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;<a href="https://ppp.purdue.edu/wp-content/uploads/2020/05/PPP-132.pdf">This</a> provides a decent description of the overall PSD.</p></div></div><p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<section id="individual-fish-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="individual-fish-data-frame">Individual Fish Data Frame</h3>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> provided raw data for Figure 2 as an Excel file in their Data Supplement S1. The same data wrangling, up to where catch-per-unit-effort was calculated, used in <a href="../2023-3-22_McCarricketal2022_Fig2/#data-wrangling">this previous post</a> is used here and, thus, will not be discussed in detail.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../2023-3-22_McCarricketal2022_Fig2/download.xlsx"</span>,</span>
<span id="cb2-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"??"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY ="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UNK"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NO TAG"</span>),</span>
<span id="cb2-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb2-4">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span>lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(Date),</span>
<span id="cb2-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1905</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>Species,year,length,weight)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-10">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yct"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,</span>
<span id="cb2-11">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHB"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHUB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,</span>
<span id="cb2-12">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> species</span>
<span id="cb2-13">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species2=</span>plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapvalues</span>(species,</span>
<span id="cb2-16">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>),</span>
<span id="cb2-17">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cutthroat Trout"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Utah Chub"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gcat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">psdAdd</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">len=</span>length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>species2))</span>
<span id="cb2-19"></span>
<span id="cb2-20">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        species year length weight        species2     gcat
#R|  1         YCT 2002    150     NA Cutthroat Trout substock
#R|  2         YCT 2002    160     NA Cutthroat Trout substock
#R|  3         YCT 2002    160     NA Cutthroat Trout substock
#R|  19900     YCT 2020    391    550 Cutthroat Trout  quality
#R|  19901     YCT 2020    284    229 Cutthroat Trout    stock
#R|  19902     YCT 2020    440    853 Cutthroat Trout  quality</code></pre>
</div>
</div>
</section>
<section id="psd-summary-data-frame" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="psd-summary-data-frame">PSD Summary Data Frame</h3>
<p>The data frame was filtered to only Cutthroat Trout (the only species shown in Figure 3) and sub-stock-sized fish were removed (PSD calculations do not consider sub-stock-sized fish).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">psd_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(species<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,gcat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"substock"</span>)</span></code></pre></div>
</div>
<p>The calculation of PSD values begins by counting the number of fish in each of the remaining Gabelhouse length categories, within each year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">psd_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year,gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb5-5">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year      gcat count
#R|  1  2002     stock    20
#R|  2  2002   quality    28
#R|  3  2002 preferred     1
#R|  61 2020     stock    52
#R|  62 2020   quality   132
#R|  63 2020 preferred    13</code></pre>
</div>
</div>
<p>This data frame was then made wider by creating columns with the length category names, each with the “count” in that category underneath it for each year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">psd_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from=</span>gcat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from=</span>count)</span>
<span id="cb7-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year stock quality preferred memorable trophy
#R|  1  2002    20      28         1        NA     NA
#R|  2  2003    31      57        43        NA     NA
#R|  3  2004   141      36        27         1     NA
#R|  17 2018    34      16        22         1     NA
#R|  18 2019   176      20        17         3     NA
#R|  19 2020    52     132        13        NA     NA</code></pre>
</div>
</div>
<p>For example, in 2002 there were 20 stock- to quality-sized fish, 28 quality- to preferred-size fish, 1 preferred- to memorable-sized fish, and no fish in the other categories. Each PSD calculation requires the total number of stock-size and larger fish as the denominator; i.e., 49 fish in 2002. In addition, the overall PSD calculation requires the total number of quality-sized and larger fish as the numerator; i.e., 28 fish in 2002. These two quantities are computed in <code>mutate()</code> below, but note that <code>rowwise()</code> is used before that to force the calculations to be computed by row (i.e., by year).<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;If <code>rowwise</code> is not used then, for example, <code>sum(stock+quality)</code> would be the sum of both the <code>stock</code> and <code>quality</code> <strong>columns</strong>; i.e., the sum across all years.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">psd_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">qualityplus=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(quality,preferred,memorable,trophy,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb9-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stockplus=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(stock,qualityplus,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb9-5">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year stock quality preferred memorable trophy qualityplus stockplus
#R|  1  2002    20      28         1        NA     NA          29        49
#R|  2  2003    31      57        43        NA     NA         100       131
#R|  3  2004   141      36        27         1     NA          64       205
#R|  17 2018    34      16        22         1     NA          39        73
#R|  18 2019   176      20        17         3     NA          40       216
#R|  19 2020    52     132        13        NA     NA         145       197</code></pre>
</div>
</div>
<p>The overall PSD is calculated as quality-sized and larger fish divided by stock-sized and larger fish multiplied by 100. The three incremental PSD values are calculated as the number in the incremental length group (e.g., stock- to quality-sized) divided by stock-sized and larger fish multiplied by 100. These calculations are made below within <code>mutate()</code>.<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The incremental PSD names are within single back-ticks because the name contains a space (and a hyphen).</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">psd_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD=</span>qualityplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>stockplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb11-3">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD S-Q</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>stock<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>stockplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb11-4">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD Q-P</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>quality<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>stockplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb11-5">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD P-M</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>preferred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>stockplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb11-7">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year stock quality preferred memorable trophy qualityplus stockplus      PSD
#R|  1  2002    20      28         1        NA     NA          29        49 59.18367
#R|  2  2003    31      57        43        NA     NA         100       131 76.33588
#R|  3  2004   141      36        27         1     NA          64       205 31.21951
#R|  17 2018    34      16        22         1     NA          39        73 53.42466
#R|  18 2019   176      20        17         3     NA          40       216 18.51852
#R|  19 2020    52     132        13        NA     NA         145       197 73.60406
#R|      PSD S-Q   PSD Q-P   PSD P-M
#R|  1  40.81633 57.142857  2.040816
#R|  2  23.66412 43.511450 32.824427
#R|  3  68.78049 17.560976 13.170732
#R|  17 46.57534 21.917808 30.136986
#R|  18 81.48148  9.259259  7.870370
#R|  19 26.39594 67.005076  6.598985</code></pre>
</div>
</div>
<p>Finally, this data frame should be made longer such that the calculated PSD values will appear under one column (called <code>values</code>) and another column will be created with the name of the PSD metric. This process begins by restricting the data frame to the <code>year</code> and all calculated PSD values, then pivoting the values in all of the PSD columns into one column with the names of the PSD metric stored in <code>metric</code>, and then factoring <code>metric</code> with the levels controlled so that they will be plotted in the same order as in Figure 3. This new data frame has a new name, as the original <code>psd_dat</code> data frame is used further below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">psd_dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(metric,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD S-Q"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD Q-P"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD P-M"</span>)))</span>
<span id="cb13-5">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year  metric     value
#R|  1  2002     PSD 59.183673
#R|  2  2002 PSD S-Q 40.816327
#R|  3  2002 PSD Q-P 57.142857
#R|  74 2020 PSD S-Q 26.395939
#R|  75 2020 PSD Q-P 67.005076
#R|  76 2020 PSD P-M  6.598985</code></pre>
</div>
</div>
<p>This data frame, now called <code>psd_dat2</code>, is ready for recreating Figure 3.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-3" class="level1">
<h1>Recreating Figure 3</h1>
<p>Figure 3 is a simple bar plot facetted across years similar to the CPE plot in <a href="../2023-3-22_McCarricketal2022_Fig2/#recreating-figure-2">this previous post</a>. Thus, I don’t discuss the details further here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>psd_dat2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb15-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb15-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb15-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb15-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-10">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb15-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb15-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/index_files/figure-html/make-fig3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="adding-confidence-intervals" class="level1 page-columns page-full">
<h1>Adding Confidence Intervals</h1>
<p>I wanted to see if I could make Figure 3 as above, but add confidence intervals to the PSD calculations.<sup>5</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;The authors added CIs to the relative weight calculations in their Figure 4, but did not do that here for their PSD calculations.</p></div></div><p>As discussed in <span class="citation" data-cites="ogleIntroductoryFisheriesAnalyses2016">Ogle (2016)</span> confidence intervals for a PSD can be made from binomial distribution theory using <code>binCI()</code> from <code>FSA</code>. This is a simple process of giving <code>binCI()</code> the number of “successes” (i.e., the numerator in the PSD calculation), the number of “trials”(i.e., the denominator), and the type of algorithm to use (we will use the “Wilson” algorithm here). For example, the CI for the overall PSD in 2002 is computed below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binCI</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wilson"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    95% LCI  95% UCI
#R|   45.24732 71.78476</code></pre>
</div>
</div>
<p>This becomes complicated here for several reasons:</p>
<ul>
<li>The CIs are computed across multiple years.</li>
<li>The numerators differ among the PSD metrics (e.g., quality-sized and larger fish for the overall PSD but just quality-sized fish for PSD S-Q).</li>
<li><code>binCI()</code> returns two values rather than 1 (thus, complicating the use of <code>mutate()</code>).</li>
<li><code>binCI()</code> returns a matrix with column names rather than a named vector.</li>
</ul>
<p>Given these issues, confidence intervals the PSD, PSD S-Q, etc. will each be calculated separately and then combined into a single data frame. I begin by calculating the CIs for the PSD.</p>
<p>Here we return to the wide <code>psd_dat</code> data frame from above. The calculation will be for each year so again use <code>rowwise()</code>. <code>FSA::binCI()</code> will be used with <code>mutate()</code> but its result must first be converted to a vector with <code>as.vector()</code> (<em>addresses last issue above</em>) and then put in a <code>list()</code>. In this case the <code>ci</code> “variable” will be a list with two items (the lower and upper CI values) for each year. We want to get the two values out of this list and into their own variables, which is accomplished with <code>unnest_wider()</code> from <code>tidyr</code> (<em>addressing the third issue above</em>). The results from <code>binCI()</code> (after <code>as.vector()</code>) were unnamed, so <code>names_sep=</code> must be used in <code>unnest_wider()</code>. With this set to <code>""</code>, the unnested variables will be the original name (“ci”) followed by sequential numbers (i.e., “ci1” and “ci2” here). Finally,the data frame is reduced to the <code>year</code>, <code>PSD</code>, <code>ci1</code>, and <code>ci2</code> variables, but <code>PSD</code> is renamed <code>value</code> along the way.<sup>6</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;This renaming is necessary for <code>bind_rows()</code> further below.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">tmp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binCI</span>(qualityplus,stockplus,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wilson"</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_wider</span>(ci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span>PSD,ci1,ci2)</span>
<span id="cb18-6">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(tmp1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|     year    value       ci1       ci2
#R|  1  2002 59.18367 0.4524732 0.7178476
#R|  2  2003 76.33588 0.6837273 0.8279848
#R|  3  2004 31.21951 0.2527076 0.3785916
#R|  17 2018 53.42466 0.4209895 0.6440796
#R|  18 2019 18.51852 0.1390441 0.2423283
#R|  19 2020 73.60406 0.6703995 0.7926523</code></pre>
</div>
</div>
<p>This exact code is repeated for PSD S-Q but making sure that <code>stock</code> is the first argument to <code>binCI()</code>, the new <code>value</code> variable comes from <code>PSD S-Q</code>, and the resulting data frame is given a different name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">tmp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binCI</span>(stock,stockplus,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wilson"</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_wider</span>(ci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD S-Q</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,ci1,ci2)</span></code></pre></div>
</div>
<p>This process is repeated for the other two metrics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">tmp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binCI</span>(quality,stockplus,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wilson"</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_wider</span>(ci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD Q-P</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,ci1,ci2)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">tmp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> psd_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binCI</span>(preferred,stockplus,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wilson"</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_wider</span>(ci,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PSD P-M</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,ci1,ci2)</span></code></pre></div>
</div>
<p>These four temporary data frames are bound together with a <code>metric</code> variable added to indicate which PSD metric appears in each row of the new data frame. Additionally, <code>ci1</code> and <code>ci2</code> were renamed to <code>LCI</code> and <code>UCI</code> for clarity, each CI endpoint was muliplied by 100 to put it on the same scale as the point estimates (i.e., percentages rather than proportions returned from <code>binCI()</code>), and <code>metric</code> was factored with controlled levels as above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">psd_dat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>tmp1,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD S-Q"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>tmp2,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD Q-P"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>tmp3,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD P-M"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>tmp4),</span>
<span id="cb23-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LCI=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UCI=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ci2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LCI=</span>LCI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UCI=</span>UCI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb23-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(metric,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD S-Q"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD Q-P"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD P-M"</span>)))</span>
<span id="cb23-6">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(psd_dat3)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      metric year     value       LCI      UCI
#R|  1      PSD 2002 59.183673 45.247319 71.78476
#R|  2      PSD 2003 76.335878 68.372730 82.79848
#R|  3      PSD 2004 31.219512 25.270764 37.85916
#R|  74 PSD P-M 2018 30.136986 20.822591 41.43737
#R|  75 PSD P-M 2019  7.870370  4.971693 12.24137
#R|  76 PSD P-M 2020  6.598985  3.896693 10.96152</code></pre>
</div>
</div>
<p>The same code used above to recreate Figure 3 is repeated below, but <code>geom_errorbar()</code> is used with <code>LCI</code> mapped to <code>ymin=</code> and <code>UCI</code> mapped to <code>ymax=</code> to form the confidence intervals. <code>geom_errorbar()</code> is before <code>geom_col()</code> which gives the appearance of only showing the upper portion of the confidence interval (i.e., the lower portion is behind the bar). <code>width=0.25</code> was used to narrow the “caps” on the intervals.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>psd_dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>LCI,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>UCI),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb25-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb25-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb25-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb25-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-11">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb25-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb25-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/index_files/figure-html/make-fig3-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="further-thoughts" class="level1">
<h1>Further Thoughts</h1>
<section id="point-and-lines-plot" class="level3">
<h3 class="anchored" data-anchor-id="point-and-lines-plot">Point-and-Lines Plot</h3>
<p>As mentioned in <a href="../2023-3-20-Rooketal2022_Fig4/">this previous post</a> I understand that these are the much derided <a href="https://simplystatistics.org/posts/2019-02-21-dynamite-plots-must-die/">“dynamite plots”</a>. Personally, I find the bars distracting (so much gray with little purpose) and find a point-and-lines plot more appealing.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>psd_dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>LCI,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>UCI),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb26-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb26-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb26-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb26-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-12">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb26-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/index_files/figure-html/make-fig3-alt2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loess-smoother" class="level3">
<h3 class="anchored" data-anchor-id="loess-smoother">Loess Smoother</h3>
<p>A loess smoother could also be added with <code>geom_smooth()</code> to highlight any trends (or lack thereof).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>psd_dat3,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>LCI,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>UCI),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray30"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb27-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PSD"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb27-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb27-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb27-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-13">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(metric),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/index_files/figure-html/make-fig3-alt3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-mccarricketal_2022" class="csl-entry">
McCarrick, D. K., J. C. Dillon, B. High, and M. C. Quist. 2022. <a href="https://doi.org/10.3996/JFWM-21-074">Population dynamics of <span>Yellowstone Cutthroat Trout</span> in <span>Henrys Lake</span>, <span>Idaho</span></a>. Journal of Fish and Wildlife Management 13(1):169–181.
</div>
<div id="ref-ogleIntroductoryFisheriesAnalyses2016" class="csl-entry">
Ogle, D. H. 2016. <a href="http://derekogle.com/IFAR/">Introductory <span>Fisheries Analyses</span> with <span>R</span></a>. <span>CRC Press</span>, <span>Boca Raton, FL</span>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {McCarrick Et Al. (2022) {PSD} {Plot}},
  date = {2023-03-25},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-25_McCarricketal2022_Fig3},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 25. McCarrick et al. (2022) PSD Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-25_McCarricketal2022_Fig3">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-25_McCarricketal2022_Fig3</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>bar chart</category>
  <category>facets</category>
  <category>axes</category>
  <category>confidence intervals</category>
  <category>Data Wrangling</category>
  <category>PSD</category>
  <category>Size Structure</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/</guid>
  <pubDate>Sat, 25 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-25_McCarricketal2022_Fig3/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>McCarrick et al. (2022) CPE Plot</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the first of several posts related to <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> examined the population dynamics of Yellowstone Cutthroat Trout (<em>Oncorhynchus clarkii bouvieri</em>) in Henrys Lake, Idaho over a nearly two decade period. Their <a href="https://meridian.allenpress.com/view-large/figure/14538506/i1944-687X-13-1-169-f02.tif">Figure 2</a> shows the catch-per-unit-effort (CPE) of both Cutthroat Trout and Utah Chub (<em>Gila atraria</em>) by size categories across years. I use <code>ggplot2</code> to recreate that figure here.</p>
<p>The following packages are loaded for use below. A few functions from each of <code>lubridate</code>, <code>FSA</code>, <code>plyr</code>, <code>scales</code>, <code>gghrx</code>, and <code>lemon</code> are used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for arranging multiple plots</span></span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will see below that I could recreate the structure but not the exact results of the author’s Figure 2. This may be due to issues present in the data provided with the publication that I discuss below, but it could also be that my data wrangling differs from theirs. I defer to the authors here as they are the experts with their day; I am just an interloper. I actually appreciate these data issues from an educational perspective as they provide rich opportunities to demonstrate a variety of techniques with “real” “messy” data.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="data-wrangling" class="level1 page-columns page-full">
<h1>Data Wrangling</h1>
<section id="reading-excel-file-and-handling-dates" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="reading-excel-file-and-handling-dates">Reading Excel File and Handling Dates</h3>
<p><span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> provided raw data for Figure 2 as an Excel file in their Data Supplement S1. Several “issues” were apparent on my first attempts to load these data.</p>
<ul>
<li>Missing data was recorded as missing cells, with “??”, and with “UNK”.</li>
<li>There were oddly placed strings in some data fields (e.g., “Qty=”, “Qty =”, and “No Tag”). [<em>I treated these as missing data below.</em>]</li>
<li>Dates were recorded as just year, full date with two-digit year, and full date with four-digit year. [<em>More on this below.</em>]</li>
<li>Inconsistent “species” abbreviations. [<em>More on this below.</em>]</li>
<li>Incorrect length and weight measurements (e.g., &lt;10 mm, &gt;2000 mm). [<em>I treated these “as is” (i.e., without correction) for this post.</em>]</li>
</ul>
<p>The missing data and oddly named cells were handled with <code>na=</code> below. In addition, the column types were specifically defined in <code>col_types=</code>, primarily so that the first column would be largely correctly read as a date. The year was then extracted from the <code>Date</code> variable using <code>year()</code> from <code>lubridate</code>. However, the dates recorded in the original file as only a year were interpreted as an “Excel date code” rather than a date and, thus, the year was not extracted correctly. Fortunately, this “date” format was only used for one year (2002) such that the extracted year was consistently “1905.” Thus, the “1905” was replaced with “2002” for the extracted year with <code>ifelse()</code> as shown below. Several years did not exist (because the date was not recorded) and were removed with <code>filter()</code>. Finally, the variables were rearranged slightly, <code>Species</code> was changed to <code>species</code> for consistency with other variables, and the long effort variable was changed to the shorter <code>netNights</code>.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Note that this code still produced a large number of warnings, all related to the “2002” “date”.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"download.xlsx"</span>,</span>
<span id="cb2-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"??"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY ="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QTY="</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UNK"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NO TAG"</span>),</span>
<span id="cb2-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb2-4">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span>lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(Date),</span>
<span id="cb2-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1905</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002</span>,year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>Species,year,length,weight,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">netNights=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">number of net nights</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb2-9">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        species year length weight netNights
#R|  1         YCT 2002    150     NA        18
#R|  2         YCT 2002    160     NA        18
#R|  3         YCT 2002    160     NA        18
#R|  23971     YCT 2020    391    550        30
#R|  23972     YCT 2020    284    229        30
#R|  23973     YCT 2020    440    853        30</code></pre>
</div>
</div>
</section>
<section id="new-effort-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="new-effort-data-frame">New Effort Data Frame</h3>
<p>The effort (i.e., <code>netNights</code>) variable seems out-of-place in the sense that each row of this data frame is a single fish. I suspected that this effort is actually for a year and was repeated for each fish captured in the same year. To examine my suspicion, I computed the minimum and maximum effort (and the difference between the two) for each year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minF=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(netNights,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb4-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxF=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(netNights,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb4-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff=</span>maxF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>minF)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 19 × 4
#R|      year  minF  maxF  diff
#R|     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|   1  2002    18    18     0
#R|   2  2003    18    18     0
#R|   3  2004    50    50     0
#R|   4  2005    46    46     0
#R|   5  2006    48    48     0
#R|   6  2007    44    44     0
#R|   7  2008    12    12     0
#R|   8  2009    23    23     0
#R|   9  2010    50    50     0
#R|  10  2011    30    30     0
#R|  11  2012    50    50     0
#R|  12  2013    50    50     0
#R|  13  2014    48    48     0
#R|  14  2015    50    50     0
#R|  15  2016    48    48     0
#R|  16  2017    50    50     0
#R|  17  2018    50    50     0
#R|  18  2019    50    50     0
#R|  19  2020    30    50    20</code></pre>
</div>
</div>
<p>The minimum and maximum efforts are the same for each, with the exception of 2020. I suspect that this is a typo. A quick table of efforts for 2020 shows that the vast majority are 30, rather than 50, net-nights. Further, my initial analysis with these data resulted in CPE values for 2020 that were lower than what was shown in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>. Thus, I am going to assume that 30 net-nights of effort was used in 2020 (see how this is corrected below).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>netNights,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat,year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  netNights
#R|   30  50 
#R|  865   9</code></pre>
</div>
</div>
<p>For my purposes, I am going to create a new data frame of annual levels of effort by finding the <em>minimum</em> <code>netNights</code> in each year. The minimum is used here because it is the actual effort for all years that properly had a constant <code>netNights</code> entered and it is the assumed correct <code>netNights</code> for 2020 when a constant value was not entered.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">eff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">netNights=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(netNights,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb8-4">eff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 19 × 2
#R|      year netNights
#R|     &lt;dbl&gt;     &lt;dbl&gt;
#R|   1  2002        18
#R|   2  2003        18
#R|   3  2004        50
#R|   4  2005        46
#R|   5  2006        48
#R|   6  2007        44
#R|   7  2008        12
#R|   8  2009        23
#R|   9  2010        50
#R|  10  2011        30
#R|  11  2012        50
#R|  12  2013        50
#R|  13  2014        48
#R|  14  2015        50
#R|  15  2016        48
#R|  16  2017        50
#R|  17  2018        50
#R|  18  2019        50
#R|  19  2020        30</code></pre>
</div>
</div>
<p>The <code>netNights</code> variables is no longer needed in the individual fish data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>netNights)</span></code></pre></div>
</div>
</section>
<section id="filtering-to-two-species" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="filtering-to-two-species">Filtering to Two Species</h3>
<p>Figure 2 in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> only displays results for Cutthroat Trout and Utah Chub. Thus, the data frame should be reduced to just these species. First, a look at how species are identified.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>species)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|   [1] "YCT"     "BKT"     "HYB"     "CHB"     "RSS"     "UTC"     "KOK"    
#R|   [8] "BRT"     "CHUB"    NA        "HB"      "Yct"     "NO FISH" "SCU"</code></pre>
</div>
</div>
<p>From the published paper it is apparent that “YCT” is for Yellowstone Cutthroat Trout and “UTC” is for Utah Chub. But note the “Yct” and the “CHB” and “CHUB”. A little closer look at just these abbreviations by year suggests that “Yct” is a “one-off” typo, but that “CHB” and “CHUB” appeared to be used in some years when “UTC” was mostly not used. This suggested to me that “CHB” and “CHUB” were likely synonyms for “UTC”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat,species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yct"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHB"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHUB"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        species
#R|  year    CHB CHUB  UTC  Yct  YCT
#R|    2002    0    0    0    0   55
#R|    2003   84    0    2    0  162
#R|    2004    0    0  728    0  323
#R|    2005    0    0  294    0  305
#R|    2006    0    0  424    0  269
#R|    2007    0    0  895    0  658
#R|    2008    0  606    0    0  100
#R|    2009    0    0  512    0   91
#R|    2010    0    0    0    0  502
#R|    2011    0  440    0    0  374
#R|    2012    0    0  692    0  500
#R|    2013    0    0 1858    0  478
#R|    2014    0    0 1767    1  475
#R|    2015    0    0 1660    0  254
#R|    2016    0    0 1078    0  265
#R|    2017    0    0 1025    0  149
#R|    2018    0    0 1273    0   76
#R|    2019    0    0  696    0  219
#R|    2020    0    0  414    0  198</code></pre>
</div>
</div>
<p>Thus, <code>species</code> is modified below by combining “YCT” and “Yct” into “YCT”, and combining “UTC”, “CHB”, and “CHUB” into “UTC”.<sup>2</sup> The data frame was subsequently reduced to just these two species.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;And leaving all other species “names” as-is.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb15-3">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yct"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,</span>
<span id="cb15-4">    species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHB"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CHUB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>,</span>
<span id="cb15-5">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> species</span>
<span id="cb15-6">    )</span>
<span id="cb15-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>))</span>
<span id="cb15-9"></span>
<span id="cb15-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># just checking</span></span>
<span id="cb15-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>species)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  [1] "YCT" "UTC"</code></pre>
</div>
</div>
</section>
<section id="adding-gabelhouse-length-categories" class="level3">
<h3 class="anchored" data-anchor-id="adding-gabelhouse-length-categories">Adding Gabelhouse Length Categories</h3>
<p>Figure 2 separates the data into panels based on Gabelhouse length categories (i.e., “Stock”, “Quality”, etc.). These categories can be efficiently added to the data frame using <code>psdAdd()</code> from <code>FSA</code>, but <code>psdAdd()</code> requires full species names rather than abbreviations. <code>mapvalues()</code> from <code>plyr</code> is used below to create a new variable with the full names derived from the abbreviations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species2=</span>plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapvalues</span>(species,</span>
<span id="cb17-3">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>),</span>
<span id="cb17-4">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cutthroat Trout"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Utah Chub"</span>)))</span>
<span id="cb17-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># just checking</span></span>
<span id="cb17-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xtabs</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>species<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>species2,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|         species2
#R|  species Cutthroat Trout Utah Chub
#R|      UTC               0     14448
#R|      YCT            5454         0</code></pre>
</div>
</div>
<p>Now the length categories may be added using <code>species2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gcat=</span>FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">psdAdd</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">len=</span>length,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span>species2))</span>
<span id="cb19-3">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|        species year length weight        species2     gcat
#R|  1         YCT 2002    150     NA Cutthroat Trout substock
#R|  2         YCT 2002    160     NA Cutthroat Trout substock
#R|  3         YCT 2002    160     NA Cutthroat Trout substock
#R|  19900     YCT 2020    391    550 Cutthroat Trout  quality
#R|  19901     YCT 2020    284    229 Cutthroat Trout    stock
#R|  19902     YCT 2020    440    853 Cutthroat Trout  quality</code></pre>
</div>
</div>
</section>
<section id="computing-cpe" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="computing-cpe">Computing CPE</h3>
<p>From this, the data needs to be summarized to produce the CPE for each species for each year for each length category and for all fish regardless of length category. Development of this data frame will begin by counting the number of fish (i.e., rows) for each length category within each year within each species.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">catch_gcat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species,year,gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span>
<span id="cb21-4">catch_gcat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 162 × 4
#R|  # Groups:   species, year [36]
#R|     species  year gcat      catch
#R|     &lt;chr&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;
#R|   1 UTC      2003 substock      5
#R|   2 UTC      2003 stock        41
#R|   3 UTC      2003 quality      21
#R|   4 UTC      2003 preferred    15
#R|   5 UTC      2003 memorable     4
#R|   6 UTC      2004 substock      2
#R|   7 UTC      2004 stock       535
#R|   8 UTC      2004 quality     128
#R|   9 UTC      2004 preferred    52
#R|  10 UTC      2004 memorable    11
#R|  # … with 152 more rows</code></pre>
</div>
</div>
<p>Note in the previous output that <code>catch_gcat</code> is still “grouped” by year within species. Thus, <code>catch</code> can summed from this data frame to find the total catch per year for each species.<sup>3</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Ungroup this data frame as we will not summarize it further.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">catch_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> catch_gcat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(catch)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb23-4">catch_all</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 36 × 3
#R|     species  year catch
#R|     &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
#R|   1 UTC      2003    86
#R|   2 UTC      2004   728
#R|   3 UTC      2005   294
#R|   4 UTC      2006   424
#R|   5 UTC      2007   895
#R|   6 UTC      2008   606
#R|   7 UTC      2009   512
#R|   8 UTC      2011   440
#R|   9 UTC      2012   692
#R|  10 UTC      2013  1858
#R|  # … with 26 more rows</code></pre>
</div>
</div>
<p>As Figure 2 displays all fish and fish by length category, these two data frames should be row-bound (i.e., stacked) together. Figure 2 does <em>not</em> have panels for “substock”, “memorable”, or “trophy” sized fish so fish in those length categories were removed from the resultant data frame. Finally, a new variable called <code>type</code> was created that has the names from <code>gcat</code>, or “All” if <code>gcat</code> was <code>NA</code><sup>4</sup>.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;<code>gcat</code> for “all fish” after <code>bind_rows()</code> was <code>NA</code> as <code>gcat</code> was not present in <code>catch_all</code></p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">cpe_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(catch_all,catch_gcat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(gcat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"substock"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"memorable"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trophy"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(gcat),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(gcat)))</span>
<span id="cb25-4">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(cpe_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      species year catch      gcat      type
#R|  1       UTC 2003    86      &lt;NA&gt;       All
#R|  2       UTC 2004   728      &lt;NA&gt;       All
#R|  3       UTC 2005   294      &lt;NA&gt;       All
#R|  143     YCT 2020    52     stock     stock
#R|  144     YCT 2020   132   quality   quality
#R|  145     YCT 2020    13 preferred preferred</code></pre>
</div>
</div>
<p>Finally, these data are <code>left-join()</code>ed (by year) with <code>eff</code> to add <code>netNights</code>, from which a new <code>cpe</code> variable is created. <code>type</code> was converted to a factor to match the vertical order of Figure 2, and the levels were given longer labels to match the labels in Figure 2. Finally, the variables were re-ordered (and <code>gcat</code> was dropped) for personal preference.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">cpe_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cpe_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(eff,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cpe=</span>catch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>netNights,</span>
<span id="cb27-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(type,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stock"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quality"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferred"</span>),</span>
<span id="cb27-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All fish"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stock to Quality"</span>,</span>
<span id="cb27-6">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quality to Preferred"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preferred to Memorable"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(species,year,type,catch,netNights,cpe)</span>
<span id="cb27-8">FSA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">headtail</span>(cpe_dat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|      species year                   type catch netNights        cpe
#R|  1       UTC 2003               All fish    86        18  4.7777778
#R|  2       UTC 2004               All fish   728        50 14.5600000
#R|  3       UTC 2005               All fish   294        46  6.3913043
#R|  143     YCT 2020       Stock to Quality    52        30  1.7333333
#R|  144     YCT 2020   Quality to Preferred   132        30  4.4000000
#R|  145     YCT 2020 Preferred to Memorable    13        30  0.4333333</code></pre>
</div>
</div>
<p>This data frame, now called <code>cpe_dat</code>, is now ready for recreating Figure 2.</p>
</section>
<section id="quick-summaries-of-cpe" class="level3">
<h3 class="anchored" data-anchor-id="quick-summaries-of-cpe">Quick Summaries of CPE</h3>
<p>Before recreating Figure 2, I summarized the CPE data by species and year for comparison to results in <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">cpe_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All fish"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb29-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ttlcatch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(catch),</span>
<span id="cb29-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mncpe=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(cpe),</span>
<span id="cb29-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdcpe=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(cpe),</span>
<span id="cb29-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mincpe=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(cpe),</span>
<span id="cb29-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minyr=</span>year[cpe<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>mincpe],</span>
<span id="cb29-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxcpe=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(cpe),</span>
<span id="cb29-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxyr=</span>year[cpe<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>maxcpe])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 2 × 9
#R|    species     n ttlcatch mncpe sdcpe mincpe minyr maxcpe maxyr
#R|    &lt;chr&gt;   &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
#R|  1 UTC        18    14459 20.0  12.9   0.239  2005   50.5  2008
#R|  2 YCT        19     5454  7.16  3.48  1.52   2018   15.0  2007</code></pre>
</div>
</div>
<p>In the first paragraph of the results, <span class="citation" data-cites="mccarricketal_2022">McCarrick et al. (2022)</span> found the overall mean (and SD) CPE was 7.4 (3.6) for YCT and 19.9 (13.0) for UTC, which is close to what I obtained for UTC but not for YTC. In addition, they found a peak CPE of 15.4 for YCT in 2007 and 50.5 for UTC in 2008, again very close to my results for UTC but not that close for YCT. Finally, in the label for Figure 2 they reported 5,524 YCT were captured, whereas my results only show 5,454.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="recreating-figure-2" class="level1 page-columns page-full">
<h1>Recreating Figure 2</h1>
<p>My general strategy for recreating Figure 2 was to create the left and right panels of subplots separately and then combine them using <code>patchwork</code>. Each side can be constructed via faceting on <code>type</code>, but I will use <code>facet_rep_wrap()</code> from <code>lemon</code> so as to have the x-axis tick marks on each panel.<sup>5</sup> Each panel will be create with <code>geom_col()</code> using <code>width=1</code> so that the bars touch and <code>geom_text()</code> to place the labels.<sup>6</sup> The x- and y-axes were modified as is commonly done.<sup>7</sup> Finally, I used <code>theme_bw()</code> as a base, removed the gridlines and removed the facet labels and background.<sup>8</sup> As you examine the code below, make sure to realize that the data was filtered to just “YCT”.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;See <a href="../2023-3-15-Axis_Magic/#axes-for-each-facet">this post</a> about <code>facet_rep_wrap()</code>.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;See <a href="../2023-3-18-Rooketal2022_CiscoHarvest/#recreating-figure-2">this post</a> for more explanation of how to use <code>geom_text()</code> in this way.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;And is described more in <a href="../2023-3-15-Axis_Magic/">this post</a>.</p></div><div id="fn8"><p><sup>8</sup>&nbsp;As described in <a href="../2023-3-18-Rooketal2022_CiscoHarvest/#recreating-figure-2">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">YCT <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cpe_dat,species<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>),</span>
<span id="cb31-2">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>cpe)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,</span>
<span id="cb31-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT per net night"</span>,</span>
<span id="cb31-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb31-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb31-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb31-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-12">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb31-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb31-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb31-17">YCT</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/index_files/figure-html/make-fig2-YCT-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>The code above was largely repeated but with data filtered to just “UTC” and adjusting the y-axis accordingly. The plot is not shown here but is the right side in the plot further below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">UTC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cpe_dat,species<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>cpe)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,</span>
<span id="cb32-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_overlap=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC per net night"</span>,</span>
<span id="cb32-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb32-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb32-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb32-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-11">  lemon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_rep_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb32-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb32-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</div>
<p>The two subplots are then placed side-by-side.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">YCT <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> UTC</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/index_files/figure-html/make-fig2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="further-thoughts" class="level1 page-columns page-full">
<h1>Further Thoughts</h1>
<p>I wanted to see if I could make a similar looking plot using <code>facet_grid()</code>. It turns out to be a bit of a challenge because each panel on the left- and right-sides has the same y-axis, but those axes differ between the two sides. I found a way around this.</p>
<p>First, I changed species to a factor with “YCT” in the first position so it would be plotted on the left (i.e., first). I also gave the levels longer labels so that the facets would have useful labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">cpe_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cpe_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(species,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YCT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>),</span>
<span id="cb34-3">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yellowstone Cutthroat Trout"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Utah Chub"</span>)))</span></code></pre></div>
</div>
<p>The y-axis needs to be defined for <strong>each</strong> facet. However, these definitions should be constant within <code>species</code>. Thus, I define limits and breaks for both <code>YCT</code> and <code>UTC</code> and saved them as objects. In addition, to save typing, I also defined the expansion factor as an object.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">YCT_lmts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb35-2">YCT_brks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb35-3">UTC_lmts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)</span>
<span id="cb35-4">UTC_brks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb35-5">yexp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<p>The basic plot uses the same <code>ggplot()</code> (except the data is not filtered), <code>geom_col()</code>, <code>scale_x_continous()</code>, and <code>theme_bw()</code> as before. The <code>geom_text()</code> has been eliminated because the “type” labels are going to be in the facet labels rather than “on the plot.” The part of <code>theme()</code> that removed the facet labels has been eliminated as facet labels are needed here. The spacing between panels was increased in <code>theme()</code> here. <code>facet_rep_wrap()</code> was replaced with <code>facet_grid2()</code> from <code>ggh4x</code>, where the rows are defined by <code>type</code>, the columns are defined by <code>species</code>, the y-axes are “free” and “independent” from facet to facet.<sup>9</sup> Finally, <code>facetted_pos_scales()</code> from <code>ggh4x</code> is used to apply a different <code>scale_y_continous()</code> to each panel.<sup>10</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;The <code>independent="y"</code> part is the main thing that <code>facet_grid2()</code> adds over <code>facet_grid()</code> from <code>ggplot2</code>.</p></div><div id="fn10"><p><sup>10</sup>&nbsp;<code>facetted_pos_scales()</code> is described in more detail in <a href="../2023-3-15-Axis_Magic/#axis-limits-for-each-facet">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>cpe_dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>year,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>cpe)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray70"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb36-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb36-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-6">  ggh4x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rows=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(species),</span>
<span id="cb36-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">independent=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb36-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-11">  ggh4x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facetted_pos_scales</span>(</span>
<span id="cb36-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb36-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# Fish per net night"</span>,</span>
<span id="cb36-14">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>YCT_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>YCT_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>UTC_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>UTC_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>YCT_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>YCT_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-17">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>UTC_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>UTC_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>YCT_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>YCT_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>UTC_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>UTC_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>YCT_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>YCT_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp),</span>
<span id="cb36-21">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span>UTC_lmts,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>UTC_brks,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span>yexp)</span>
<span id="cb36-22">    )</span>
<span id="cb36-23">  )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/index_files/figure-html/make-fig2-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-mccarricketal_2022" class="csl-entry">
McCarrick, D. K., J. C. Dillon, B. High, and M. C. Quist. 2022. <a href="https://doi.org/10.3996/JFWM-21-074">Population dynamics of <span>Yellowstone Cutthroat Trout</span> in <span>Henrys Lake</span>, <span>Idaho</span></a>. Journal of Fish and Wildlife Management 13(1):169–181.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {McCarrick Et Al. (2022) {CPE} {Plot}},
  date = {2023-03-22},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-22_McCarricketal2022_Fig2},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 22. McCarrick et al. (2022) CPE Plot. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-22_McCarricketal2022_Fig2">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-22_McCarricketal2022_Fig2</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>bar chart</category>
  <category>facets</category>
  <category>axes</category>
  <category>Data Wrangling</category>
  <category>CPE</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/</guid>
  <pubDate>Wed, 22 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-22_McCarricketal2022_Fig2/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>Rook et al. (2022) Estimated Cisco Stocking Densities</title>
  <dc:creator>Derek H. Ogle</dc:creator>
  <link>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span> analyzed historical data to answer the question of how many ciscoes are needed for stocking in the Laurentian Great Lakes. Their <a href="https://meridian.allenpress.com/view-large/figure/14537627/i1944-687X-13-1-28-f04.tif">Figure 4</a> shows lake-specific estimates of fry, fall fingerling, and age-1 stocking densities used to determine the number of Cisco (<em>Coregonus artedi</em>) needed for stocking to mimic historical and contemporary age-1 and adult recruitment rates in Wisconsin waters of Lake Superior. I attempt to recreate their figure here.</p>
<p>The following packages are loaded for use below. Also one function from each of <code>scales</code> and <code>ggtext</code> is used with <code>::</code> such that the entire packages are not attached here.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for dplyr, ggplot2 packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggh4x)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for minor axis functionality</span></span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The figure recreated here is often called a “dynamite plot.” I understand that there is controversy around these types of plots (see <a href="http://emdbolker.wikidot.com/blog:dynamite">here</a>]. However, they appear often in the fisheries literature, for better or worse. With this in mind, I thought it worthwhile to some to show how one might be constructed with <code>ggplot2</code>.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="get-data" class="level1 page-columns page-full">
<h1>Get Data</h1>
<p><span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span> provided summarized data presented in Figure 4 in their Data Supplement S1. Unfortunately the data were provided as a table in a MSWord document. I tried to extract the data from the Word document using the <code>officer</code> package but was unsuccessful. Fortunately, the tables looked like they were originally created in MSExcel, so I copied the “Smax” (i.e., “adult equivalents”) and “Rmax” (age-1 equivalents) portions of the table and pasted them into separate sheets of a single Excel file.</p>
<p>Each sheet is read into a temporary data frame below. Note that the authors used “N/A” to represent missing values so this was accounted for with <code>na=</code>. Further note that a new variable called <code>Type</code> was added to each data frame to identify whether the data represented the “Smax” or “Rmax” results.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">tmp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rooketal2021_S1.xlsx"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sheet=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Smax"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N/A"</span>))</span>
<span id="cb2-2">tmp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rooketal2021_S1.xlsx"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sheet=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rmax"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N/A"</span>))</span></code></pre></div>
</div>
<p>The two data frames were then row-bound (i.e., stacked) together by putting the data frames into a name list that is given to <code>bind_rows()</code>. The <code>.id=</code> argument will create a new variable called <code>Type</code> with the names from the list. Additionally, the <code>Lake</code> variable was renamed to <code>Summary</code> (it contains the summary metrics) and the original “long” names were abbreviated to match those used in the legend of Figure 4 in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>.<sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<code>as.data.frame()</code> is used to make this a regular data frame rather than a “tibble.”</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Smax=</span>tmp1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rmax=</span>tmp2),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary=</span>Lake,</span>
<span id="cb3-3">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hist. Fry</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Historical Fry</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hist. Fingerling</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Historical Fingerling</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-4">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hist. Age-1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Historical Age-1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cont. Fry</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Contemporary Fry</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-5">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cont. Fingerling</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Contemporary Fingerling</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cont. Age-1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Contemporary Age-1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tmp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|    Type     Summary Hist. Fry Hist. Fingerling Hist. Age-1 Cont. Fry
#R|  1 Smax        Erie      1553              959         593       156
#R|  2 Smax         U95      1727             1056         643       174
#R|  3 Smax         L95      1391              870         545       140
#R|  4 Smax Saint Clair      1490              927         578       151
#R|  5 Smax         U95      1671             1031         634       169
#R|  6 Smax         L95      1314              825         527       135
#R|    Cont. Fingerling Cont. Age-1
#R|  1              111          78
#R|  2              122          86
#R|  3               99          72
#R|  4              107          76
#R|  5              118          83
#R|  6               97          70</code></pre>
</div>
</div>
<p>These data are in an awkward format with the now-named <code>Summary</code> variable containing the lake name followed by <code>U95</code> and <code>L95</code> for the upper and lower 95% confidence interval endpoints. I would prefer to have a variable called <code>Lake</code> that would, for example, say <code>Erie</code> for the first three rows above and <code>Saint Clair</code> for the next three rows (and so on for the other lakes). Then, the lake names under <code>Summary</code> would be replaced with <code>Median</code> as the values to the right of the lake names are median stocking densities.</p>
<p>I begin by creating the <code>Lake</code> variable by <code>rep()</code>eating the names in the first, fourth, seventh, etc. positions in <code>Summary</code> three times. The first, fourth, seventh, etc. positions are identified as a sequence from 1 to 34 in intervals of 3.<sup>2</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;<code>Lake</code> was moved to the first variable with <code>relocate()</code> to better see the effect of this code.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lake=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(Summary[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(Lake)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tmp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|           Lake Type     Summary Hist. Fry Hist. Fingerling Hist. Age-1 Cont. Fry
#R|  1        Erie Smax        Erie      1553              959         593       156
#R|  2        Erie Smax         U95      1727             1056         643       174
#R|  3        Erie Smax         L95      1391              870         545       140
#R|  4 Saint Clair Smax Saint Clair      1490              927         578       151
#R|  5 Saint Clair Smax         U95      1671             1031         634       169
#R|  6 Saint Clair Smax         L95      1314              825         527       135
#R|    Cont. Fingerling Cont. Age-1
#R|  1              111          78
#R|  2              122          86
#R|  3               99          72
#R|  4              107          76
#R|  5              118          83
#R|  6               97          70</code></pre>
</div>
</div>
<p>Now, the lake names in those same positions in <code>Summary</code> are replaced with “MEDIAN”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MEDIAN"</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tmp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|           Lake Type Summary Hist. Fry Hist. Fingerling Hist. Age-1 Cont. Fry
#R|  1        Erie Smax  MEDIAN      1553              959         593       156
#R|  2        Erie Smax     U95      1727             1056         643       174
#R|  3        Erie Smax     L95      1391              870         545       140
#R|  4 Saint Clair Smax  MEDIAN      1490              927         578       151
#R|  5 Saint Clair Smax     U95      1671             1031         634       169
#R|  6 Saint Clair Smax     L95      1314              825         527       135
#R|    Cont. Fingerling Cont. Age-1
#R|  1              111          78
#R|  2              122          86
#R|  3               99          72
#R|  4              107          76
#R|  5              118          83
#R|  6               97          70</code></pre>
</div>
</div>
<p>These data are still in a format that is not conducive to plotting. What is ultimately needed is for the “MEDIAN”, “U95”, and “L95” to be variables with their respective values, and a variable should indicate the timing (“historical” or “contemporary”) and stage (“fry”, “fingerling”, or “age-1”) for those values.</p>
<p>I begin this process by creating a “longer” data frame that will stack the current “historical” and “contemporary” columns on top of each other. To do this use <code>pivot_longer()</code> where the columns to pivot in <code>cols=</code> are from <code>Hist. Fry</code> to <code>Cont. Age-1</code><sup>3</sup>, the values under those columns will now be in <code>Number</code>, and the names of those columns will be moved to <code>Stage</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;The <code>:</code> identifies all contiguous columns between the two columns identified.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hist. Fry</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cont. Age-1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stage"</span>)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 12 × 5
#R|     Lake  Type  Summary Stage            Number
#R|     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;
#R|   1 Erie  Smax  MEDIAN  Hist. Fry          1553
#R|   2 Erie  Smax  MEDIAN  Hist. Fingerling    959
#R|   3 Erie  Smax  MEDIAN  Hist. Age-1         593
#R|   4 Erie  Smax  MEDIAN  Cont. Fry           156
#R|   5 Erie  Smax  MEDIAN  Cont. Fingerling    111
#R|   6 Erie  Smax  MEDIAN  Cont. Age-1          78
#R|   7 Erie  Smax  U95     Hist. Fry          1727
#R|   8 Erie  Smax  U95     Hist. Fingerling   1056
#R|   9 Erie  Smax  U95     Hist. Age-1         643
#R|  10 Erie  Smax  U95     Cont. Fry           174
#R|  11 Erie  Smax  U95     Cont. Fingerling    122
#R|  12 Erie  Smax  U95     Cont. Age-1          86</code></pre>
</div>
</div>
<p>The <code>Summary</code> column then needs to be “expanded” to form three new columns with the median and confidence interval endpoints. This is accomplished with <code>pivot_wider()</code> with the names of the new columns coming from <code>Summary</code> and the values in the new columns coming from <code>Number</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from=</span>Summary,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from=</span>Number)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tmp,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output" data-code-line-numbers="nil"><code>#R|  # A tibble: 12 × 6
#R|     Lake        Type  Stage            MEDIAN   U95   L95
#R|     &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R|   1 Erie        Smax  Hist. Fry          1553  1727  1391
#R|   2 Erie        Smax  Hist. Fingerling    959  1056   870
#R|   3 Erie        Smax  Hist. Age-1         593   643   545
#R|   4 Erie        Smax  Cont. Fry           156   174   140
#R|   5 Erie        Smax  Cont. Fingerling    111   122    99
#R|   6 Erie        Smax  Cont. Age-1          78    86    72
#R|   7 Saint Clair Smax  Hist. Fry          1490  1671  1314
#R|   8 Saint Clair Smax  Hist. Fingerling    927  1031   825
#R|   9 Saint Clair Smax  Hist. Age-1         578   634   527
#R|  10 Saint Clair Smax  Cont. Fry           151   169   135
#R|  11 Saint Clair Smax  Cont. Fingerling    107   118    97
#R|  12 Saint Clair Smax  Cont. Age-1          76    83    70</code></pre>
</div>
</div>
<p>The <code>Type</code>, <code>Lake</code>, and <code>Stage</code> variables were then converted to factors with the levels controlled to match that of <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>. I also ordered the data by <code>Stage</code> within <code>Lake</code> within <code>Type</code> for personal preference.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Type,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Smax"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rmax"</span>)),</span>
<span id="cb13-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lake=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Erie"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Saint Clair"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ontario"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Michigan"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Huron"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Superior"</span>)),</span>
<span id="cb13-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Stage=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Stage,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Fry"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Fingerling"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Age-1"</span>,</span>
<span id="cb13-5">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Fry"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Fingerling"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Age-1"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Type,Lake,Stage)</span></code></pre></div>
</div>
<p>This data frame, now called <code>dat</code>, is now ready for plotting.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I suspect there is an easier way to wrangle these data into this format, but I don’t know what it is. It likely would have been easier to create this format from the raw data, rather than the tabularized results provided.</p>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="recreating-figure-2" class="level1 page-columns page-full">
<h1>Recreating Figure 2</h1>
<section id="preliminaries" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<p><span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span> used various shades of gray to identify the time-stage (i.e., <code>Stage</code>) data in their Figure 4. The object below is a named vector with approximations to their color choices.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">sclrs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Fry"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Fingerling"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray50"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hist. Age-1"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray80"</span>,</span>
<span id="cb14-2">           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Fry"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray35"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Fingerling"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray65"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cont. Age-1"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray95"</span>)</span></code></pre></div>
</div>
<p>Figure 4 is a side-by-side bar chart with confidence intervals on each bar. Sided-by-side bars require “dodging” in <code>ggplot2</code> (see below). The confidence intervals also need to be “dodged” to match the bars, but they will only match if the “dodging” is pre-defined. Dodging is defined with <code>position_dodge()</code> using <code>width=</code> to determine how much the side-by-side objects will overlap. A <code>width=</code> of 0 will result in complete overlap, whereas a <code>width=</code> of 1 results in no overlap with a slight separation between bars. A value of 0.9 resulted in no overlap but touching bars as used in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">pd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span></code></pre></div>
</div>
<p>Finally, <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span> labeled each panel of their Figure 4 within the plot region, rather than as a “title” above the plot region. Thus, as in <a href="../2023-3-18-Rooketal2021_CiscoHarvest/">this previous post about <span class="citation" data-cites="rooketal_2022">Rook et al. (<span>2022</span>)</span></a>, the default facet labels cannot be used. An added challenge here though is that the labels they used contain plain text, italicized text, and a subscript. Thus, the “trick” used in that post cannot be easily used here.</p>
<p>Here I create a very simple data frame with two variables. The first variable is <code>Type</code> which contains the two types of data found in <code>dat</code>. It is important that this variable is exactly as it is in <code>dat</code> (i.e., factored, levels the same) as this is the variable that is going to define the facets, or sub-panels, of Figure 4. The second variable, <code>Label</code>, contains the “long” labels for each panel. Here I use markdown code to create the italics (i.e., <code>*</code>) and the subscript (i.e., <code>~</code>).<sup>4</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;These will be used in <code>geom_richtext()</code> from <code>ggtext</code> below, rather than <code>plotmath</code> which I find exceedingly difficult to get correct.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">datlbls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Smax"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rmax"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Smax"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rmax"</span>)),</span>
<span id="cb16-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Label=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult (*S~max~*) Equivalents"</span>,</span>
<span id="cb16-3">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age-1 (*R~max~*) Equivalents"</span>))</span></code></pre></div>
</div>
</section>
<section id="putting-it-together" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="putting-it-together">Putting It Together</h2>
<p>The basic bar plot is constructed from the summarized data in <code>dat</code> using <code>geom_col()</code> with <code>Lake</code> mapped to the x-axis, <code>MEDIAN</code> mapped to the y-axis, and <code>Stage</code> mapped to the <code>fill=</code> color. The bars will not be sided-by-side by default; they need to be “dodged” by setting <code>postion=</code> to the dodge position value set above. <code>color=</code> is set to black to outline each bar as in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>. <code>facet_wrap()</code> is used to separate the plots by <code>Type</code>, with only one column used. The x-axis was “freed” so that the axis and labels would be shown in both facets as in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MEDIAN,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Stage),</span>
<span id="cb17-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/index_files/figure-html/figure-4-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Confidence intervals are added with <code>geom_errorbar()</code> with <code>Lake</code> again mapped to the x-axis, <code>L95</code> and <code>U95</code> mapped to the minimum and maximum y interval values, and <code>Stage</code> set as a group.<sup>5</sup> To match the bars the confidence intervals must be dodged in the same way with <code>postion=</code> and the “cap” on the interval was made smaller with <code>width=</code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;The data needs a <code>group</code> here to match the group created by <code>fill=</code> in <code>geom_col()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MEDIAN,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Stage),</span>
<span id="cb18-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>L95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>U95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>Stage),</span>
<span id="cb18-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/index_files/figure-html/figure-4-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Colors were then set with <code>scale_fill_manual()</code> using the <code>sclrs</code> vector defined above. In addition, the y-axis was given a better title, the limits were set, axis expansion was removed, major breaks (i.e., labelled) were set at intervals of 200, and minor breaks were set at intervals of 100.<sup>6</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;These axis modifications were described in more detail in <a href="../2023-3-15-Axis_Magic/">this post</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MEDIAN,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Stage),</span>
<span id="cb19-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>L95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>U95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>Stage),</span>
<span id="cb19-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span>sclrs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stocking Density (fish/ha)"</span>,</span>
<span id="cb19-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb19-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),</span>
<span id="cb19-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minor_breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb19-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axis_minor"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/index_files/figure-html/figure-4-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Labels are now added to the facets with <code>geom_richtext()</code> from the <code>ggtext</code> package. Here <code>data=</code> is set to <code>datlbls</code>, which is why <code>data=dat</code> was used in <code>geom_col()</code> and <code>geom_errobar()</code> rather than being set in <code>ggplot()</code>.<sup>7</sup> The <code>Label</code> in <code>datlbls</code> is mapped to the labels, but <code>x=</code> and <code>y=</code> are defined outside of the data frame. Specifically, <code>x=</code> is set to 3.5 because each category is listed behind the scenes with sequential numbers beginning at 1. With six categories on the x-axis, the center will be at 3.5. <code>y=</code> is set to <code>Inf</code> to generically be set at the largest y value plotted. Thus, the labels will be centered from left-to-right (x-axis orientation) and at the top (y-axis orientation). <code>vjust=</code> is used to move the label down slightly (see <a href="../2023-3-10-Text_Annotation_Position/">this post</a>), <code>label.color=NA</code> removes the default box around the label, and <code>size=</code> was used to reduce the default size slightly.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;If multiple data frames are used when constructing a figure, then those data frames are usually declared in the geoms rather than in <code>ggplot()</code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MEDIAN,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Stage),</span>
<span id="cb20-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>L95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>U95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>Stage),</span>
<span id="cb20-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-6">  ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>datlbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>Label),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb20-7">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span>sclrs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stocking Density (fish/ha)"</span>,</span>
<span id="cb20-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),</span>
<span id="cb20-13">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minor_breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb20-14">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axis_minor"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/index_files/figure-html/figure-4-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, the theme was modified to more closely match Figure 4 in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span>. Specifically, <code>theme_class()</code> was used as the base and facet labels were removed, the x-axis title was removed, major tick mark size was increased, minor tick mark size was set to 50% of the major tick mark size, the legend was moved to the upper right of the plot, the legend title was removed, the legend text was made smaller, and the legend box size was made smaller.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MEDIAN,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>Stage),</span>
<span id="cb21-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Lake,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>L95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>U95,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>Stage),</span>
<span id="cb21-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span>pd,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-6">  ggtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dat=</span>datlbls,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span>Label),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb21-7">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Type),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span>sclrs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stocking Density (fish/ha)"</span>,</span>
<span id="cb21-11">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1800</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb21-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),</span>
<span id="cb21-13">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minor_breaks=</span>scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_width</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb21-14">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axis_minor"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.length=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb21-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.ticks.length.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb21-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb21-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>),</span>
<span id="cb21-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb21-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),</span>
<span id="cb21-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"line"</span>)</span>
<span id="cb21-25">        )</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/index_files/figure-html/figure-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>This largely reproduces Figure 4 in <span class="citation" data-cites="rooketal_2022">Rook et al. (2022)</span> with the exceptions that (a) the tick marks don’t cross the x-axes and (b) the x-axis tick marks are centered on the group of bars rather than between the group of bars. &nbsp;</p>
<div class="cell" data-layout-align="center">

</div>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-rooketal_2022" class="csl-entry">
Rook, B. J., M. J. Hansen, and C. R. Bronte. 2022. <a href="https://doi.org/10.3996/JFWM-21-025">How many <span>Ciscoes</span> are needed for stocking in the <span>Laurentian Great Lakes</span>?</a> Journal of Fish and Wildlife Management 13(1):28–49.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{h. ogle2023,
  author = {H. Ogle, Derek},
  title = {Rook Et Al. (2022) {Estimated} {Cisco} {Stocking}
    {Densities}},
  date = {2023-03-20},
  url = {https://fishr-core-team.github.io/fishR//blog/posts/2023-3-20-Rooketal2022_Fig4},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-h. ogle2023" class="csl-entry quarto-appendix-citeas">
H. Ogle, D. 2023, March 20. Rook et al. (2022) Estimated Cisco Stocking
Densities. <a href="https://fishr-core-team.github.io/fishR//blog/posts/2023-3-20-Rooketal2022_Fig4">https://fishr-core-team.github.io/fishR//blog/posts/2023-3-20-Rooketal2022_Fig4</a>.
</div></div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>bar chart</category>
  <category>confidence intervals</category>
  <category>facets</category>
  <category>Data Wrangling</category>
  <guid>https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/</guid>
  <pubDate>Mon, 20 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://fishr-core-team.github.io/fishR/blog/posts/2023-3-20-Rooketal2022_Fig4/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
</channel>
</rss>
